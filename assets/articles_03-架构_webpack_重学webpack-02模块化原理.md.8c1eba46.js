import{_ as s,o as n,c as a,V as l}from"./chunks/framework.b450deef.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"articles/03-æ¶æ„/webpack/é‡å­¦webpack-02æ¨¡å—åŒ–åŸç†.md","filePath":"articles/03-æ¶æ„/webpack/é‡å­¦webpack-02æ¨¡å—åŒ–åŸç†.md"}'),p={name:"articles/03-æ¶æ„/webpack/é‡å­¦webpack-02æ¨¡å—åŒ–åŸç†.md"},o=l(`<blockquote><p><code>webpack</code> æ˜¯ä¸€ä¸ªç”¨äºç°ä»£ <code>JavaScript</code> åº”ç”¨ç¨‹åºçš„ <code>é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·</code>--<a href="https://webpack.docschina.org/concepts/" target="_blank" rel="noreferrer">webpackå®˜æ–¹æ–‡æ¡£</a></p></blockquote><h2 id="å‰ç«¯jsçš„æ¨¡å—åŒ–" tabindex="-1">å‰ç«¯jsçš„æ¨¡å—åŒ– <a class="header-anchor" href="#å‰ç«¯jsçš„æ¨¡å—åŒ–" aria-label="Permalink to &quot;å‰ç«¯jsçš„æ¨¡å—åŒ–&quot;">â€‹</a></h2><p>å…ˆæŠ›å¼€æ‰“åŒ…å·¥å…·çš„æ¨¡å—åŒ–ï¼Œæˆ‘ä»¬çœ‹çœ‹çº¯jsçš„æ¨¡å—ï¼Œ<code>&lt;script src=&quot;&quot;&gt;ã€CMDã€ESMã€UMD</code></p><p><a href="./../js/å‰ç«¯æ¨¡å—åŒ–.html">å‰ç«¯æ¨¡å—åŒ–</a></p><h2 id="webpackçš„æ¨¡å—åŒ–" tabindex="-1">webpackçš„æ¨¡å—åŒ– <a class="header-anchor" href="#webpackçš„æ¨¡å—åŒ–" aria-label="Permalink to &quot;webpackçš„æ¨¡å—åŒ–&quot;">â€‹</a></h2><p>webpackè¦åšçš„æ˜¯è¯†åˆ«å¼€å‘è¿‡ç¨‹çš„nodejsæ¨¡å—åŒ–è½¬ä¸ºæµè§ˆå™¨çš„æ¨¡å—åŒ–æ–¹å¼</p><p>webpacké€‰æ‹©è®©æµè§ˆå™¨æ”¯æŒæ¨¡å—åŒ–çš„æ–¹å¼æ˜¯è‡ªå·±å®ç°ç±»ä¼¼nodejsçš„CJS</p><h3 id="æ­ä¸€ä¸ªç®€æ˜“webpackç¤ºä¾‹" tabindex="-1">æ­ä¸€ä¸ªç®€æ˜“webpackç¤ºä¾‹ <a class="header-anchor" href="#æ­ä¸€ä¸ªç®€æ˜“webpackç¤ºä¾‹" aria-label="Permalink to &quot;æ­ä¸€ä¸ªç®€æ˜“webpackç¤ºä¾‹&quot;">â€‹</a></h3><p>å®‰è£…<code>yarn add -D webpack webpack-cli</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// webpack.config.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">development</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// index.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> a </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> b </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./b.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(a</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">b)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// a.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// b.js</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">b</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>è¿è¡Œ<code>npx webpack</code> åªç”Ÿæˆäº†<code>dist/main.js</code>ä¸€ä¸ªæ–‡ä»¶</p><h3 id="åˆ†ææ‰“åŒ…åäº§ç‰©" tabindex="-1">åˆ†ææ‰“åŒ…åäº§ç‰© <a class="header-anchor" href="#åˆ†ææ‰“åŒ…åäº§ç‰©" aria-label="Permalink to &quot;åˆ†ææ‰“åŒ…åäº§ç‰©&quot;">â€‹</a></h3><p>ğŸ‘‡ æˆ‘ä»¬æŠŠæ³¨é‡Šåˆ æ‰çœ‹çœ‹</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_modules__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">./a.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module.exports = {</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">  a: &#39;a&#39;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">}</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">//# sourceURL=webpack://origin-webpack/./a.js?</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">./b.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module.exports = {</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">  b: &#39;b&#39;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">}</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">//# sourceURL=webpack://origin-webpack/./b.js?</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">./index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">__unused_webpack_module</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">__unused_webpack_exports</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">__webpack_require__</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">const a = __webpack_require__(/*! ./a.js */ </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">./a.js</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">const b = __webpack_require__(/*! ./b.js */ </span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">./b.js</span><span style="color:#A6ACCD;">\\&quot;</span><span style="color:#C3E88D;">)</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">console.log(a,b)</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">//# sourceURL=webpack://origin-webpack/./index.js?</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_module_cache__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">__webpack_require__</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">moduleId</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_module_cache__</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleId</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_module_cache__</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleId</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">			exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">__webpack_modules__</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleId</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">module,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_require__</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">__webpack_exports__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">__webpack_require__</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)()</span></span></code></pre></div><p>ğŸ‘‡ æˆ‘ä»¬å†ç²¾ç®€ä¸€ä¸‹å˜é‡å</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_modules</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./a.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module.exports = {a:&#39;a&#39;}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./b.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">module.exports = {b:&#39;b&#39;}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">__unused_webpack_module</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">__unused_webpack_exports</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">_require</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">        const a = _require(&quot;./a.js&quot;)</span></span>
<span class="line"><span style="color:#C3E88D;">        const b = _require(&quot;./b.js&quot;)</span></span>
<span class="line"><span style="color:#C3E88D;">        console.log(a,b)</span></span>
<span class="line"><span style="color:#C3E88D;">      </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">_require</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">moduleName</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleName</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cachedModule</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleName</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">_modules</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleName</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">module,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_require</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">_require</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./index.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)()</span></span></code></pre></div><p>ğŸ‘† æŠŠè¿™æ®µä»£ç ä¸¢åˆ°æµè§ˆå™¨å°±å¯ä»¥ç›´æ¥è¿è¡Œäº†</p><h2 id="webpack-require" tabindex="-1">webpack.require <a class="header-anchor" href="#webpack-require" aria-label="Permalink to &quot;webpack.require&quot;">â€‹</a></h2><blockquote><p>ä¸ç†Ÿæ‚‰nodejsçš„CommonJsæ¨¡å—åŒ–çš„è¿˜æ˜¯å…ˆç†Ÿæ‚‰ä¸€ä¸‹ï¼Œå› ä¸ºwebpackçš„æ¨¡å—åŒ–å°±æ˜¯ä¸€ç§CJS</p></blockquote><p>å’Œnodejsä¸€æ ·ï¼Œwebpackä¼šæŠŠæ¯ä¸ªæ¨¡å—jsåŒ…è£…ä¸€å±‚æ³¨å…¥æ¨¡å—åŒ–å·¥å…·æ–¹æ³•</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">wrap</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">fileContent</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ‹¼æ¥å‡½æ•°è¿›è¡ŒåŒ…è£… æ³¨æ„è¦åŒ…ä¸€å±‚()æ‰ä¸ä¼šè¢«evalç«‹å³æ‰§è¡Œ,è€Œæ˜¯è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²()å†…çš„å‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newfileContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">(function (myrequire){</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">fileContent</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">  })</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">newfileContent</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ æˆ‘ä»¬å†å»æ‰webpackçš„cacheéƒ¨åˆ†(åœ¨ <a href="./../js/å‰ç«¯æ¨¡å—åŒ–.html#ä»0å®ç°ç®€æ˜“commonjs">ä»0å®ç°CommonJs</a> é‡Œè§£é‡Šè¿‡cacheç”¨æ¥è§£å†³é‡å¤å¼•å…¥çš„é—®é¢˜)</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> _modules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">a</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">_require</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">moduleName</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    exports</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">_modules</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">moduleName</span><span style="color:#F07178;">](</span><span style="color:#89DDFF;">module,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">_require</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.exports;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘† å’Œæˆ‘ä»¬æ‰‹å†™nodejsçš„CJSä¸€æ¨¡ä¸€æ ·</p><hr><p>å½“webpacké…ç½® <code>mode:none</code> çš„æ—¶å€™ä¸ä¼šç”¨evalåŒ…,evalä¼šå¯¼è‡´è°ƒè¯•æ‰“åŒ…åäº§ç‰©æ— æ³•æ–­ç‚¹è°ƒè¯•æ¨¡å—å†…å®¹</p><p>TODO: <code>mode:none</code> çš„æ—¶å€™ä¸ºä»€ä¹ˆç”¨æ•°ç»„å’Œåºåˆ— è€Œä¸æ˜¯æ–‡ä»¶åï¼ˆæ”¶é›†ä¾èµ–å…³ç³»æ›´å¿«ï¼Ÿ</p><hr><h2 id="webpack4çš„æ‰“åŒ…äº§ç‰©åˆ†æ" tabindex="-1">webpack4çš„æ‰“åŒ…äº§ç‰©åˆ†æ <a class="header-anchor" href="#webpack4çš„æ‰“åŒ…äº§ç‰©åˆ†æ" aria-label="Permalink to &quot;webpack4çš„æ‰“åŒ…äº§ç‰©åˆ†æ&quot;">â€‹</a></h2><blockquote><p>å¯èƒ½æœ‰äººå‘ç°äº†ï¼Œæ€ä¹ˆè·Ÿç½‘ä¸Šå¾ˆå¤šçš„webpackæ‰“åŒ…äº§ç‰©ä¸å¤ªä¸€æ ·ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¸Šé¢çš„æ˜¯webpack5çš„æ‰“åŒ…äº§ç‰©ï¼Œè€Œä»¥å‰webpack4æ˜¯å¦ä¸€ç§ç»“æ„</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">modules</span><span style="color:#89DDFF;">)</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">_require</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">modelId</span><span style="color:#89DDFF;">){}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">require</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)(</span></span>
<span class="line"><span style="color:#A6ACCD;">  [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(){</span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span></code></pre></div><h2 id="æ‰‹å†™æ¨¡å—åŒ–æ‰“åŒ…å·¥å…·" tabindex="-1">æ‰‹å†™æ¨¡å—åŒ–æ‰“åŒ…å·¥å…· <a class="header-anchor" href="#æ‰‹å†™æ¨¡å—åŒ–æ‰“åŒ…å·¥å…·" aria-label="Permalink to &quot;æ‰‹å†™æ¨¡å—åŒ–æ‰“åŒ…å·¥å…·&quot;">â€‹</a></h2><blockquote><p>å‚è€ƒ <a href="https://github.com/dykily/simple_webpack/blob/master/bundler.js" target="_blank" rel="noreferrer">simple_webpack --github</a></p></blockquote><p>ä¸è€ƒè™‘ä»£ç è½¬è¯‘ï¼Œæˆ‘ä»¬å°è¯•å®ç°ä¸€ä¸ª<strong>åªå…·å¤‡å®ç°æ¨¡å—åŒ–çš„æ‰“åŒ…å·¥å…·</strong> å’Œ<code>ä»0å®ç°nodejsçš„CJS</code>ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³çš„ä¸€ä¸ªéš¾ç‚¹æ˜¯<strong>æ·±åº¦è¯†åˆ«</strong>æ–‡ä»¶å†…å®¹ä¸­çš„<code>require</code>å’Œ<code>export</code></p><ul><li>æ”¶é›†ï¼šæ”¶é›†jsçš„ä¾èµ–å…³ç³»æˆä¸€ä¸ªæ•°ç»„/å¯¹è±¡(ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆé€’å½’-é˜Ÿåˆ—)</li><li>æ³¨å…¥ï¼šéå†æ¨¡å—ä¾èµ–å…³ç³»æ•°ç»„,ç”¨ç«‹å³æ‰§è¡Œjsæ³¨å…¥requireç­‰å‚æ•°å®ç°æµè§ˆå™¨æ”¯æŒCMD(å‚è€ƒæ‰‹å†™CommonJs)</li><li>è¾“å‡ºï¼šç«‹å³æ‰§è¡Œå‡½æ•°æ˜¯ç”¨å­—ç¬¦ä¸²å†™æˆçš„ï¼Œæœ€ç»ˆåˆå¹¶å†™å…¥ä¸€ä¸ªjsæ–‡ä»¶ä¸­</li></ul><blockquote><p>ä¸ç”¨ASTï¼Œç”¨æ­£åˆ™å¤„ç†æ–‡ä»¶å†…å®¹æ¥æ³¨å…¥requireå¹¶ä¸”æ•´åˆæˆä¸€ä¸ªjsä¹Ÿæ˜¯å¯ä»¥çš„ æ­£åˆ™ä¹Ÿä¸å¤±ä¸ºä¸€ç§æ”¶é›†ä¾èµ–çš„åŠæ³• ä½†æ˜¯æ­£åˆ™çš„æ•ˆç‡å’Œå±€é™æ€§ä¹Ÿæ‘†åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬ç”¨æ›´æˆç†Ÿçš„ASTæ¥æ”¶é›†å§</p></blockquote><p>webpackçš„å†…éƒ¨ç”¨çš„æ˜¯æ”¹é€ åçš„ <a href="https://www.npmjs.com/package/acorn" target="_blank" rel="noreferrer">acorn-npm</a> / <a href="https://github.com/acornjs/acorn" target="_blank" rel="noreferrer">acorn-github</a> æ¥ç”ŸæˆAST</p><p><code>babel</code>ä¹Ÿæ˜¯åŸºäº<code>acorn</code>ç”ŸæˆASTçš„</p><hr><p>æ€è€ƒğŸ¤”: <code>acorn</code>å’Œ<code>babel-parser</code>éƒ½æ˜¯jsçš„è§£æå™¨ï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿ</p><blockquote><p><code>@babel/parser</code>ï¼ˆä¹‹å‰å°±æ˜¯<code>babylon</code>ï¼‰æ˜¯ä»<code>acorn fork</code> å‡ºæ¥çš„ï¼Œåªæ˜¯åŸºæœ¬éƒ½è¢«é‡å†™äº†ï¼Œä½†æ˜¯æœ‰äº›<code>acorn</code>çš„ç®—æ³•ä»çƒ­è¢«æ²¿ç”¨ä¸‹æ¥äº†ã€‚</p></blockquote><ul><li>@babel/parserä¸æ”¯æŒç¬¬ä¸‰æ–¹çš„æ’ä»¶ã€‚</li><li>acornåªæ”¯æŒç¬¬å››é˜¶æ®µçš„ææ¡ˆ(åŸºæœ¬ç­‰äºå†™å…¥æ ‡å‡†äº†ï¼Œåªæ˜¯æ—¶é—´çš„é—®é¢˜ è§æ­¤)ã€‚</li><li>ASTçš„æ ¼å¼ä¸åŒï¼Œä¸è¿‡å¯ä»¥å¯åŠ¨@babel/parserçš„estreeæ’ä»¶æ¥å’Œacornçš„ASTæ ¼å¼åŒ¹é…</li></ul><hr><p>å› ä¸º <code>webpack</code> å¹¶æ²¡æœ‰æŠŠ <code>acorn</code> éƒ¨åˆ†çš„ä»£ç å‘å¸ƒæˆåŒ…è€Œæ˜¯<a href="https://github.com/webpack/webpack/blob/a07a1269f0a0b23d40de6c9565eeaf962fbc8904/lib/javascript/JavascriptParser.js" target="_blank" rel="noreferrer">å†…éƒ¨çš„å·¥å…·æ–¹æ³•javascript/JavascriptParser.js</a></p><p>ğŸ‘‡ å› æ­¤æˆ‘ä»¬é€‰æ‹©ç”¨ <code>babel</code> æ¥ç”Ÿæˆ<code>AST</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// getAst.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;">Â ParserÂ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Â </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@babel/parser</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getAst</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//Â å°†æ–‡ä»¶å†…å®¹è½¬ä¸ºASTæŠ½è±¡è¯­æ³•æ ‘</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    sourceType</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> getAst</span></span></code></pre></div><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20220320204335.png" alt=""> ğŸ‘‡ æ‰“å°ä¸€ä¸ªASTèŠ‚ç‚¹Nodeçš„å†…å®¹å­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬æœ‰åŠæ³•é€šè¿‡èŠ‚ç‚¹typeè¯†åˆ«å‡º<code>import</code>ï¼Œå´æ²¡åŠæ³•è¯†åˆ« <code>require</code></p><ul><li>ImportDeclaration: å¼•å…¥å£°æ˜</li><li>ExpressionStatement: è¡¨è¾¾å¼è¯­å¥</li></ul><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20220320210448.png" alt=""></p><p>æˆ‘ä»¬å¸Œæœ›è¯†åˆ«å‡ºASTä¸­çš„å¼•å…¥ä»£ç ï¼ŒæŠŠè¢«å¼•å…¥èµ„æºè·¯å¾„æ”¶é›†åˆ°ä¸€ä¸ªé›†åˆä¸­ ç­‰å¾…æˆ‘ä»¬åç»­çš„å¤„ç†</p><hr><p>æ€è€ƒğŸ¤”: æ‰‹å†™nodejsçš„CJSä¸ºä»€ä¹ˆä¸éœ€è¦è¯†åˆ«requireï¼Ÿ</p><ul><li>ç¡®å®ï¼Œæˆ‘ä»¬è¦å®ç°ä¸šåŠ¡ä»£ç ä¸­å†™requireï¼Œè¿è¡Œæ—¶requireå­˜åœ¨çš„å½¢å¼ï¼Œåªè¦åŒ…è£…æ³¨å…¥å³å¯ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸è¯†åˆ«requireç›´æ¥å¾€å…¥å£æ–‡ä»¶æ³¨å…¥requireï¼Œä½†æ˜¯æ²¡åŠæ³•æ‰¾åˆ°æ·±åº¦çš„èµ„æºå¼•ç”¨</li><li>åœ¨nodejsä¸­çš„åšæ³•æ˜¯åŒ…è£…æ³¨å…¥åç«‹å³æ‰§è¡Œï¼Œå› æ­¤å¯ä»¥è‡ªç„¶å½¢æˆé€’å½’æ³¨å…¥</li><li>ä½†æ˜¯åœ¨æ‰“åŒ…å·¥å…·é‡Œï¼Œæˆ‘ä»¬è¦è¾“å‡ºä¸€ä¸ªæ‰€æœ‰å¼•å…¥èµ„æºçš„æ¨¡å—é›†åˆï¼Œè€Œä¸æ˜¯è¦ç«‹å³æ‰§è¡Œä¸šåŠ¡ä»£ç ï¼Œå› æ­¤è¦é€šè¿‡ASTæ¥è¯†åˆ«æ‰€æœ‰å¼•å…¥èµ„æºæ•´åˆåˆ°ä¸€ä¸ªæ–‡ä»¶å†…å®¹ä¸­è¾“å‡º</li></ul><hr><p>æ€ä¹ˆè®©ASTè¯†åˆ«<code>require</code>,æˆ‘ä»¬å…ˆæ”¾ä¸€ä¸‹ã€‚ã€‚ã€‚(ğŸ¥¬ğŸ¶)</p><p>æˆ‘ä»¬ä¸šåŠ¡ä»£ç æ”¹ä¸ºç”¨importï¼Œè¯†åˆ«å‡ºæ¥åè½¬æˆ<code>require</code>ï¼Œå†æ³¨å…¥æˆ‘ä»¬çš„<code>require</code>ã€‚ã€‚ã€‚</p><p>ğŸ‘‡ ç”¨babelè¯†åˆ«ä¸šåŠ¡ä»£ç ä¸­çš„import</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> traverse </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/traverse</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">default</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findRequire</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ast</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// keyå’Œvalueéƒ½ç”¨è·¯å¾„</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//éå†å½“å‰astï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">traverse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//æ‰¾åˆ°æœ‰ importè¯­æ³• çš„å¯¹åº”èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">ImportDeclaration</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">({</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">})</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">//å¦‚æœå½“å‰jsæ–‡ä»¶ æœ‰ä¸€å¥ import message from &#39;./message.js&#39;ï¼Œ </span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// node.source.valueçš„å€¼å°±æ˜¯&#39;./message.js&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dependencies</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> findRequire</span></span></code></pre></div><p>ğŸ‘‡ ç”¨babelæŠŠä¸šåŠ¡ä»£ç çš„importè½¬ä¸ºrequireè¾“å‡º</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ç”¨babel æŠŠä¸šåŠ¡ä»£ç çš„importè½¬ä¸ºrequireè¾“å‡º</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> transformFromAst </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/core</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> code </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">transformFromAst</span><span style="color:#A6ACCD;">(ast</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">presets</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/preset-env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>åˆ°è¿™é‡Œæˆ‘ä»¬åªæ˜¯é€šè¿‡babelæŠŠå…¥å£æ–‡ä»¶è½¬æˆASTæ¥æ”¶é›†å…¥å£æ–‡ä»¶çš„ä¾èµ–è€Œå·²</p><p>æˆ‘ä»¬è¿˜è¦é€’å½’å…¥å£æ–‡ä»¶çš„å­ä¾èµ–è½¬æˆASTæ¥æ”¶é›†å…¶ä¾èµ–</p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¹¿åº¦ä¼˜å…ˆçš„é€’å½’(é˜Ÿåˆ—)</p><p>å¦‚ğŸ‘‡ <code>deepRequire()</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;">Â </span><span style="color:#FFCB6B;">Compiler</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//Â webpackÂ é…ç½®</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//Â å…¥å£</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//Â å‡ºå£</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â [] </span><span style="color:#676E95;font-style:italic;">//Â æ¨¡å—</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getAst</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// å…¥å£æ–‡ä»¶çš„ast</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">findRequire</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ”¶é›†ï¼šéå†astæ¥è¯†åˆ«requireç­‰å¼•å…¥èµ„æº(ä¸å½±å“åŸä»£ç )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">transformFromAst</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      presets</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/preset-env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dependencies</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> fileName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">deepRequire</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dirname</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">fileName</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">absolutePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//è·å¾—å­ä¾èµ–ï¼ˆå­æ¨¡å—ï¼‰çš„ä¾èµ–é¡¹ã€ä»£ç ã€æ¨¡å—idï¼Œæ–‡ä»¶å</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">childMoule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">absolutePath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//å°†å­ä¾èµ–ä¹ŸåŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œå¹¿åº¦éå†</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">childMoule</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//Â æ„å»ºå¯åŠ¨</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// å…¥å£æ–‡ä»¶æ¨¡å—ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">deepRequire</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>è¿™æ ·æ¯ä¸ªçˆ¶æ¨¡å—çš„ä¿¡æ¯ä¸­å°±å¸¦ç€å­æ¨¡å—çš„è·¯å¾„ è€Œå­æ¨¡å—å¯¹è±¡åˆ™æ‹æ‰åœ¨äº†æ¨¡å—åˆ—è¡¨ä¸­</p><p>æœ€åæˆ‘ä»¬éå†æ‰€æœ‰æ¨¡å—æ³¨å…¥require(åŒ…è£…ä¸€å±‚),å¹¶æ•´åˆèµ·æ¥</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// setRequire.js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åŒ…è£…å‡½æ•°æ³¨å…¥require</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">setRequire</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">module</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    &#39;</span><span style="color:#89DDFF;">\${</span><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">fileName</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&#39;: function (require, module, exports){</span></span>
<span class="line"><span style="color:#C3E88D;">      </span><span style="color:#89DDFF;">\${</span><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">    },</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> setRequire</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// index.js</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">wrap</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">modulesString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä½œä¸ºå‚æ•°çš„æ¨¡å—åˆ—è¡¨-å› ä¸ºæ˜¯å†™å…¥æ–‡ä»¶çš„å†…å®¹ï¼Œå› æ­¤æ˜¯ä¸ªå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">modulesString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setRequire</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">module</span><span style="color:#F07178;">)</span><span style="color:#676E95;font-style:italic;">// æ³¨å…¥ï¼šç»™æ‰€æœ‰æ¨¡å—æ³¨å…¥requireç­‰å‚æ•°å®ç°æµè§ˆå™¨æ”¯æŒCMD</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">modulesString</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>åŒ…è£…æˆç«‹å³æ‰§è¡Œå‡½æ•°</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// generate.js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åˆå¹¶å¤„ç†åçš„æ¨¡å—å†™å…¥ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">modules</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">entryPath</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">(function(modules){</span></span>
<span class="line"><span style="color:#C3E88D;">  //åˆ›å»ºrequireå‡½æ•°ï¼Œ å®ƒæ¥å—ä¸€ä¸ªæ¨¡å—IDï¼ˆè¿™ä¸ªæ¨¡å—idæ˜¯æ•°å­—0ï¼Œ1ï¼Œ2ï¼‰ ï¼Œå®ƒä¼šåœ¨æˆ‘ä»¬ä¸Šé¢å®šä¹‰ modules ä¸­æ‰¾åˆ°å¯¹åº”æ˜¯æ¨¡å—.</span></span>
<span class="line"><span style="color:#C3E88D;">  function require(fileName){</span></span>
<span class="line"><span style="color:#C3E88D;">    const module = modules[fileName];</span></span>
<span class="line"><span style="color:#C3E88D;">    const module = {exports:{}};</span></span>
<span class="line"><span style="color:#C3E88D;">    //æ‰§è¡Œæ¯ä¸ªæ¨¡å—çš„ä»£ç ã€‚</span></span>
<span class="line"><span style="color:#C3E88D;">    fn(require,module,module.exports);</span></span>
<span class="line"><span style="color:#C3E88D;">    return module.exports;</span></span>
<span class="line"><span style="color:#C3E88D;">  }</span></span>
<span class="line"><span style="color:#C3E88D;">  //æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œ</span></span>
<span class="line"><span style="color:#C3E88D;">  require(&#39;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">entryPath</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&#39;);</span></span>
<span class="line"><span style="color:#C3E88D;">})({</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">})</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> generate</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// outputFile.js</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">outputFile</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">fileContent</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// console.log(fileContent)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">writeFileSync</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./main.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileContent</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> outputFile</span></span></code></pre></div><p>ğŸ‘‡ æœ€ç»ˆçš„classç±»</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> path </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">transformFromAst</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/core</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> getAst </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./getAst.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> findRequire </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./findRequire.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> outputFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./outputFile.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setRequire </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./setRequire.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> generate </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./generate</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;">Â </span><span style="color:#FFCB6B;">Compiler</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//Â webpackÂ é…ç½®</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//Â å…¥å£</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">output</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//Â å‡ºå£</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;">Â [] </span><span style="color:#676E95;font-style:italic;">//Â æ¨¡å—</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">parse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;">Â </span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;">Â </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getAst</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// å…¥å£æ–‡ä»¶çš„ast</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">findRequire</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ”¶é›†ï¼šéå†astæ¥è¯†åˆ«requireç­‰å¼•å…¥èµ„æº(ä¸å½±å“åŸä»£ç )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">transformFromAst</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      presets</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@babel/preset-env</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">dependencies</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;">fileName</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">deepRequire</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dirname</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">fileName</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module.</span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">absolutePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//è·å¾—å­ä¾èµ–ï¼ˆå­æ¨¡å—ï¼‰çš„ä¾èµ–é¡¹ã€ä»£ç ã€æ¨¡å—idï¼Œæ–‡ä»¶å</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">childMoule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">absolutePath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//å°†å­ä¾èµ–ä¹ŸåŠ å…¥é˜Ÿåˆ—ä¸­ï¼Œå¹¿åº¦éå†</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">childMoule</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">wrap</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">modulesString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä½œä¸ºå‚æ•°çš„æ¨¡å—åˆ—è¡¨-å› ä¸ºæ˜¯å†™å…¥æ–‡ä»¶çš„å†…å®¹ï¼Œå› æ­¤æ˜¯ä¸ªå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">modulesString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setRequire</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">module</span><span style="color:#F07178;">)</span><span style="color:#676E95;font-style:italic;">// æ³¨å…¥ï¼šç»™æ‰€æœ‰æ¨¡å—æ³¨å…¥requireç­‰å‚æ•°å®ç°æµè§ˆå™¨æ”¯æŒCMD</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">modulesString</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//Â æ„å»ºå¯åŠ¨</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">run</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">Â </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// å…¥å£ä¾èµ–åˆ†æ</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">deepRequire</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// å…¥å£ä¾èµ–é€’å½’åˆ†æ</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">moduleListString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">wrap</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// åŒ…è£…æ‰€æœ‰ä¾èµ–æ¨¡å—</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileRes</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">generate</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">moduleListString</span><span style="color:#89DDFF;">,this.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">)</span><span style="color:#676E95;font-style:italic;">// åˆå¹¶å†™å…¥ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">outputFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fileRes</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">options</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;">Â </span><span style="color:#82AAFF;">Compiler</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">options</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">run</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>æˆ‘ä»¬è¿è¡Œ<code>node build/index.js</code> åç”Ÿæˆå‡ºäº†æ•´åˆåçš„js</p><p>æˆ‘ä»¬ç›´æ¥è¿è¡Œç”Ÿæˆå‡ºæ¥çš„jsæ–‡ä»¶ï¼Œå‘ç°æŠ¥é”™æ‰¾ä¸åˆ°èµ„æº è¿™æ˜¯å› ä¸ºæˆ‘ä»¬modulesçš„keyå€¼æ˜¯è½¬åŒ–åçš„ç»å¯¹è·¯å¾„ï¼Œè€Œä¸šåŠ¡ä»£ç å†™çš„æ˜¯ç›¸å¯¹è·¯å¾„ å› æ­¤ç”¨ç›¸å¯¹è·¯å¾„ä½œä¸ºkeyå»åŒ¹é…æ¨¡å—ï¼Œå°†æ‰¾ä¸åˆ°èµ„æº <img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20220320234256.png" alt=""> ä½ å¯èƒ½ä¼šè¯´ï¼Œé‚£æˆ‘ä»¬å°±ç”¨ä¸šåŠ¡ä»£ç çš„ç›¸å¯¹è·¯å¾„åškeyå­˜æˆmodulesä¸å°±è¡Œäº†å—ï¼Ÿ</p><p>ç›¸å¯¹è·¯å¾„æ˜¯ä¼šå†²çªçš„ï¼Œæˆ‘ä»¬åªæœ‰ç”¨ç»å¯¹è·¯å¾„åškeyæ‰èƒ½æ˜¯å‡†ç¡®çš„èµ„æºæ ‡è¯†</p><ul><li>webpack5 ä¼šæŠŠä¸šåŠ¡ä»£ç çš„ç›¸å¯¹è·¯å¾„æ”¹å†™ä¸ºç»å¯¹è·¯å¾„</li><li>TODO: webpack4 å¥½åƒæ˜¯ç”¨è‡ªå¢IDæ¥åŒ¹é…èµ„æºè€Œä¸æ˜¯èµ„æºè·¯å¾„</li></ul><p>é—®é¢˜å‡ºåœ¨å”¯ä¸€æ ‡è¯†ä¸åŒ¹é…ä¸Š</p><p>è§£å†³åŠæ³•1</p><p>æˆ‘ä»¬ç°åœ¨çš„æ¨¡å—åˆ—è¡¨æ˜¯ <code>&#39;path&#39;:function(){}</code> æˆ‘ä»¬æ”¹ä¸º <code>&#39;path&#39;: {code:function(){}, dependencies:{}}</code></p><p>å¦‚ğŸ‘‡</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æ·±åº¦æ‰«æè¯†åˆ«requireç­‰å¼•å…¥èµ„æº</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findRequire</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">ast</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">parentPath</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dirname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dirname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">parentPath</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//éå†å½“å‰astï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">traverse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ast</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//æ‰¾åˆ°æœ‰ importè¯­æ³• çš„å¯¹åº”èŠ‚ç‚¹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">ImportDeclaration</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">({</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">})</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">//ä¾‹å¦‚ å¦‚æœå½“å‰jsæ–‡ä»¶ æœ‰ä¸€å¥ import a from &#39;./a.js&#39;ï¼Œ </span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">dependencies</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">source</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">dependencies</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>åœ¨æ³¨å…¥çš„requireä¸­ç”¨ä¸šåŠ¡ä»£ç çš„ç›¸å¯¹è·¯å¾„å»åŒ¹é… <code>dependencies</code> å‡ºçœŸå®ç»å¯¹è·¯å¾„</p><p>ğŸ‘‡ è¿™æ˜¯ä¸€ç§è¿è¡Œæ—¶çš„æ€è·¯</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åˆå¹¶å¤„ç†åçš„æ¨¡å—å†™å…¥ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generate</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">modules</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">entryPath</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">(function(modules){</span></span>
<span class="line"><span style="color:#C3E88D;">  function require(fileName) {</span></span>
<span class="line"><span style="color:#C3E88D;">    const { dependencies,code } =  modules[fileName]</span></span>
<span class="line"><span style="color:#C3E88D;">    // è¦æ³¨å…¥çš„çœŸæ­£requireï¼ŒåŒ…è£…äº†ä¸€å±‚å¸¦ä¸Šç¼“å­˜çš„(é—­åŒ…)</span></span>
<span class="line"><span style="color:#C3E88D;">    function realRequire(relativePath) {</span></span>
<span class="line"><span style="color:#C3E88D;">      return require(dependencies[relativePath])</span></span>
<span class="line"><span style="color:#C3E88D;">    }</span></span>
<span class="line"><span style="color:#C3E88D;">    const module = {exports:{}};</span></span>
<span class="line"><span style="color:#C3E88D;">    //æ‰§è¡Œæ¯ä¸ªæ¨¡å—çš„ä»£ç ã€‚</span></span>
<span class="line"><span style="color:#C3E88D;">    code(realRequire,module,module.exports);</span></span>
<span class="line"><span style="color:#C3E88D;">    return module.exports;</span></span>
<span class="line"><span style="color:#C3E88D;">  }</span></span>
<span class="line"><span style="color:#C3E88D;">  //æ‰§è¡Œå…¥å£æ–‡ä»¶ï¼Œ</span></span>
<span class="line"><span style="color:#C3E88D;">  require(&#39;</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">entryPath</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">&#39;);</span></span>
<span class="line"><span style="color:#C3E88D;">})({</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">modules</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">})</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> generate</span></span></code></pre></div><p>è§£å†³åŠæ³•2</p><p>æƒ³åœ¨ä¸åŠ¨ä¸šåŠ¡ä»£ç çš„å‰æä¸‹åŒ¹é…ä¸Šï¼Œé€šè¿‡ä¸€å±‚æšä¸¾æ¥ä¸­è½¬åŒ¹é… è¿™æ˜¯ç¼–è¯‘æ—¶çš„æ€è·¯ TODO:</p><hr><p>æ€è€ƒğŸ¤”: <code>webpack</code> åªå®ç°è®©æµè§ˆå™¨æ”¯æŒCJSçš„æ¨¡å—åŒ–æ‰“åŒ…è€Œå·²,æŠŠå¾ˆå¤šåŠŸèƒ½éƒ½é€šè¿‡ <code>loader</code> å’Œ <code>plugin</code>å¼€æ”¾å‡ºå»äº†ï¼Œä¸ºä»€ä¹ˆ<code>çº¯webpack</code>è¿˜ä¼šè¿™ä¹ˆé‡å‘¢(å› ä¸ºå·¥ç¨‹åºå¤§,ä¾èµ–æ–‡ä»¶å¤šï¼Ÿ)</p><p>æºç å¤æ‚çš„åŸå› æ˜¯é…ç½®å¤šï¼Œå¹¶ä¸”é…ç½®æ”¯æŒçš„ç±»å‹å¤šï¼Œè¿™æ ·å¤„ç†1ä¸ªé…ç½®é¡¹å†™èµ·æ¥å°±å¾ˆå¤æ‚ å¦å¤– <code>webpack</code> è¿˜æœ‰å¾ˆå¤šå¾ˆé‡è¦çš„åŠŸèƒ½æ˜¯å†…ç½®çš„ï¼Œå¦‚ <code>çƒ­æ›´æ–°HMRã€sourceMapã€ä»£ç åˆ†å‰²</code>ç­‰</p><hr><h2 id="æ€»ç»“" tabindex="-1">æ€»ç»“ <a class="header-anchor" href="#æ€»ç»“" aria-label="Permalink to &quot;æ€»ç»“&quot;">â€‹</a></h2><p><code>webpack</code> å®ç°æµè§ˆå™¨è¯†åˆ«ä¸šåŠ¡ä»£ç ä¸­çš„æ¨¡å—åŒ–ï¼Œæ˜¯é€šè¿‡åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡æ³¨å…¥ <code>require</code> çš„CJSå®ç°æ¨¡å—åŒ–</p><p>éš¾ç‚¹åœ¨äºğŸ‘‡</p><ul><li>æŠŠæ–‡ä»¶å†…å®¹è½¬åŒ–ä¸º<code>ASTæ ‘</code>,æ”¶é›†æ¨¡å—åŒ–è¯­æ³•,ä¹Ÿå°±æ˜¯å¼€å‘é˜¶æ®µä½¿ç”¨çš„<code>nodejs</code>çš„<code>CMD/AMDè¯­æ³•</code></li><li>æ ¹æ®æ”¶é›†åˆ°çš„<code>ASTæ ‘</code>,é€šè¿‡åŒ…è£…ä¸€å±‚<code>æ³¨å…¥æ–¹æ³•</code>çš„å½¢å¼ï¼Œå®ç°æ¨¡å—åŒ–(è·Ÿ<code>nodejs</code>ä¸€è‡´)</li><li>æŠŠæ”¶é›†åˆ°çš„ä¾èµ–åˆ—è¡¨ï¼Œæ•´åˆåˆ°ä¸€èµ·ï¼Œé€šè¿‡<code>è¿è¡Œæ—¶æ–¹æ³•</code>è¿è¡ŒæŒ‡å®šèµ„æº</li></ul><p>æˆ‘ä»¬è¿˜æåˆ°äº†ä¸€ç‚¹è¿è¡Œæ—¶å’Œç¼–è¯‘æ—¶çš„æ¦‚å¿µï¼Œæˆ‘ä»¬åç»­çš„åˆ†æä¹Ÿå¸Œæœ›å¸¦ç€è¿™æ˜¯åœ¨è¿è¡Œæ—¶åšçš„è¿˜æ˜¯åœ¨ç¼–è¯‘æ—¶åšçš„ï¼Œå„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹çš„é—®é¢˜æ¥å­¦ä¹ </p>`,96),e=[o];function t(c,r,y,F,D,A){return n(),a("div",null,e)}const u=s(p,[["render",t]]);export{C as __pageData,u as default};
