import{_ as a,o as l,c as t,V as o,k as e,a as s}from"./chunks/framework.b450deef.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"articles/03-æ¶æ„/vite/imooc1viteä½¿ç”¨.md","filePath":"articles/03-æ¶æ„/vite/imooc1viteä½¿ç”¨.md"}'),n={name:"articles/03-æ¶æ„/vite/imooc1viteä½¿ç”¨.md"},p=o(`<p><a href="https://vitejs.dev/" target="_blank" rel="noreferrer">viteå®˜æ–¹æ–‡æ¡£</a> ç§»åŠ¨çš„ç½‘ç»œå±…ç„¶æ‰“ä¸å¼€ï¼Œç”µä¿¡æ­£å¸¸ã€‚ã€‚ã€‚ ï¼ˆæ®è¯´å·²ç»ä»å›½å¤–æœåŠ¡å™¨éƒ¨ç½²åˆ°äº†giteeï¼Œæ„Ÿè§‰åƒæ˜¯è®¿é—®åœ°å€æ—¶æ²¡æœ‰é‡å®šå‘åˆ°å›½å†…æœåŠ¡å™¨ï¼Œå¤šåˆ·æ–°å‡ æ¬¡å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆä¸æŠŠå›½å†…çš„åŸŸååœ°å€å…¬å¸ƒå‡ºæ¥ï¼Œå…è®¸è‡ªå·±ç›´æ¥è®¿é—®è€Œä¸æ˜¯é é‡å®šå‘å‘¢ã€‚ã€‚ã€‚ï¼‰</p><p>æ¦‚å¿µï¼š</p><ul><li><code>bundler-based build setup</code> - åŸºäºæ‰“åŒ…å™¨çš„æ„å»ºæ–¹å¼</li><li><code>native ESM base build setup</code> - åŸºäºåŸç”ŸESMçš„æ„å»ºæ–¹å¼: <code>rollup</code>ã€<code>parcel</code></li><li><code>improves DX</code> - <code>Developer Experience</code> æé«˜å¼€å‘ä½“éªŒ</li><li><code>bare module</code> - è£¸æ¨¡å— éè·¯å¾„å¼çš„ <code>import</code> å¦‚ <code>node_modules</code></li><li><code>Rebasing</code> - å˜åŸº çŒœæµ‹æ˜¯æŒ‡è‡ªåŠ¨æ‹¼æ¥ç›¸å¯¹è·¯å¾„çš„ <code>baseUrl</code></li></ul><h2 id="æ¦‚å¿µ" tabindex="-1">æ¦‚å¿µ <a class="header-anchor" href="#æ¦‚å¿µ" aria-label="Permalink to &quot;æ¦‚å¿µ&quot;">â€‹</a></h2><p><a href="https://vitejs.dev/guide/why.html" target="_blank" rel="noreferrer">viteå®˜æ–¹æ–‡æ¡£-why vite</a></p><blockquote><p>Vite aims to address these issues by leveraging new advancements in the ecosystem: the availability of native ES modules in the browser, and the rise of JavaScript tools written in compile-to-native languages.</p><p>Vite æ—¨åœ¨è§£å†³ä¸Šè¿°é—®é¢˜é€šè¿‡åˆ©ç”¨ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ–°è¿›å±•ï¼šåŸç”ŸESæ¨¡å—åœ¨æµè§ˆå™¨ä¸Šå¯ç”¨çš„ï¼Œå’Œè¶Šæ¥è¶Šå¤š JavaScript å·¥å…·ä½¿ç”¨ç¼–è¯‘å‹è¯­è¨€ç¼–å†™</p><p>ğŸ‘† é‡ç‚¹åœ¨äºä½¿ç”¨ <strong>åŸç”ŸESMæ¨¡å—åŒ–</strong>ã€<strong>ç¼–è¯‘å‹è¯­è¨€å·¥å…·Rust</strong></p></blockquote><p><a href="./../è®¾è®¡/æ‰“åŒ…å·¥å…·çš„æ€è€ƒ.html">æ‰“åŒ…å·¥å…·çš„æ€è€ƒ</a></p><h3 id="è§£å†³-slow-server-start" tabindex="-1">è§£å†³ Slow Server Start <a class="header-anchor" href="#è§£å†³-slow-server-start" aria-label="Permalink to &quot;è§£å†³ Slow Server Start&quot;">â€‹</a></h3><blockquote><p>Vite improves the dev server start time by first dividing the modules in an application into two categories: dependencies and source code.</p><p>Vite æ”¹è¿›äº†å¼€å‘æœåŠ¡å™¨å¯åŠ¨æ—¶é—´ï¼Œé€šè¿‡åœ¨ä¸€å¼€å§‹å°†åº”ç”¨ä¸­çš„æ¨¡å—åŒºåˆ†ä¸ºä¸¤ç±»: ä¾èµ– å’Œ æºç </p></blockquote><ul><li><p><code>Dependencies</code>: plain JavaScript that do not change often during development.</p><ul><li>large dependencies (e.g. component libraries with <code>hundreds of modules</code> or like lodash-es)</li><li>various module <code>formats</code> (e.g. ESM or CommonJS).</li><li>Vite <code>pre-bundles</code> dependencies using <code>esbuild</code>. esbuild is written in Go and pre-bundles dependencies 10-100x faster than JavaScript-based bundlers.</li></ul></li><li><p><code>Source code</code>: <code>non-plain</code> JavaScript</p><ul><li>needs <code>transforming</code> (e.g. JSX, CSS or Vue/Svelte components)</li><li>will be <code>edited very often</code></li><li>not all source code needs to be <code>loaded at the same time</code> (e.g. with route-based code-splitting).</li><li>Vite serves source code over <code>native ESM</code>. This is essentially letting the <code>browser take over part of the job of a bundler</code>: Vite only needs to transform and serve source code on demand, as the browser requests it. Code behind conditional dynamic imports is only processed if actually used on the current screen.</li></ul></li><li><p>ä¾èµ–: çº¯jsï¼Œä¸ç»å¸¸æ”¹åŠ¨</p><ul><li>å¯èƒ½å†…éƒ¨ä¾èµ–å¤§é‡æ¨¡å—(lodash-esã€components libraries)</li><li>å¯èƒ½æ˜¯å¤šç§æ ¼å¼ CJSã€ESMã€UMD</li><li>è§£å†³å¯åŠ¨æ…¢ï¼švite é¢„ç¼–è¯‘è¿™äº›ä¾èµ–é€šè¿‡esbuild</li></ul></li><li><p>æºç : éçº¯jsï¼Œç»å¸¸æ”¹åŠ¨</p><ul><li>éœ€è¦è½¬è¯‘ JSXã€CSSã€VUE/Svelteã€TS</li><li>ä¸éœ€è¦å…¨éƒ¨åŠ è½½</li><li>è§£å†³å¯åŠ¨æ…¢ï¼švite åŸºäºåŸç”ŸESMï¼Œç›¸å½“äºè®©æµè§ˆå™¨æ¥ç®¡æ‰“åŒ…ç¨‹åºçš„éƒ¨åˆ†å·¥ä½œ(æ¨¡å—åŒ–),viteåªè½¬è¯‘å’ŒæŒ‰éœ€æä¾›æºç </li></ul></li></ul><h3 id="è§£å†³-slow-updates" tabindex="-1">è§£å†³ Slow Updates <a class="header-anchor" href="#è§£å†³-slow-updates" aria-label="Permalink to &quot;è§£å†³ Slow Updates&quot;">â€‹</a></h3><blockquote><p>runs the bundling in memory so that it only needs to invalidate part of its module graph when a file changes,</p><p>ğŸ‘† æœ‰ç¼“å­˜åŠŸèƒ½çš„æ‰“åŒ…å™¨æ„å»ºæ–¹å¼ï¼Œé€šè¿‡ç¼“å­˜æ‰“åŒ…ç»“æœæ¥æå‡é€Ÿåº¦ï¼Œåªåœ¨æ–‡ä»¶æ›´æ”¹æ—¶ä½¿æ¨¡å—å›¾çš„ä¸€éƒ¨åˆ†å¤±æ´»</p></blockquote><p>æ²¡HMRæ—¶ï¼š</p><ul><li>re-construct the entire bundle and reload the web page ä»ç„¶éœ€è¦ä»å¤´è¿è¡Œè¿è¡Œæ„å»ºæµç¨‹(æœ‰ç¼“å­˜æ—¶ä¼šè·³è¿‡)</li><li>reloading the page blows away the current state of the application é‡è½½æ¨¡å—å›¾ç›¸å…³éƒ¨åˆ†ï¼Œä¼šä¸¢å¤±jsçŠ¶æ€</li></ul><p>æœ‰HMRåï¼š</p><blockquote><p>in practice we&#39;ve found that even HMR update speed deteriorates significantly as the size of the application grows.</p><p>ğŸ‘† æ²¡æœ‰å…·ä½“è¯´æ˜ï¼Œå¤§å‹åº”ç”¨ <code>bundle-base build setup</code> æœ‰HMRåä¾ç„¶æ…¢çš„åŸå› TODO:</p></blockquote><p>Viteï¼ŒHMR æ˜¯åœ¨åŸç”Ÿ ESM ä¸Šæ‰§è¡Œçš„ å½“ç¼–è¾‘ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒVite åªéœ€è¦ç²¾ç¡®åœ°ä½¿å·²ç¼–è¾‘çš„æ¨¡å—ä¸å…¶æœ€è¿‘çš„ HMR è¾¹ç•Œä¹‹é—´çš„é“¾å¤±æ´»ï¼ˆå¤§å¤šæ•°æ—¶å€™åªæ˜¯æ¨¡å—æœ¬èº«ï¼‰ ä½¿å¾—æ— è®ºåº”ç”¨å¤§å°å¦‚ä½•ï¼ŒHMR å§‹ç»ˆèƒ½ä¿æŒå¿«é€Ÿæ›´æ–°</p><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230102131910.png" alt=""></p><h3 id="ç”Ÿäº§ç¯å¢ƒä»ç„¶ç”¨-bundel-base-build" tabindex="-1">ç”Ÿäº§ç¯å¢ƒä»ç„¶ç”¨ bundel-base build <a class="header-anchor" href="#ç”Ÿäº§ç¯å¢ƒä»ç„¶ç”¨-bundel-base-build" aria-label="Permalink to &quot;ç”Ÿäº§ç¯å¢ƒä»ç„¶ç”¨ bundel-base build&quot;">â€‹</a></h3><blockquote><p>the additional network round trips caused by nested imports</p><p>ğŸ‘† ç”Ÿäº§ç¯å¢ƒå¦‚æœæ˜¯ç”¨ESM buildï¼ŒåµŒå¥—å¯¼å…¥ä¼šå¯¼è‡´é¢å¤–çš„ç½‘ç»œå¾€è¿”</p></blockquote><blockquote><p>esbuild important features needed for bundling applications are still work in progress - like code-splitting and CSS handling.</p><p>ğŸ‘† ä¸ä½¿ç”¨ esbuild è¿›è¡Œ bundle-base buildçš„åŸå› : esbuild é’ˆå¯¹æ„å»ºåº”ç”¨çš„é‡è¦åŠŸèƒ½ä»ç„¶è¿˜åœ¨æŒç»­å¼€å‘ä¸­ - ä»£ç åˆ†å‰²å’Œ CSS å¤„ç†</p></blockquote><h3 id="æ€è€ƒ" tabindex="-1">æ€è€ƒ <a class="header-anchor" href="#æ€è€ƒ" aria-label="Permalink to &quot;æ€è€ƒ&quot;">â€‹</a></h3><ul><li>ä¸éœ€è¦åƒ <code>webpack</code> é‚£ä¹ˆå¤šé…ç½®é¡¹ <ul><li>ğŸ¤”åªæ˜¯å› ä¸ºéƒ½å†…ç½®æˆé»˜è®¤é…ç½®è€Œå·²å§</li><li>å’Œ <code>webpack</code> æ¯”è¾ƒä¸æ˜¯åˆç†çš„ï¼Œå› ä¸ºviteæ‰“åŒ…æ˜¯åŸºäºrollupçš„ï¼Œå¹¶ä¸æ˜¯æä¾›ä¸€å¥—æ–°çš„æ‰“åŒ…å·¥å…·</li><li>æ›´åˆç†çš„æ˜¯å’Œè„šæ‰‹æ¶å·¥å…·æ¯”è¾ƒå¦‚: <code>vue-cli</code>ã€<code>create-react-app</code></li><li>è¿™äº›å·¥å…·åŒæ ·ä¸éœ€è¦å¾ˆå¤šé…ç½®é¡¹è€Œæ˜¯å†…ç½®æˆé»˜è®¤é…ç½®</li><li><code>vue-cli</code> é€šè¿‡ <code>configureWebpack</code> å’Œ <code>chainWebpack</code> ä¿®æ”¹é»˜è®¤é…ç½®</li><li><code>create-react-app</code> é€šè¿‡ <code>eject</code> ä¿®æ”¹é»˜è®¤é…ç½®</li></ul></li></ul><h2 id="åŠŸèƒ½" tabindex="-1">åŠŸèƒ½ <a class="header-anchor" href="#åŠŸèƒ½" aria-label="Permalink to &quot;åŠŸèƒ½&quot;">â€‹</a></h2><p><a href="https://vitejs.dev/guide/features.html" target="_blank" rel="noreferrer">viteå®˜æ–¹æ–‡æ¡£-features</a></p><h3 id="æ”¯æŒ-bare-module-import" tabindex="-1">æ”¯æŒ bare module import <a class="header-anchor" href="#æ”¯æŒ-bare-module-import" aria-label="Permalink to &quot;æ”¯æŒ bare module import&quot;">â€‹</a></h3><p>æµè§ˆå™¨åŸç”ŸESMä¸æ”¯æŒ <code>bare module</code> å¼•å…¥(åŸç”ŸESMå…¶å®å¯ä»¥é  <code>importMap</code> æ”¯æŒ)</p><p>å› æ­¤éœ€è¦ <code>ViteDevServer</code>ï¼Œæ‹¦æˆªåˆ°ç›¸å…³çš„è·¯å¾„å¼•å…¥ï¼Œè½¬åŒ–ä¸ºç»å¯¹è·¯å¾„</p><blockquote><p>Rewrite the imports to valid URLs like <code>/node_modules/.vite/deps/my-dep.js?v=f3sf2ebd</code></p></blockquote><p>ğŸ‘† å¯ä»¥çœ‹åˆ°è½¬åŒ–çš„è·¯å¾„å¸¦äº†<code>hash</code>ï¼Œé…åˆ <code>httpå¼ºç¼“å­˜</code>ï¼Œå¯ä»¥ç¼“å­˜åˆ°æµè§ˆå™¨è€Œä¸ç»è¿‡ <code>ViteDevServer</code></p><p>å¦å¤–è¿™ä¸ªæ­¥éª¤åŒæ—¶ä¼šæœ‰é¢„æ„å»ºçš„å¤„ç†(<code>esbuild</code>è½¬åŒ–<code>CJS</code>ç­‰)ï¼Œåè¡¥å®Œæ•´å¤„ç†é€»è¾‘ TODO:</p><h3 id="hmr" tabindex="-1">HMR <a class="header-anchor" href="#hmr" aria-label="Permalink to &quot;HMR&quot;">â€‹</a></h3><blockquote><p>Frameworks with HMR capabilities can leverage the API to provide instant, precise updates without reloading the page or blowing away application state</p><p>ğŸ‘† å…·æœ‰HMRèƒ½åŠ›çš„æ¡†æ¶ï¼Œå¯ä»¥åˆ©ç”¨Viteçš„APIæ¥æä¾›å®æ—¶çš„ï¼Œç²¾ç¡®çš„æ›´æ–°ï¼Œè€Œæ— éœ€é‡è½½é¡µé¢åè€…æ¸…é™¤åº”ç”¨çŠ¶æ€</p></blockquote><p>æºç åˆ†æéƒ¨åˆ†è®²è§£ Viteå¹¶ä¸æä¾›HMRåŠŸèƒ½ï¼Œè€Œæ˜¯æä¾›ä¸€å¥—é€šç”¨çš„HMR APIï¼Œç”±æ’ä»¶æ ¹æ®ä¸åŒæ¡†æ¶ä»¥åŠæ¡†æ¶è‡ªèº«æ¥å®ç°ç›¸åº”çš„HMR</p><h3 id="ts" tabindex="-1">TS <a class="header-anchor" href="#ts" aria-label="Permalink to &quot;TS&quot;">â€‹</a></h3><h4 id="é»˜è®¤ä¸åšç±»å‹æ ¡éªŒ-å¯ä»¥å¦å¤–é…ç½®å¼€å¯" tabindex="-1">é»˜è®¤ä¸åšç±»å‹æ ¡éªŒï¼Œå¯ä»¥å¦å¤–é…ç½®å¼€å¯ <a class="header-anchor" href="#é»˜è®¤ä¸åšç±»å‹æ ¡éªŒ-å¯ä»¥å¦å¤–é…ç½®å¼€å¯" aria-label="Permalink to &quot;é»˜è®¤ä¸åšç±»å‹æ ¡éªŒï¼Œå¯ä»¥å¦å¤–é…ç½®å¼€å¯&quot;">â€‹</a></h4><blockquote><p>Vite only performs transpilation on .ts files and does NOT perform type checking.</p><p>ğŸ‘† viteé»˜è®¤æ”¯æŒtsè½¬è¯‘ï¼Œä½†æ˜¯ä¸ä¼šæ‰§è¡Œç±»å‹æ£€æŸ¥</p></blockquote><blockquote><p>It assumes type checking is taken care of by your IDE and build process (you can run <code>tsc --noEmit</code> in the build script or <code>install vue-tsc</code> and run<code> vue-tsc --noEmit</code> to also type check your *.vue files).</p><p>ğŸ‘† viteå‡å®šç±»å‹æ£€æŸ¥å·²ç»é€šè¿‡ç¼–è¾‘å™¨å’Œæ‰“åŒ…è¿‡ç¨‹å¤„ç†å¥½äº†ï¼Œæ‰“åŒ…è¿‡ç¨‹å¤„ç†çš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®æ‰§è¡Œ <code>tsc --noEmit</code> å¦å¤–.vueæ–‡ä»¶éœ€è¦å®‰è£…vue-tscå¹¶æ‰§è¡Œ<code>vue-tsc --noEmit</code></p></blockquote><p>tsè½¬è¯‘ä½¿ç”¨äº†<code>esbuild</code>ï¼Œé™¤äº†<code>first inité¡¹ç›®</code>é€Ÿåº¦å¿«ï¼Œåœ¨<code>HMR</code>æ—¶ä¹Ÿå¿«</p><h4 id="ä»…å«ç±»å‹çš„importè¢«ä¸æ­£ç¡®çš„æ‰“åŒ…-é—®é¢˜-todo-p2-6" tabindex="-1">[ä»…å«ç±»å‹çš„importè¢«ä¸æ­£ç¡®çš„æ‰“åŒ…]é—®é¢˜ TODO: p2-6 <a class="header-anchor" href="#ä»…å«ç±»å‹çš„importè¢«ä¸æ­£ç¡®çš„æ‰“åŒ…-é—®é¢˜-todo-p2-6" aria-label="Permalink to &quot;[ä»…å«ç±»å‹çš„importè¢«ä¸æ­£ç¡®çš„æ‰“åŒ…]é—®é¢˜ TODO: p2-6&quot;">â€‹</a></h4><blockquote><p>avoid potential problems: <code>type-only imports being incorrectly bundled</code> é¿å…æ½œåœ¨çš„é—®é¢˜ï¼š<code>ä»…å«ç±»å‹çš„importè¢«ä¸æ­£ç¡®çš„æ‰“åŒ…</code></p></blockquote><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">T</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">only/types</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">T</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span></code></pre></div><p>Use the Type-Only Imports and Export syntax</p><p>ğŸ¤” TODO: why type-only imports will error in being incorrectly bundled</p><h4 id="tsé…ç½®è¦æ±‚-create-vite-é—®ç­”é€‰ä¸­tsæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ-todo-p2-6" tabindex="-1">TSé…ç½®è¦æ±‚(create-vite é—®ç­”é€‰ä¸­tsæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ) TODO: p2-6 <a class="header-anchor" href="#tsé…ç½®è¦æ±‚-create-vite-é—®ç­”é€‰ä¸­tsæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ-todo-p2-6" aria-label="Permalink to &quot;TSé…ç½®è¦æ±‚(create-vite é—®ç­”é€‰ä¸­tsæ—¶ä¼šè‡ªåŠ¨ç”Ÿæˆ) TODO: p2-6&quot;">â€‹</a></h4><p>è¿™é‡Œå¹¶ä¸æ˜¯è®²è§£ç”Ÿæˆçš„<code>tsconfig</code>çš„æ¯ä¸€é¡¹çš„å«ä¹‰(ä¼šåœ¨create-viteåŸç†ä¸­è®²è§£TODO:)</p><p>è€Œæ˜¯è®²è§£ä¸€ä¸ªviteé¡¹ç›®æ”¯æŒtsçš„å¼ºåˆ¶è¦æ±‚çš„é…ç½®é¡¹</p><ul><li><code>isolatedModules</code>: true <ul><li>because <code>esbuild</code> only performs transpilation without <code>type information</code> ğŸ¤” ä»€ä¹ˆæ˜¯type informationï¼Ÿï¼Ÿï¼Ÿ</li><li>it doesn&#39;t support certain features like <code>const enum</code> and <code>implicit type-only imports</code> ğŸ¤” ä»€ä¹ˆæ˜¯éšå¼çº¯ç±»å‹å¼•å…¥</li><li>set true for TS warn you do not work with isolated transpilation. è®¾ç½®æ¥è®©TSè­¦å‘Šä¸è¦ä½¿ç”¨isolatedéš”ç¦»è½¬è¯‘åŠŸèƒ½ ğŸ¤” ä»€ä¹ˆæ˜¯isolated transpilation</li><li>ç„¶è€Œï¼Œä¸€äº›åº“ï¼ˆå¦‚ï¼švueï¼‰ä¸èƒ½å¾ˆå¥½åœ°ä¸ &quot;isolatedModules&quot;: true å…±åŒå·¥ä½œã€‚ä½ å¯ä»¥åœ¨ä¸Šæ¸¸ä»“åº“ä¿®å¤å¥½ä¹‹å‰æš‚æ—¶ä½¿ç”¨ &quot;skipLibCheck&quot;: true æ¥ç¼“è§£è¿™ä¸ªé”™è¯¯ã€‚ğŸ¤” ä»€ä¹ˆæ˜¯ä¸Šæ¸¸ä»“åº“ ä¿®å¥½ä»€ä¹ˆ</li></ul></li><li><code>useDefineForClassFields</code>: true <ul><li>It is consistent with the behavior of tsc 4.3.2 and later. It is also the standard ECMAScript runtime behavior.</li><li>ğŸ¤” çº¦å®šä¿—æˆï¼Ÿå…·ä½“æ˜¯ä»€ä¹ˆ</li></ul></li></ul><h4 id="vite-client-æä¾›ä¸šåŠ¡ä»£ç apiçš„types" tabindex="-1">vite/client æä¾›ä¸šåŠ¡ä»£ç APIçš„types <a class="header-anchor" href="#vite-client-æä¾›ä¸šåŠ¡ä»£ç apiçš„types" aria-label="Permalink to &quot;vite/client æä¾›ä¸šåŠ¡ä»£ç APIçš„types&quot;">â€‹</a></h4><blockquote><p>Vite&#39;s default types are for its <code>Node.js API</code> ğŸ‘† Viteæ˜¯nodejsç¯å¢ƒçš„æ„å»ºå·¥å…·ï¼Œå› æ­¤viteé»˜è®¤æä¾›çš„typeséƒ½æ˜¯ç»™æ„å»ºè„šæœ¬ä½¿ç”¨çš„</p><p>To shim the environment of <code>client side code</code> in a Vite application ğŸ‘† ä½†æ˜¯ViteåŒæ—¶ä¹Ÿæä¾›äº†ä¸€äº›ä¸šåŠ¡ä»£ç çš„API(<code>i<wbr>mport.meta.env</code>ã€<code>i<wbr>mport.meta.hot</code>ã€<code>.svg</code>)ï¼Œè¿™äº›APIçš„typeséœ€è¦æ‰‹åŠ¨å¯¼å…¥</p></blockquote><p>å¯¼å…¥è¿™äº›APIçš„typesæ–¹å¼æœ‰2ç§</p><ul><li>æ–°å»º<code>env.d.ts</code>æ–‡ä»¶ <ul><li><code>/// &lt;reference types=&quot;vite/client&quot; /&gt;</code></li><li>åœ¨è¿™ä¸€è¡Œå‰å†™ç±»å‹å£°æ˜å¯ä»¥è¦†ç›– <code>declare module &#39;*.svg&#39; {}</code></li><li>åœ¨è¿™ä¸€è¡Œåå†™ç±»å‹å£°æ˜å¯ä»¥æ‰©å±•</li></ul></li><li><code>tsconfig.json</code>é…ç½®é¡¹ <ul><li><code>&quot;compilerOptions&quot;: { &quot;types&quot;: [&quot;vite/client&quot;] }</code></li></ul></li></ul><p>ğŸ¤” TODO: <code>vite/client</code> å†…éƒ¨æ€ä¹ˆå®šä¹‰ç±»å‹,ç»™å¤–éƒ¨ä½¿ç”¨çš„</p><h3 id="jsx-tsx" tabindex="-1">JSX/TSX <a class="header-anchor" href="#jsx-tsx" aria-label="Permalink to &quot;JSX/TSX&quot;">â€‹</a></h3><p>é¦–å…ˆ <code>JSX/TSX</code> è¯­æ³•æ˜¯ <code>React</code> åˆ›å»ºçš„ï¼Œæ‰€ä»¥çº¯çš„JSXè¯­æ³•æ˜¯æŒ‰ç…§Reactçš„éœ€è¦è€Œå®šä¹‰çš„ ä¹Ÿå°±ä¸ä¼šæœ‰vueçš„æ¨¡ç‰ˆè¯­æ³•åŠŸèƒ½(æŒ‡ä»¤ã€æŒ‡ä»¤ã€å…¨å±€ç»„ä»¶ç­‰) æ‰€ä»¥vueéœ€è¦é¢å¤–çš„æ‰©å±• <code>vue-jsx</code></p><p>viteå†…ç½®æä¾› <code>JSX/TSX</code> ç¼–è¯‘é€šè¿‡ <code>esbuild</code>ï¼Œå› æ­¤reactä¸éœ€è¦é¢å¤–å®‰è£…jsxç›¸å…³æ’ä»¶ï¼Œè€Œvueåˆ™éœ€è¦å®‰è£…<code>@vitejs/plugin-jsx</code></p><blockquote><p>If not using JSX with React or Vue, custom jsxFactory and jsxFragment can be configured using the esbuild option. For example for Preact:</p></blockquote><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// vite.config.js</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">esbuild</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">jsxFactory</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">h</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">jsxFragment</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Fragment</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>ğŸ‘† viteåŸºäº <code>esbuild</code> æ¥ç¼–è¯‘ <code>jsx</code>ï¼Œå› æ­¤å¦‚æœéœ€è¦<code>éreactå’Œévue</code>ï¼Œå…¶ä»–jsxè¯­æ³•ï¼Œåˆ™å¯ä»¥é…ç½®<a href="https://esbuild.github.io/content-types/#jsx" target="_blank" rel="noreferrer">esbuildç›¸å…³é…ç½®</a>æ¥æ”¯æŒï¼ŒåŒ…æ‹¬ä¸€äº›é¢å¤–çš„jsxç¼–è¯‘åŠŸèƒ½</p><h3 id="css" tabindex="-1">CSS <a class="header-anchor" href="#css" aria-label="Permalink to &quot;CSS&quot;">â€‹</a></h3><p>åœ¨ <code>webpack</code> ä¸­éœ€è¦</p><ul><li><code>style-loader</code>: æŠŠå¤„ç†åçš„cssæ–‡ä»¶å†…å®¹æ’å…¥åˆ°<code>html</code>çš„<code>head</code>ä¸­</li><li><code>css-loader</code>: å¤„ç†cssä¸­çš„æ¨¡å—åŒ–,å¦‚<code>èƒŒæ™¯å›¾</code>å’Œ<code>@import css</code>çš„æ“ä½œ</li><li><code>postcss-loader</code>: ç±»ä¼¼ <code>babel</code> å¯¹ <code>js</code> çš„ä½œç”¨,é€šè¿‡ç»™æ ·å¼å±æ€§æ·»åŠ å‰ç¼€æ¥<strong>å…¼å®¹</strong>å„ç§é«˜ä½ç‰ˆæœ¬çš„æµè§ˆå™¨</li></ul><h4 id="style-loader" tabindex="-1">style-loader <a class="header-anchor" href="#style-loader" aria-label="Permalink to &quot;style-loader&quot;">â€‹</a></h4><p><code>viteDevServer</code> å†…ç½®å¤„ç† inject css content to the html via a <code>&lt;style&gt;</code> tag with HMR support</p><p>ğŸ‘† ä¹Ÿå°±æ˜¯ <code>vite</code> é‡åˆ°cssè¯·æ±‚ï¼Œå›è½¬åŒ–ä¸ºjsï¼Œå…¶ä¸­çš„é€»è¾‘æ˜¯æ’å…¥cssåˆ°htmlä¸­</p><p>ç›¸å½“äºå†…ç½®äº† webpack çš„ <code>style-loader</code></p><h4 id="css-loader" tabindex="-1">css-loader <a class="header-anchor" href="#css-loader" aria-label="Permalink to &quot;css-loader&quot;">â€‹</a></h4><p>è€Œ å¤„ç†cssä¸­urlçš„ <code>css-loader</code>ï¼Œåˆ™å†…ç½®ä¸ºé»˜è®¤é…ç½®</p><blockquote><p>pre-configured to support CSS <code>@import</code> inlining via <code>postcss-import</code>. Vite aliases are also respected for CSS <code>@import</code></p><p>ğŸ‘† ä»¥å‰ä»…ç”¨äºå…¼å®¹æµè§ˆå™¨æ·»åŠ csså‰ç¼€çš„ postcssï¼Œç°åœ¨è¿˜æä¾›å¾ˆå¤šå…¶ä»–è½¬è¯‘åŠŸèƒ½å¦‚ <code>postcss-import</code> å°±æä¾›äº† <code>css-loader</code> çš„åŠŸèƒ½</p><p>å…³äº<code>postcss-import</code> é…ç½®åˆ™ç”±viteè®¾ç½®æˆäº†é»˜è®¤é…ç½®ï¼Œå¹¶ä¸”æ”¯æŒviteé…ç½®ä¸­çš„è·¯å¾„åˆ«åå¦‚ <code>@</code></p></blockquote><blockquote><p>all CSS url() references, even if the imported files are in different directories, are always automatically rebased to ensure correctness.</p><p>css ä¸­çš„ <code>url()</code> è¯­æ³•åŒæ ·çš„å¤„ç†ï¼Œå¹¶ä¸”é¢å¤–æä¾›è‡ªåŠ¨å˜åŸºåŠŸèƒ½ï¼Œå³ä½¿ä¸åœ¨æ ¹ç›®å½•çš„è·¯å¾„ä¹Ÿèƒ½è¢«å¤„ç†æˆåŠŸ</p><p>ğŸ¤” ä¸è‡ªåŠ¨å˜åŸºçš„è¯ï¼Œä¸åœ¨æ ¹è·¯å¾„ä¸‹çš„ç›®å½•å°±å¼•å…¥ä¸åˆ°äº†å—ï¼Ÿéœ€è¦é¢å¤–åšä»€ä¹ˆï¼Ÿ</p></blockquote><h4 id="postcss-loader" tabindex="-1">postcss-loader <a class="header-anchor" href="#postcss-loader" aria-label="Permalink to &quot;postcss-loader&quot;">â€‹</a></h4><p>Viteå†…ç½®äº†è¯»å–<a href="https://github.com/postcss/postcss-load-config" target="_blank" rel="noreferrer">postcssé…ç½®æ–‡ä»¶</a>çš„é€»è¾‘ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®å¼€å¯postcssï¼Œåªéœ€è¦åœ¨é¡¹ç›®æ ¹è·¯å¾„åˆ›å»ºç›¸å…³é…ç½®æ–‡ä»¶å³å¯ å¦‚ <code>postcss.config.js</code> <code>.postcssrc</code></p><p>ğŸ¤” csså‹ç¼©ä¼šå‘ç”Ÿåœ¨devé˜¶æ®µå—ï¼Ÿä¼šçš„è¯è¿™ä¸ªå†…ç½®é€»è¾‘æ˜¯é€šè¿‡ä»€ä¹ˆå®ç°çš„ï¼Ÿ</p><h4 id="css-modules" tabindex="-1">CSS Modules <a class="header-anchor" href="#css-modules" aria-label="Permalink to &quot;CSS Modules&quot;">â€‹</a></h4><p>å†…ç½®æ”¯æŒ <code>xx.module.css</code> å¼•å…¥ï¼Œé€šè¿‡ <a href="https://github.com/css-modules/css-modules" target="_blank" rel="noreferrer">css-modules github</a>è¿™ä¸ªåº“å®ç°</p><p>æŠŠcssæ–‡ä»¶å†…å®¹è½¬åŒ–æˆç±»ä¼¼jsonçš„å¯¹è±¡æ•°æ® ğŸ¤” TODO: ä¸å¤ªäº†è§£è¿™ç§å†™æ³•çš„ä½œç”¨</p><p>çœ‹èµ·æ¥æ˜¯ä¸ºäº†æä¾›å¤ç”¨æ ·å¼ï¼Œwebpackçš„ <code>postcss</code> ä½¿ç”¨è¿‡ç»™æ‰€æœ‰çš„csså…¨å±€æ³¨å…¥å…¬å…±æ ·å¼ï¼Œå½“æ—¶æ˜¯å»ºè®®åªæ³¨å…¥å˜é‡è€Œä¸ä½¿ç”¨classNameçš„</p><p>ä½†æ˜¯ä½¿ç”¨èµ·æ¥æ˜¯ï¼Œè¦jså¼•å…¥å†ä½œç”¨äºhtmlï¼Œå¹¶ä¸æ–¹ä¾¿å§</p><p>ä¸ºäº†å¤ç”¨æ ·å¼ï¼Œå†™æˆå…¨å±€æ ·å¼å…¶å®ä¹Ÿä¸ä¼šé€ æˆå¾ˆå¤šæµªè´¹å§</p><p>åŒæ ·å¯ä»¥é€šè¿‡é…ç½®<code>vite.config.js</code>å¯¹ç›¸å…³åŠŸèƒ½è¿›è¡Œé…ç½®å¦‚</p><p><code>css.modules.localsConvention: &#39;camelCaseOnly&#39;</code> å¯ä»¥å®ç°é©¼å³°å‘½åæ–¹å¼è·å–cssä¸­çš„<code>xx-xx</code>å½¢å¼çš„æ ·å¼</p><h4 id="css-é¢„å¤„ç†å™¨" tabindex="-1">CSS é¢„å¤„ç†å™¨ <a class="header-anchor" href="#css-é¢„å¤„ç†å™¨" aria-label="Permalink to &quot;CSS é¢„å¤„ç†å™¨&quot;">â€‹</a></h4><blockquote><p>Because Vite targets modern browsers only, it is recommended to use native CSS variables with PostCSS plugins that implement CSSWG drafts (e.g. <a href="https://github.com/csstools/postcss-plugins/tree/main/plugins/postcss-nesting" target="_blank" rel="noreferrer">postcss-nesting</a>) and author plain, future-standards-compliant CSS.</p></blockquote><p>ç›®å‰æœ‰è‰æ¡ˆcssæ”¯æŒåµŒå¥—å†™æ³•ï¼Œè€Œpostcsså…¶å®ç±»ä¼¼äºcssä¸­çš„babelï¼Œæå‰æ”¯æŒè‰æ¡ˆè¯­æ³•å› æ­¤å¯ä»¥å¼•å…¥å¹¶é…ç½®æ”¯æŒ</p><p>ä½†æ˜¯è‰æ¡ˆè¿˜æ˜¯æœ‰å¤§æ”¹çš„å¯èƒ½</p><h3 id="static-assets" tabindex="-1">Static Assets <a class="header-anchor" href="#static-assets" aria-label="Permalink to &quot;Static Assets&quot;">â€‹</a></h3><p>ç›¸å½“äº <code>webpack</code> çš„ <code>file-loader</code>ï¼Œå¤„ç†å¦‚å›¾ç‰‡ã€å­—ä½“ã€svgç­‰èµ„æºå¼•å…¥åœ¨jsçš„ä½¿ç”¨</p><p>å›¾ç‰‡ã€å­—ä½“ã€svgç­‰èµ„æºè·¯å¾„ï¼ŒæŒ‰ç…§æ ‡å‡†ä»…æ”¯æŒå†™åœ¨ç‰¹å®šçš„åœ°æ–¹ï¼Œå¦‚ <code>imgæ ‡ç­¾ä¸­çš„src</code>ï¼Œè€Œä¸æ”¯æŒç”¨importå¼•å…¥ä½œä¸ºjsé€»è¾‘ä½¿ç”¨</p><p>å› æ­¤åœ¨æ„å»ºå·¥å…·ä¸­å°±è¦å¯¹è¿™äº›å†…å®¹åšæ”¯æŒ</p><p>ğŸ¤” TODO: Viteæ–‡æ¡£æ²¡æœ‰è§£é‡Šç”¨ä»€ä¹ˆå®ç°çš„,æ‰¾åˆ°å†…ç½®é€»è¾‘åœ¨æºç åˆ†æä¸­è®²è§£</p><p>åŸç†ï¼šæ˜¯ <code>viteDevServer</code> æ‹¦æˆªè¯·æ±‚ï¼Œè½¬ä¸ºæ­£ç¡®çš„æœ¬åœ°æœåŠ¡é™æ€èµ„æºè·¯å¾„ï¼Œåœ¨ä¸šåŠ¡ä»£ç ä¸­éœ€è¦æ­£ç¡®çš„ä½¿ç”¨ <code>import</code> è¿”å›çš„è·¯å¾„</p><ul><li>å‡è®¾ <code>import</code> ä¸€ä¸ªå›¾ç‰‡ï¼Œåˆ™è¦æŠŠè¿”å›çš„å˜é‡æ”¾åˆ° <code>img</code> æ ‡ç­¾ä¸­</li><li>å‡è®¾ <code>import</code> ä¸€ä¸ªsvgï¼Œåˆ™è¦æŠŠ <code>svg:raw</code> çš„ <code>html</code> å†…å®¹æ¸²æŸ“, ä¸èƒ½å•å•ç”¨è·¯å¾„</li></ul><p>å¦å¤–Viteæä¾›äº†url query paramsçš„æ–¹å¼ä¿®æ”¹js import çš„èµ„æºå†…å®¹</p><ul><li>url</li><li>raw</li><li>worker - workeræ˜¯jsï¼Œä½†æ˜¯æ¯æ¬¡å¼•å…¥éƒ½éœ€è¦å†™å¾ˆå¤šé‡å¤çš„åˆå§‹åŒ–workerçš„å†…å®¹ï¼ŒViteåšçš„æ˜¯è‡ªåŠ¨åˆå§‹åŒ–å¥½Workerå®ä¾‹</li><li>...</li></ul><h3 id="json" tabindex="-1">JSON <a class="header-anchor" href="#json" aria-label="Permalink to &quot;JSON&quot;">â€‹</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// import the entire object</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> json </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./example.json</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// import a root field as named exports - helps with tree-shaking!</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">field</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./example.json</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>ğŸ‘† TODO: åŒæ ·æ²¡æœ‰è®²è§£æ€ä¹ˆæŠŠjsonè½¬è¯‘æˆjså¯¹è±¡ï¼Œå¹¶æ”¯æŒ tree-shaking</p><h3 id="glob-import" tabindex="-1">Glob Import <a class="header-anchor" href="#glob-import" aria-label="Permalink to &quot;Glob Import&quot;">â€‹</a></h3><p><a href="https://vitejs.dev/guide/features.html#glob-import" target="_blank" rel="noreferrer">viteå®˜æ–¹æ–‡æ¡£-Glob</a></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> modules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">glob</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir/*.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ğŸ‘‡ ç¼–è¯‘å  code produced by vite</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> modules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./dir/foo.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir/foo.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">./dir/bar.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./dir/bar.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>å› æ­¤ä½¿ç”¨è¯¥APIè¿”å›åˆ°çš„ <code>modules</code> æ˜¯ä¸€ä¸ªå¯¹è±¡, éœ€è¦éå†å¯¹è±¡æˆ–é€šè¿‡ <code>è·¯å¾„key</code> å–å‡º</p><p>å–å‡ºçš„ <code>value</code> æ˜¯ä¸€ä¸ªå‡½æ•°æ‰§è¡Œ <code>import()</code> ï¼Œå› æ­¤å–åˆ°valueéœ€è¦æ‰§è¡Œä¸€ä¸‹ <code>value()</code></p><p>å…³äºè¿™ä¸ªå·¥å…·æ–¹æ³•çš„å…¶ä»–å‚æ•°ä¸ä¸€ä¸€è®²è§£,éœ€è¦æ—¶æŸ¥çœ‹æ–‡æ¡£</p><blockquote><ul><li>This is a Vite-only feature and is not a web or ES standard.</li><li>The glob patterns are treated like import specifiers: they must be either relative (start with ./) or absolute (start with /, resolved relative to project root) or an alias path (see resolve.alias option).</li><li>The glob matching is done via fast-glob - check out its documentation for supported glob patterns.</li><li>You should also be aware that all the arguments in the i<wbr>mport.meta.glob must be passed as literals. You can NOT use variables or expressions in them.</li></ul><p>ğŸ‘† <code>i<wbr>mport.meta.glob()</code> æ˜¯viteå†…ç½®é€»è¾‘å¾€ <code>i<wbr>mport.meta</code> å¯¹è±¡ä¸ŠæŒ‚è½½çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œä¸æ˜¯JSå®˜æ–¹API</p><p>Glob æ¨¡å¼ä¼šè¢«å½“æˆå¯¼å…¥æ ‡è¯†ç¬¦ï¼šå¿…é¡»æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆä»¥ ./ å¼€å¤´ï¼‰æˆ–ç»å¯¹è·¯å¾„ï¼ˆä»¥ / å¼€å¤´ï¼Œç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•è§£æï¼‰æˆ–ä¸€ä¸ªåˆ«åè·¯å¾„</p><p>ğŸ¤” ä»€ä¹ˆå«å½“æˆå¯¼å…¥æ ‡è¯†ç¬¦ï¼Œæ‰€ä»¥è¦å†™è·¯å¾„</p><p>åŸºäº <a href="https://github.com/mrmlnc/fast-glob" target="_blank" rel="noreferrer">fast-glob</a></p><p>å¦‚ğŸ‘†çš„codeğŸŒ°ä¸­ï¼Œglobæ–¹æ³•å‘ç”Ÿåœ¨æ„å»ºå·¥å…·ç¼–è¯‘æ—¶ï¼Œè€Œä¸æ˜¯è¿è¡Œæ—¶ï¼Œå› æ­¤ä¸èƒ½å†™å˜é‡ï¼Œæ„Ÿè§‰å¯ä»¥ä¼˜åŒ–æˆæ”¯æŒå¸¸é‡çš„å˜é‡</p></blockquote><p>å’Œ Webpack ä¸­çš„ <code>modules.resolve</code> ç±»ä¼¼ï¼Œå‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ TODO: è¿è¡Œæ—¶å­˜ä¸å­˜åœ¨è¿™ä¸ª APIï¼Ÿ</p><h3 id="webassenbly" tabindex="-1">WebAssenbly <a class="header-anchor" href="#webassenbly" aria-label="Permalink to &quot;WebAssenbly&quot;">â€‹</a></h3><p><a href="https://vitejs.dev/guide/features.html#webassembly" target="_blank" rel="noreferrer">viteå®˜æ–¹æ–‡æ¡£-wasm</a></p><p>å› ä¸ºæ²¡æœ‰å…·ä½“ä½¿ç”¨è¿‡ï¼Œå› æ­¤å…ˆç•¥è¿‡</p><p>viteä¼šæä¾›åˆå§‹åŒ–å®ä¾‹çš„ä»£ç åŒ…è£…æˆä¸€ä¸ªæœªæ‰§è¡Œçš„Promiseå‡½æ•° çœå»è‡ªå·±å†™åˆå§‹åŒ–çš„é‡å¤ä»£ç </p><h3 id="web-workers" tabindex="-1">Web Workers <a class="header-anchor" href="#web-workers" aria-label="Permalink to &quot;Web Workers&quot;">â€‹</a></h3><p>åŒ WebAssenbly</p><h3 id="build-optimizations" tabindex="-1">Build Optimizations <a class="header-anchor" href="#build-optimizations" aria-label="Permalink to &quot;Build Optimizations&quot;">â€‹</a></h3><p>æŒ‡ ç”Ÿäº§ç¯å¢ƒçš„æ‰“åŒ…ä¼˜åŒ–ï¼Œéƒ½åŸºäºrollupå†…ç½®æˆé»˜è®¤é…ç½®äº†</p><h4 id="async-chunk-css-code-splitting" tabindex="-1">Async Chunk CSS Code Splitting <a class="header-anchor" href="#async-chunk-css-code-splitting" aria-label="Permalink to &quot;Async Chunk CSS Code Splitting&quot;">â€‹</a></h4><p>é»˜è®¤æŠŠAsync Chunk ä¸­å¼•å…¥çš„CSSï¼Œä¹Ÿåˆ†å‰²æˆå•ç‹¬çš„cssæ–‡ä»¶ï¼Œé€šè¿‡ JSç”¨<code>&lt;link&gt;</code>æ’å…¥html (å¦‚æ‡’åŠ è½½çš„è·¯ç”±)</p><p>éæ‡’åŠ è½½çš„csséƒ½æ‰“æˆ1ä¸ªcsså§</p><h4 id="js-åˆ†å‰²" tabindex="-1">js åˆ†å‰² <a class="header-anchor" href="#js-åˆ†å‰²" aria-label="Permalink to &quot;js åˆ†å‰²&quot;">â€‹</a></h4><p>rollupå¯¹jsé‡å¤é€»è¾‘æå–åˆ° <code>common.js</code> ä¸­</p><p>è¿™æ—¶å€™çš„è¯·æ±‚é¡ºåºæ˜¯ ğŸ‘‡</p><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230103130912.png" alt=""></p><p>éœ€è¦ç­‰å¼‚æ­¥chunkåŠ è½½å¹¶è§£æå®Œæˆï¼Œæ‰å¼€å§‹è¯·æ±‚ common.js</p><p>ğŸ¤” ä½†æ˜¯ common.js ä¸€èˆ¬ä¼šåœ¨å…¥å£jsçš„æ—¶å€™å°±ä¾èµ–åˆ°å¹¶åŠ è½½äº†å§</p><p>Vite é€šè¿‡ä¸€ä¸ªé¢„åŠ è½½æ­¥éª¤è‡ªåŠ¨é‡å†™ä»£ç ï¼Œæ¥åˆ†å‰²åŠ¨æ€å¯¼å…¥è°ƒç”¨ï¼Œä»¥å®ç°å½“ A è¢«è¯·æ±‚æ—¶ï¼ŒC ä¹Ÿå°† åŒæ—¶ è¢«è¯·æ±‚</p><p>common.js ä¹Ÿå¯èƒ½æœ‰æ›´æ·±çš„å¯¼å…¥ï¼Œåœ¨æœªä¼˜åŒ–çš„åœºæ™¯ä¸­ï¼Œè¿™ä¼šå¯¼è‡´æ›´å¤šçš„ç½‘ç»œå¾€è¿”ã€‚Vite çš„ä¼˜åŒ–ä¼šè·Ÿè¸ªæ‰€æœ‰çš„ç›´æ¥å¯¼å…¥ï¼Œæ— è®ºå¯¼å…¥çš„æ·±åº¦å¦‚ä½•ï¼Œéƒ½èƒ½å¤Ÿå®Œå…¨æ¶ˆé™¤ä¸å¿…è¦çš„å¾€è¿”</p><p>ğŸ¤” TODO: ä»€ä¹ˆåŸç†</p><h4 id="modulepreload" tabindex="-1">modulepreload <a class="header-anchor" href="#modulepreload" aria-label="Permalink to &quot;modulepreload&quot;">â€‹</a></h4><p>Vite ä¼šä¸ºå…¥å£ <code>chunk</code> å’Œå®ƒä»¬åœ¨æ‰“åŒ…å‡ºçš„ <code>HTML</code> ä¸­çš„ç›´æ¥å¼•å…¥è‡ªåŠ¨ç”Ÿæˆ <code>&lt;link rel=&quot;modulepreload&quot;&gt;</code> æŒ‡ä»¤ã€‚</p><p>ğŸ¤” ä»€ä¹ˆåŸç†ï¼Ÿå¤„ç†çš„æ˜¯ä»€ä¹ˆåœºæ™¯</p><ul><li><a href="https://zhuanlan.zhihu.com/p/388537104" target="_blank" rel="noreferrer">ç¿»è¯‘ç¯‡ - ES æ¨¡å—é¢„åŠ è½½å’Œå®Œæ•´æ€§</a></li><li><a href="https://philipwalton.com/articles/using-native-javascript-modules-in-production-today/" target="_blank" rel="noreferrer">Using Native JavaScript Modules in Production Today</a></li><li><a href="https://mp.weixin.qq.com/s/uf88myQov-t7rDqbMkF5EQ" target="_blank" rel="noreferrer">JavaScriptçš„æœªæ¥æ˜¯æ¨¡å—åŒ–ï¼Ÿ-ä¸­æ–‡</a></li></ul><p>é€šè¿‡æ‰“åŒ…å·¥å…·ç”Ÿæˆå…¥å£æ–‡ä»¶çš„æ‰€æœ‰ä¾èµ–æ–‡ä»¶æ¸…å•ï¼Œè®¾ç½®åˆ° <code>modulepreload</code> å¯ä»¥ç«‹å³è¯·æ±‚å¹¶åœ¨ä¸»çº¿ç¨‹å¤–è¿›è¡Œè§£æ</p><p>ä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥è€ƒè™‘åˆ¤æ–­å…¼å®¹æ€§ï¼Œè®©æ”¯æŒçš„æµè§ˆå™¨ç”¨ï¼Œä¸æ”¯æŒçš„åˆ™æŒ‰ç…§ä¼ ç»Ÿèµ„æºæ–¹å¼åŠ è½½</p><h2 id="ç¯å¢ƒå˜é‡-env" tabindex="-1">ç¯å¢ƒå˜é‡ env <a class="header-anchor" href="#ç¯å¢ƒå˜é‡-env" aria-label="Permalink to &quot;ç¯å¢ƒå˜é‡ env&quot;">â€‹</a></h2><p><a href="https://vitejs.dev/guide/env-and-mode.html" target="_blank" rel="noreferrer">viteå®˜æ–¹æ–‡æ¡£-env and mode</a></p><p>å…¨å±€å˜é‡æŒ‚è½½åœ¨ <code>i<wbr>mport.meta.env</code> å¯¹è±¡ä¸Š ç»è¿‡ç¼–è¯‘åï¼Œè¿è¡Œæ—¶è®¿é—®å¯¹è±¡ä¸Šçš„å±æ€§ï¼Œä¼šè¢«ç¼–è¯‘æˆå¸¸é‡è€Œä¸æ˜¯ä¸€ä¸ªå˜é‡è¯»å–ï¼Œå› æ­¤ä¸èƒ½å†™keyä¸èƒ½å†™æˆå˜é‡<code>i<wbr>mport.meta.env[key]</code> å³ï¼Œè¿è¡Œæ—¶ä¸å­˜åœ¨ <code>i<wbr>mport.meta.env</code> å¯¹è±¡</p><h3 id="build-in-å†…ç½®ç¯å¢ƒå˜é‡" tabindex="-1">build-in å†…ç½®ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#build-in-å†…ç½®ç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;build-in å†…ç½®ç¯å¢ƒå˜é‡&quot;">â€‹</a></h3>`,135),c=e("ul",null,[e("li",{string:""},[e("code",null,[s("i"),e("wbr"),s("mport.meta.env.MODE")])]),e("li",{string:""},[e("code",null,[s("i"),e("wbr"),s("mport.meta.env.BASE_URL")])]),e("li",{boolean:""},[e("code",null,[s("i"),e("wbr"),s("mport.meta.env.PROD")])]),e("li",{boolean:""},[e("code",null,[s("i"),e("wbr"),s("mport.meta.env.DEV")])]),e("li",{boolean:""},[e("code",null,[s("i"),e("wbr"),s("mport.meta.env.SSR")])]),e("li",null,"ğŸ‘† æ ¹æ®è¿è¡Œæ„å»ºè„šæœ¬æ—¶ç›¸å…³é…ç½®è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„å€¼")],-1),r=o(`<h3 id="è‡ªå®šä¹‰ç¯å¢ƒå˜é‡" tabindex="-1">è‡ªå®šä¹‰ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#è‡ªå®šä¹‰ç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;è‡ªå®šä¹‰ç¯å¢ƒå˜é‡&quot;">â€‹</a></h3><p>è‡ªåŠ¨è¯»å– <code>.env.[i<wbr>mport.meta.env.MODE]</code> æ–‡ä»¶ - ğŸ¤” è¿™ç§æ–¹å¼å¾ˆå¸¸è§ï¼Œå¤§å®¶æ˜¯éƒ½ç”¨ä¸€ä¸ªåº•å±‚åº“æ¥å®ç°å—ï¼Ÿ</p><blockquote><p><a href="https://github.com/motdotla/dotenv" target="_blank" rel="noreferrer">dotenv - github</a> is a zero-dependency module that loads environment variables from a .env file into p<wbr>rocess.env. Storing configuration in the environment separate from code is based on The <a href="http://12factor.net/config" target="_blank" rel="noreferrer">Twelve-Factor App</a> methodology.</p></blockquote><p><code>.ignoregit</code>æ–‡ä»¶ä¸­é…ç½®äº†<code>*.local</code> å› æ­¤ğŸ‘‡</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">.env</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># loaded in all cases</span></span>
<span class="line"><span style="color:#FFCB6B;">.env.local</span><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;"># loaded in all cases, ignored by git</span></span>
<span class="line"><span style="color:#FFCB6B;">.env.[mode]</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;"># only loaded in specified mode</span></span>
<span class="line"><span style="color:#FFCB6B;">.env.[mode].local</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># only loaded in specified mode, ignored by git</span></span></code></pre></div><h3 id="ç¯å¢ƒå˜é‡æ”¯æŒts" tabindex="-1">ç¯å¢ƒå˜é‡æ”¯æŒts <a class="header-anchor" href="#ç¯å¢ƒå˜é‡æ”¯æŒts" aria-label="Permalink to &quot;ç¯å¢ƒå˜é‡æ”¯æŒts&quot;">â€‹</a></h3><p>å¯ä»¥åœ¨ <code>env.d.ts</code> é‡Œé…ç½® <code>i<wbr>mport.meta.env</code> çš„å±æ€§ç±»å‹</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/// </span><span style="color:#89DDFF;font-style:italic;">&lt;</span><span style="color:#F07178;font-style:italic;">reference</span><span style="color:#89DDFF;font-style:italic;"> </span><span style="color:#C792EA;font-style:italic;">types</span><span style="color:#89DDFF;font-style:italic;">=</span><span style="color:#89DDFF;font-style:italic;">&quot;</span><span style="color:#C3E88D;font-style:italic;">vite/client</span><span style="color:#89DDFF;font-style:italic;">&quot;</span><span style="color:#89DDFF;font-style:italic;"> /&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportMetaEnv</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">readonly</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">VITE_APP_TITLE</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// more env variables...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportMeta</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">readonly</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">env</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportMetaEnv</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="è¦†ç›–æ¨¡å¼modeç›¸å…³ç¯å¢ƒå˜é‡" tabindex="-1">è¦†ç›–æ¨¡å¼modeç›¸å…³ç¯å¢ƒå˜é‡ <a class="header-anchor" href="#è¦†ç›–æ¨¡å¼modeç›¸å…³ç¯å¢ƒå˜é‡" aria-label="Permalink to &quot;è¦†ç›–æ¨¡å¼modeç›¸å…³ç¯å¢ƒå˜é‡&quot;">â€‹</a></h3><p>development/production é™¤äº†ç”¨äºæ§åˆ¶ä¸åŒçš„ç¯å¢ƒå˜é‡ï¼Œè¿˜ç”¨äºæ§åˆ¶ä¸åŒçš„æ‰“åŒ…æµç¨‹</p><ul><li>dev å¯¹åº”ç¯å¢ƒå˜é‡ i<wbr>mport.meta.env.MODE = development</li><li>build å¯¹åº”ç¯å¢ƒå˜é‡ i<wbr>mport.meta.env.MODE = production</li></ul><p>å½“buildçš„æ—¶å€™å¸Œæœ›æ‰“æˆå…¶ä»–çš„ç¯å¢ƒå˜é‡è€Œä¸æ˜¯production <code>vite build --mode xxx</code> è¯»å–çš„æ˜¯ <code>.env.xxx</code>æ–‡ä»¶</p><p>å½“å¸Œæœ›å¤šä¸ªæµ‹è¯•ç¯å¢ƒç”¨ä¸åŒçš„å˜é‡ä½†æ˜¯ç”¨åŒä¸€ç§æ‰“åŒ…æ¨¡å¼</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># .env.testing</span></span>
<span class="line"><span style="color:#A6ACCD;">NODE_ENV</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">development</span></span></code></pre></div><p>ğŸ‘† é <code>development/production</code> æ¨¡å¼æ—¶éƒ½è¦æ‰‹åŠ¨æŒ‡å®šä¸€ä¸‹ <code>NODE_ENV</code> ç”¨äºæ‰“åŒ…æµç¨‹</p><p>è¿™ä¸ªå®šä¹‰çš„æ˜¯ <code>VITE_USER_NODE_ENV</code> å˜é‡ è€Œä¸æ˜¯ <code>NODE_ENV</code></p><hr><p>ğŸ¤” <code>NODE_ENV</code> çš„å€¼åªèƒ½ç”±æ„å»ºæŒ‡ä»¤ï¼š <code>vite</code>ã€<code>vite build</code> å†³å®šï¼Ÿ</p><p><code>NODE_ENV</code> çš„å€¼ç¡®å®ç”± æ„å»ºæŒ‡ä»¤å†³å®šï¼Œä½†æ˜¯å¯¹ <code>Vite</code> æ¥è¯´envä¸­è‡ªå®šä¹‰çš„ <code>VITE_USER_NODE_ENV</code> ä¼˜å…ˆçº§ä¼šæ›´é«˜</p><p>å³: å½“æŒ‡ä»¤æ˜¯ <code>build</code> ä½†æ˜¯ <code>VITE_USER_NODE_ENV</code> æ˜¯ <code>development</code> æ—¶ <code>Vite</code> çš„æ„å»ºé€»è¾‘å°†æ˜¯ <code>dev</code> è€Œä¸æ˜¯ <code>build</code> (å¯èƒ½åªè¦æœ‰å€¼ä¸”é <code>production</code> å°±ä¼šæ˜¯ <code>dev</code>)</p><p>ä¹Ÿå°±æ˜¯è‡ªå®šä¹‰ <code>NODE_ENV=prod</code> å¯¹äº Vite æ¥è¯´å°±æ˜¯æä¾› <code>development</code> çš„æ„å»ºæ–¹å¼</p><hr><p><code>NODE_ENV</code> çš„ä½œç”¨ï¼Ÿ <code>Vite</code> å†…éƒ¨é€»è¾‘æ‰ä¼šä½¿ç”¨åˆ°ï¼Ÿå¹¶ä¸”å†…éƒ¨å…ˆå–äº† <code>VITE_USER_NODE_ENV</code> ç©ºæ—¶æ‰å– <code>NODE_ENV</code> ï¼Ÿ</p><p>ğŸ‘† ä¹Ÿå°±æ˜¯ï¼Œå¦‚æœä¸šåŠ¡ä»£ç ä¸­å¸Œæœ›ä½¿ç”¨åˆ° <code>NODE_ENV</code> ä¹Ÿè¦æœ‰è¿™æ®µä¼˜å…ˆå– <code>VITE_USER_NODE_ENV</code> çš„é€»è¾‘</p><p>ç¯å¢ƒå˜é‡æœ‰2ç§å®šä¹‰æ–¹å¼</p><ol><li>åœ¨ <code>vite.config.ts</code> ä¸­çš„ <code>defind</code> ä¸­é…ç½®</li><li>åœ¨ <code>env</code> ç›¸å…³æ–‡ä»¶ä¸­é…ç½®</li></ol><p>è¯»å–æ–¹å¼ä¹Ÿä¸åŒ</p><ol><li><code>process_env</code></li><li><code>i<wbr>mport.meta.env</code></li></ol><p>æ³¨æ„ï¼šåœ¨ <code>CommonJS</code> ä¸­æ— æ³•ä½¿ç”¨ <code>i<wbr>mport.meta.env</code> å› ä¸ºæ ¹æœ¬æ²¡æœ‰ <code>import</code> è¿™ä¸ªå…¨å±€å˜é‡</p><p>å¦‚æœæ˜¯åœ¨è¿è¡Œæ—¶ç»è¿‡ <code>ViteDevServer</code> ä¸­çš„ <code>CJS</code> ä¼šè¢«è½¬ä¸º <code>ESM</code>ï¼Œå¯èƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨</p><p>ä½†æ˜¯å½“ <code>CJS</code> æ—¶æä¾›ç»™å…¶ä»–åº“(å¦‚ <code>tailiwindCSS</code> é…ç½®æ–‡ä»¶)ä½¿ç”¨çš„ï¼Œè€Œå…¶ä»–åº“ä¸ä¼šè½¬åŒ–æˆ <code>ESM</code>ï¼Œæ›´ä¸ä¼šå¯¹ç”Ÿæˆ <code>import</code> å…¨å±€å˜é‡</p><h2 id="hmr-1" tabindex="-1">HMR <a class="header-anchor" href="#hmr-1" aria-label="Permalink to &quot;HMR&quot;">â€‹</a></h2><p><code>Vite</code> çš„ <code>HMR</code> åŠŸèƒ½ç”±å…·ä½“è¯­è¨€çš„ <code>Vite</code> æ’ä»¶ <code>plugin</code> å®ç°</p><p>å¦‚:</p><ul><li><code>.vue</code> æ–‡ä»¶çš„ <code>HMR</code> ç”± <code>@vitejs/plugin-vue</code> å®ç°</li><li><code>VueJsx</code> è¯­æ³•çš„ <code>HMR</code> ç”± <code>@vitejs/plugin-vue-jsx</code></li></ul><p>ç”¨ <code>Vite</code> åˆ›å»ºå‡ºåŸç”Ÿjså·¥ç¨‹</p><p>ä¿®æ”¹jsæ–‡ä»¶å†…å®¹ï¼Œä¼šå‘ç°æ•´ä¸ªé¡µé¢è‡ªåŠ¨åˆ·æ–°äº†ä¸€æ¬¡(<strong>å¹¶ä¸æ˜¯è‡ªåŠ¨å°±æ˜¯çƒ­æ›´æ–°ï¼Œå±€éƒ¨åˆ·æ–°æ‰æ˜¯</strong>)</p><p>è‡ªåŠ¨åˆ·æ–°æ˜¯å› ä¸º <code>viteDevServer</code> å†…ç½®äº† <code>nodejs</code> çš„æ–‡ä»¶ç›‘å¬åŠŸèƒ½ï¼Œå½“å‘ç°æ–‡ä»¶ä¿®æ”¹äº†ï¼Œå¹¶ä¸”æ²¡æœ‰ç›¸åº”çš„çƒ­æ›´æ–°é€»è¾‘ï¼Œå°†ä¼šé€šçŸ¥( <code>websocket</code> )æµè§ˆå™¨è‡ªåŠ¨åˆ·æ–°æ•´ä¸ªé¡µé¢</p><p>ğŸ‘† å¯ä»¥çœ‹å‡º <code>HMR</code> åŠŸèƒ½å¹¶ä¸ä¼šè¢« <code>Vite</code> å†…ç½®æä¾›, å³ä½¿æœ‰èƒ½åŠ›æ£€æµ‹å‡ºå˜åŒ–çš„æ–‡ä»¶( <code>Rollup</code> ä¹Ÿæ˜¯åŒç† )</p><p>ä½†æ˜¯ <code>Vite</code> æä¾›äº†ä¸€å¥—é€šç”¨çƒ­æ›´æ–°çš„ API (æŒ‚è½½åœ¨<code>i<wbr>mport.meta.hot</code>å¯¹è±¡ä¸­)</p><p>ğŸ‘‡ æŠŠ <code>create-vite</code> è‡ªåŠ¨ç”Ÿæˆçš„ç¤ºä¾‹ä»£ç ï¼Œæ”¹é€ ä¸ºè°ƒç”¨å‡½æ•°çš„å½¢å¼</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">render</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;h1&gt;Hello Vite&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">()</span></span></code></pre></div><p>ğŸ‘‡ å½“å‰æ–‡ä»¶ä¸­æ–°å¢ HMR é€»è¾‘</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// export æ‰èƒ½è¢« hot.accect å–åˆ°å¯ç”¨äºè°ƒç”¨çš„æ–°ä»£ç </span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">render</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;h1&gt;Hello Vite&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">render</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æŒ‚è½½åœ¨i<wbr>mport.metaä¸Šæ˜¯å› ä¸ºå¯ä»¥æ–¹ä¾¿çš„è·Ÿå½“å‰æ–‡ä»¶è·¯å¾„å…³è”ä¸Š</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è€Œä¸éœ€è¦æ‰‹åŠ¨è·å–æ–‡ä»¶ä¿¡æ¯æ¥å…³è”</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hot</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">accect</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newModule</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Vite watch this file change will callback hot.accect</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// and do not refresh all page in brower</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// newModule is this file ESM export</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// .Vue å°±æ˜¯ export æ•´ä¸ªç»„ä»¶å®ä¾‹ï¼Œ å› æ­¤å¯ä»¥çŒœæƒ³ plugin-vue å®ç°HMR å°±æ˜¯è°ƒç”¨æ•´ä¸ªç»„ä»¶å®ä¾‹çš„ refresh é€»è¾‘,è€Œå¹¶ä¸æ˜¯ç²¾ç¡®åˆ° .vue çš„htmléƒ¨åˆ†å„ä¸ªå°DOM</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newModule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">render</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ğŸ‘† æ³¨æ„æˆ‘ä»¬è¦å– newModule ä¸­ export çš„ render</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// è™½ç„¶åœ¨ä¸€ä¸ªä½œç”¨åŸŸ ç†è®ºä¸Šå¯ä»¥ç›´æ¥è°ƒç”¨renderï¼Œä½†æ˜¯ä¸è¡Œï¼</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å› ä¸ºç›´æ¥è°ƒç”¨çš„ render æ˜¯æ—§çš„ï¼Œå¹¶ä¸æ˜¯ä¿®æ”¹åçš„(å› ä¸ºå½“å‰æ¨¡å—æ˜¯ä¸€ä¸ªé—­åŒ…çš„ç»´åº¦ï¼Œè§¦å‘å›è°ƒæ—¶è°ƒç”¨ä¸Šä¸‹ä¸­çš„ render æ˜¯æŒ‡å‘æ—§çš„ä½œç”¨åŸŸçš„ )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>åŠ åˆ¤æ–­é€»è¾‘æ˜¯å› ä¸º <code>build</code> é˜¶æ®µï¼ŒViteä¸ä¼šæŒ‚è½½<code>hotå¯¹è±¡</code>åˆ° <code>i<wbr>mport.meta</code> ä¸­</p><p>å³: è¿™æ®µé€»è¾‘ä¹Ÿä¼šè¢«æ‰“åŒ…åˆ°ç”Ÿäº§ä»£ç ä¸­</p><h2 id="ssr" tabindex="-1">SSR <a class="header-anchor" href="#ssr" aria-label="Permalink to &quot;SSR&quot;">â€‹</a></h2><p>æœ‰äº›æ–‡ç« ä¼šè¯´å®ç° <code>SSRåº”ç”¨</code>, éœ€è¦åç«¯é…åˆ</p><p>ä½†å®é™…éœ€è¦åç«¯é…åˆçš„ <code>SSRåº”ç”¨</code> æ˜¯å‰åç«¯ä¸åˆ†ç¦»</p><p>ç°ä»£çš„ <code>SSRåº”ç”¨</code>, ä¸€èˆ¬ç”±å‰ç«¯ç¼–å†™ <code>nodejs</code> å¤„ç† <strong>SSRé£æ ¼çš„å‰ç«¯æ‰“åŒ…äº§ç‰©</strong></p><h3 id="å‰åç«¯ä¸åˆ†ç¦»çš„ssré¡¹ç›®" tabindex="-1">å‰åç«¯ä¸åˆ†ç¦»çš„SSRé¡¹ç›® <a class="header-anchor" href="#å‰åç«¯ä¸åˆ†ç¦»çš„ssré¡¹ç›®" aria-label="Permalink to &quot;å‰åç«¯ä¸åˆ†ç¦»çš„SSRé¡¹ç›®&quot;">â€‹</a></h3><p>ç”¨æˆ·æµè§ˆå™¨è®¿é—®çš„ url åœ°å€ï¼Œå¯¹åº”çš„ä¸æ˜¯ä¸€ä¸ªé™æ€æœåŠ¡å™¨çš„html, è€Œæ˜¯ä¸€ä¸ªåç«¯æœåŠ¡çš„getè¯·æ±‚</p><p>è¿™ä¸ªåç«¯æœåŠ¡çš„getè¯·æ±‚å¯¹åº”çš„htmlå†…å®¹ï¼Œç”±åç«¯(æ¨¡ç‰ˆå¼•æ“)ç¼–å†™</p><p>ä½†æ˜¯ js èµ„æºè¿˜æ˜¯ç”±å‰ç«¯å·¥ç¨‹æä¾›ï¼Œç°ä»£ Web åº”ç”¨éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªä¸»jsé€»è¾‘å¤„ç†é¡µé¢æ¸²æŸ“çš„ï¼Œå› æ­¤åªè¦ js èµ„æºæä¾›æ‰€æœ‰å¦‚å‰ç«¯è·¯ç”±ã€åŠ¨æ€æ¸²æŸ“é€»è¾‘ï¼Œè¿™ä¸ªåç«¯æœåŠ¡å°±åªéœ€è¦å¤„ç† getè¯·æ±‚åˆ°htmlçš„é€»è¾‘ï¼Œå…¶ä»–ä¸éœ€è¦å¤„ç†</p><p>ğŸ‘† å¯ä»¥çœ‹å‡ºï¼Œè¿™ç§ä¸åˆ†ç¦»çš„åœºæ™¯ï¼Œæµè§ˆå™¨æ‹¿åˆ°çš„htmlå†…å®¹ä¾ç„¶æ˜¯ç©ºçš„æ¨¡æ¿ HTML ,å¹¶ä¸æ˜¯å®é™…æ„ä¹‰ä¸Šè§£å†³ SEO é—®é¢˜çš„ SSRå‰ç«¯Web æ–¹æ¡ˆ</p><p>å› æ­¤è¿™é‡Œåªæä¸€ä¸‹ï¼Œç›¸åº”çš„å¼€å‘æ¨¡å¼ï¼Œä¸å±•å¼€è®²</p><ul><li>prod ç¯å¢ƒä¸‹ <ul><li>å‰ç«¯æŒ‰ç…§åŸæ‰“åŒ…å·¥å…·çš„æ‰“åŒ…äº§ç‰©ï¼Œæä¾›ç»™åç«¯ï¼Œé™¤äº† HTMl æ–‡ä»¶</li><li>å¹¶æä¾›ä¸€ä»½ï¼Œæ¨¡æ¿ HTML éœ€è¦åŠ è½½æ‰“åŒ…äº§ç‰©ä¸­çš„ä»€ä¹ˆèµ„æºçš„æ¸…å•ï¼Œå¦‚å…¥å£js</li><li>å‰©ä¸‹çš„ç”±åç«¯ç¼–å†™é€»è¾‘å¤„ç†æ¸…å•ç”Ÿäº§å¯¹åº”çš„htmlå†…å®¹(å…¶å®å°±æ˜¯å‰ç«¯æ‰“åŒ…äº§ç‰©ä¸­çš„HTMLçš„å†…å®¹)</li></ul></li><li>dev ç¯å¢ƒä¸‹ <ul><li>å‰ç«¯æŒ‰ç…§åŸæ‰“åŒ…å·¥å…·å¯åŠ¨ä¸€ä¸ª devServer, ä½†æ˜¯ä¸ç›´æ¥è®¿é—®è¿™ä¸ª devServer</li><li>åç«¯ç¼–å†™dev ç¯å¢ƒä¸‹, å‰ç«¯çš„æ¨¡æ¿HTMLå†…å®¹(æ‰“åŒ…å‰çš„æ¨¡æ¿HTMl) å¹¶è®¾ç½®getè¯·æ±‚, æµè§ˆå™¨è®¿é—®è¿™ä¸ª get è¯·æ±‚</li><li>åç«¯ç¼–å†™çš„HTMLå†…å®¹ï¼Œå…¥å£jsç­‰èµ„æºéœ€è¦æŒ‡å‘å‰ç«¯çš„ devServer</li><li>åç«¯éœ€è¦ä»£ç†é™æ€èµ„æº(ç›¸å¯¹è·¯å¾„è®¿é—®çš„å›¾ç‰‡ç­‰)ç›®å½•ï¼Œåˆ°å‰ç«¯ devServerï¼Œ</li></ul></li></ul><h3 id="nodejs" tabindex="-1">nodejs <a class="header-anchor" href="#nodejs" aria-label="Permalink to &quot;nodejs&quot;">â€‹</a></h3><p>æµç¨‹:</p><ul><li>nodejs SSR å®ç°çš„æ•ˆæœæ˜¯, æµè§ˆå™¨è®¿é—® URL æ—¶, ä¸å†æ˜¯è®¿é—®é™æ€æœåŠ¡å™¨ä¸Šçš„æ¨¡æ¿html</li><li>è€Œæ˜¯è®¿é—®nodejs getè¯·æ±‚, è¿™ä¸ªgetè¯·æ±‚ä¸ä»…ä»…æ˜¯è·å–æ¨¡æ¿HTMLè¿”å›,åŒæ—¶ä¼šæ‹¦æˆªè®¿é—®å¹¶å¯¹æ‰§è¡Œå‰ç«¯é€»è¾‘è®¡ç®—æ¨¡æ¿HTMLçš„å†…å®¹ï¼Œå†è¿”å›ç»™æµè§ˆå™¨, æµè§ˆå™¨æ‹¿åˆ°çš„å°†ä¼šæ˜¯æœ‰å†…å®¹çš„ HTML ,ä¸å†æ˜¯æ¨¡æ¿ HTML</li></ul><p>ğŸ‘† nodejs æ¥å¾—åˆ° HTML çš„å†…å®¹æ˜¯éš¾ç‚¹, å› ä¸ºæ¡†æ¶é»˜è®¤æä¾›çš„å„ç§æµè§ˆå™¨è¿è¡Œæ—¶é€»è¾‘ï¼Œç”± nodejs æ¥æ‰§è¡Œ, ä¼šå‡ºé—®é¢˜, å¦‚å‰ç«¯è·¯ç”±åŠŸèƒ½ã€é¡µé¢initæ—¶è°ƒç”¨æ¥å£è·å–æ•°æ®, nodejséœ€è¦æŒ‰ç…§ getè¯·æ±‚çš„è·¯å¾„å’Œå‰ç«¯è·¯ç”±é€»è¾‘æ‰¾åˆ°éœ€è¦å¯¹åº”æ‰§è¡Œçš„äº‹æƒ…, ä»¥å¾—åˆ°æ­£ç¡® HTML å†…å®¹</p><p><a href="https://vitejs.dev/guide/ssr.html" target="_blank" rel="noreferrer">Viteå®˜æ–¹æ–‡æ¡£-SSR</a></p><p>å®ç°æ­¥éª¤ï¼š</p><p>é™¤äº†ç¼–å†™ä¸€ä¸ª nodejs æœåŠ¡å¤„ç† getè¯·æ±‚</p><p>è¿˜éœ€è¦ä¿®æ”¹å…¥å£ HTML, å’Œå…¥å£ JS æ¥é…åˆ nodejs æ‰§è¡Œæ­£ç¡®çš„è®¡ç®— HTML å†…å®¹çš„é€»è¾‘</p><p>å…¥å£ JS éœ€è¦å¼•å…¥nodejsç¯å¢ƒçš„è·¯ç”±é€»è¾‘ï¼Œè€Œä¸æ˜¯å‰ç«¯çš„åŸè·¯ç”±</p><p>ä½¿ç”¨ express æˆ–æ˜¯ koa ç­‰ nodejsé™æ€æœåŠ¡åŠŸèƒ½</p><p>ä¹Ÿæ­£æ˜¯å› ä¸ºæŠŠæµè§ˆå™¨çš„é€»è¾‘è½¬ç§»åˆ°nodejsä¸­ï¼Œéœ€è¦å¤„ç†çš„æƒ…å†µæ˜¯å¾ˆå¤šçš„ï¼Œå› æ­¤SSRæ–¹æ¡ˆçš„å®ç°ä¸€èˆ¬éƒ½å¾—å†å¥—ä¸€å±‚æ¡†æ¶(ä¸€èˆ¬ä¸å½±å“ä¸šåŠ¡ä»£ç ,ä»…ä»æ‰“åŒ…é€šç”¨å…¥å£ç­‰åœ°æ–¹å…¥æ‰‹)ï¼Œå¦‚ <code>Nuxtjs</code>ã€<code>Nextjs</code>ç­‰</p><p>ğŸ‘‡ çš„SSRä¹Ÿæ˜¯åŒç†ï¼Œå¦‚ <code>VitePress</code></p><h2 id="ssg" tabindex="-1">SSG <a class="header-anchor" href="#ssg" aria-label="Permalink to &quot;SSG&quot;">â€‹</a></h2><p>åŒæ ·ä½¿ç”¨ğŸ‘† SSR çš„ nodejs è®¡ç®— HTML å†…å®¹çš„é€»è¾‘</p><p>prerender</p><p>å¤šå…¥å£(æ‰€æœ‰è·¯ç”±)è®¡ç®— HTML å†…å®¹</p><p>å¾—åˆ°ç±»ä¼¼å¤šé¡µé¢åº”ç”¨çš„å¤š HTMLçš„æ‰“åŒ…äº§ç‰©, æ”¾åˆ°é™æ€èµ„æºæœåŠ¡å™¨é‡Œç›´æ¥è®¿é—®(ä¸æ˜¯ getè¯·æ±‚)</p>`,74),i=[p,c,r];function d(u,y,h,D,m,b){return l(),t("div",null,i)}const v=a(n,[["render",d]]);export{C as __pageData,v as default};
