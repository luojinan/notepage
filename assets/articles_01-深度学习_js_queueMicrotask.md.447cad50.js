import{_ as s,o as a,c as o,V as n}from"./chunks/framework.b450deef.js";const d=JSON.parse('{"title":"queueMicrotask","description":"","frontmatter":{},"headers":[],"relativePath":"articles/01-æ·±åº¦å­¦ä¹ /js/queueMicrotask.md","filePath":"articles/01-æ·±åº¦å­¦ä¹ /js/queueMicrotask.md"}'),l={name:"articles/01-æ·±åº¦å­¦ä¹ /js/queueMicrotask.md"},e=n(`<h1 id="queuemicrotask" tabindex="-1">queueMicrotask <a class="header-anchor" href="#queuemicrotask" aria-label="Permalink to &quot;queueMicrotask&quot;">â€‹</a></h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/HTML_DOM_API/Microtask_guide" target="_blank" rel="noreferrer">Using microtasks in JavaScript with queueMicrotask() - MDN</a></p><h2 id="jsçš„å¾®ä»»åŠ¡" tabindex="-1">jsçš„å¾®ä»»åŠ¡ <a class="header-anchor" href="#jsçš„å¾®ä»»åŠ¡" aria-label="Permalink to &quot;jsçš„å¾®ä»»åŠ¡&quot;">â€‹</a></h2><p>Browser</p><ul><li>MutationObserver</li><li>Promise.then catch finally</li><li>queueMicrotask</li></ul><p>Nodejs</p><ul><li>process.nextTick</li></ul><h2 id="queuemicrotaskçš„èƒŒæ™¯" tabindex="-1">queueMicrotaskçš„èƒŒæ™¯ <a class="header-anchor" href="#queuemicrotaskçš„èƒŒæ™¯" aria-label="Permalink to &quot;queueMicrotaskçš„èƒŒæ™¯&quot;">â€‹</a></h2><p>è™½ç„¶åœ¨è¿‡å»è¦å…¥åˆ—å¾®ä»»åŠ¡æœ‰å¯ç”¨çš„æŠ€å·§ï¼ˆæ¯”å¦‚åˆ›å»ºä¸€ä¸ªç«‹å³ <code>resolve</code> çš„ <code>promiseï¼‰</code></p><p>ä½†æ–°åŠ å…¥çš„ <code>queueMicrotask()</code> æ–¹æ³•å¢åŠ äº†ä¸€ç§æ ‡å‡†çš„æ–¹å¼ï¼Œå¯ä»¥å®‰å…¨çš„å¼•å…¥å¾®ä»»åŠ¡è€Œé¿å…ä½¿ç”¨é¢å¤–çš„æŠ€å·§</p><p>Promise çš„é—®é¢˜ï¼š</p><ul><li>å½“ä½¿ç”¨ <code>promise</code> åˆ›å»ºå¾®ä»»åŠ¡æ—¶ï¼Œç”±å›è°ƒæŠ›å‡ºçš„å¼‚å¸¸è¢«æŠ¥å‘Šä¸º <code>rejected promises</code> è€Œä¸æ˜¯æ ‡å‡†å¼‚å¸¸ <code>UnhandledPromiseRejectionWarning</code></li><li>åˆ›å»ºå’Œé”€æ¯ <code>promise</code> å¸¦æ¥äº†äº‹ä»¶å’Œå†…å­˜æ–¹é¢çš„é¢å¤–å¼€é”€ï¼Œè¿™æ˜¯æ­£ç¡®å…¥åˆ—å¾®ä»»åŠ¡çš„å‡½æ•°åº”è¯¥é¿å…çš„</li></ul><p>æä¾›æ›´åº•å±‚çš„ <code>API</code> è€Œä¸æ˜¯è®©å¤§å®¶ <code>hask</code> å…¶ä»–æ–¹å¼å®ç°æ˜¯æµè§ˆå™¨å®Œå–„çš„è¶‹åŠ¿</p><h2 id="ğŸŒ°-ä½¿ç”¨" tabindex="-1">ğŸŒ° ä½¿ç”¨ <a class="header-anchor" href="#ğŸŒ°-ä½¿ç”¨" aria-label="Permalink to &quot;ğŸŒ° ä½¿ç”¨&quot;">â€‹</a></h2><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">MyElement</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadData</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">queueMicrotask</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">_setData</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">dispatchEvent</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Event</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">arrayBuffer</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">_cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">_setData</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">dispatchEvent</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Event</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">load</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>ğŸ‘† å‡å¦‚ä¸ä½¿ç”¨ <code>queueMicrotask</code> , åœ¨è°ƒç”¨ <code>loadData()</code> ä¼šå‡ºç°2ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å¼‚æ­¥ä¸€ç§æ˜¯åŒæ­¥ï¼Œè°ƒç”¨è¡Œä¸ºå˜æˆä¸ç¡®å®šçš„äº†</p><p>æ­¤æ—¶ç»™åŒæ­¥æƒ…å†µåŒ…è£¹ <code>queueMicrotask</code> å°±å¯ä»¥è·Ÿ <code>fetch</code> è¡Œä¸ºä¸€è‡´äº†ï¼Œ<code>Promise</code> åŒç†</p><blockquote><p>è­¦å‘Šï¼š å› ä¸ºå¾®ä»»åŠ¡è‡ªèº«å¯ä»¥å…¥åˆ—æ›´å¤šçš„å¾®ä»»åŠ¡ï¼Œä¸”äº‹ä»¶å¾ªç¯ä¼šæŒç»­å¤„ç†å¾®ä»»åŠ¡ç›´è‡³é˜Ÿåˆ—ä¸ºç©ºï¼Œé‚£ä¹ˆå°±å­˜åœ¨ä¸€ç§ä½¿å¾—äº‹ä»¶å¾ªç¯æ— å°½å¤„ç†å¾®ä»»åŠ¡çš„çœŸå®é£é™©ã€‚å¦‚ä½•å¤„ç†é€’å½’å¢åŠ å¾®ä»»åŠ¡æ˜¯è¦è°¨æ…è€Œè¡Œçš„ã€‚</p></blockquote><p>â€œå®ç°ä¸€ä¸ª Promiseâ€ åœ¨å®ç°æ—¶ä¹Ÿè®¸å¯ä»¥é‡‡ç”¨ <code>queueMicrotask()</code></p>`,19),p=[e];function t(c,r,F,y,i,D){return a(),o("div",null,p)}const A=s(l,[["render",t]]);export{d as __pageData,A as default};
