import{_ as e,o,c as n,V as c}from"./chunks/framework.b450deef.js";const k=JSON.parse('{"title":"npm yarn pnpm","description":"","frontmatter":{},"headers":[],"relativePath":"articles/03-æ¶æ„/è®¾è®¡/npm-yarn-pnpm.md","filePath":"articles/03-æ¶æ„/è®¾è®¡/npm-yarn-pnpm.md"}'),a={name:"articles/03-æ¶æ„/è®¾è®¡/npm-yarn-pnpm.md"},s=c(`<h1 id="npm-yarn-pnpm" tabindex="-1">npm yarn pnpm <a class="header-anchor" href="#npm-yarn-pnpm" aria-label="Permalink to &quot;npm yarn pnpm&quot;">â€‹</a></h1><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230309224003.png" alt=""></p><blockquote><p>keys: <code>å¹½çµä¾èµ–</code>ã€<code>åˆ†èº«ä¾èµ–</code>ã€<code>npm ci</code>ã€<code>lockfiles</code>ã€<code>hardlink</code>ã€<code>softlink</code></p></blockquote><h2 id="npm-install-æ‰§è¡Œæµç¨‹" tabindex="-1">npm install æ‰§è¡Œæµç¨‹ <a class="header-anchor" href="#npm-install-æ‰§è¡Œæµç¨‹" aria-label="Permalink to &quot;npm install æ‰§è¡Œæµç¨‹&quot;">â€‹</a></h2><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230112160326.png" alt=""></p><ol><li>æ£€æŸ¥ npm çš„ç¯å¢ƒé…ç½®(<code>.npmrc</code>) <ul><li>ä¸€èˆ¬éƒ½æ˜¯é»˜è®¤çš„å®‰è£…npmæ—¶çš„ç”µè„‘é…ç½®</li><li>æ‰‹åŠ¨è®¾ç½®ä¸€èˆ¬åªä¼šè®¾ç½® <code>npm</code> æºï¼Œå¦‚è®¾ç½®æˆæ·˜å®é•œåƒ</li><li>é…ç½®ä¼˜å…ˆçº§: <code>é¡¹ç›®çº§çš„.npmrcæ–‡ä»¶ &gt; ç”¨æˆ·çº§çš„ .npmrcæ–‡ä»¶ &gt; å…¨å±€çº§çš„ .npmrc &gt; npmå†…ç½®çš„ .npmrc æ–‡ä»¶</code></li></ul></li><li>æ£€æŸ¥ <code>lockfiles</code><ul><li>å¹¶ä¸æ˜¯æ£€æŸ¥ <code>lockfiles</code> æ˜¯å¦å­˜åœ¨, âŒ æœ‰ <code>lockfiles</code> å°±æŒ‰ç…§è¯¥æ–‡ä»¶å®‰è£…ä¾èµ–</li><li>è€Œæ˜¯æ£€æŸ¥ <code>lockfiles</code> ä¸­çš„ä¾èµ–æ¸…å•, æ˜¯å¦å’Œ <code>package.json</code> ä¸­çš„ä¾èµ–æ¸…å•ä¸€è‡´</li><li>ä¸€è‡´, åˆ™æŒ‰ç…§ <code>lockfiles</code> çš„ä¾èµ–æ¸…å•å®‰è£…ä¾èµ–</li><li>ä¸ä¸€è‡´, ä¸åŒç‰ˆæœ¬çš„ npm åšçš„äº‹æƒ…ä¸ä¸€æ · <ul><li>npm v5.0x ä¸ä¸€è‡´å°±ç›´æ¥ä»¥ <code>package.json</code> ä¾èµ–æ¸…å•ä¸ºå‡†</li><li>npm v5.1.0 - v5.4.2 ä¸ä¸€è‡´ TODO: çœ‹ä¸æ‡‚</li><li>npm v5.4.2 ä»¥ä¸Š åˆ¤æ–­ <code>package.json</code> ä¾èµ–æ¸…å•å®šä¹‰çš„ç‰ˆæœ¬å…è®¸ <code>lockfiles</code> ä¸­çš„ä¾èµ–ç‰ˆæœ¬, åˆ™æŒ‰ <code>lockfiles</code> å®‰è£…, å¦‚æœä¸å…è®¸åˆ™æŒ‰ <code>package.json</code> å®‰è£…</li></ul></li></ul></li><li>éå†è·å–è¿œç¨‹ä¾èµ–åŒ…ä¿¡æ¯, æ„å»ºè¯¥ä¾èµ–åŒ…çš„ä¾èµ–æ ‘ä¿¡æ¯(TODO: ä¸‹è½½å‰è¿˜æœ‰ä¸€ä¸ªä»…è·å–ä¾èµ–ä¿¡æ¯çš„ç½‘ç»œè¯·æ±‚?)ï¼ŒæŠŠä¾èµ–åˆ†æåçš„ä¾èµ–æ ‘æ‰å¹³åŒ–æœ‰åˆ©äºå»é‡(ä¾èµ–åå’Œç‰ˆæœ¬éƒ½è¦ç›¸åŒ)</li><li>æ£€æŸ¥ç›¸åº”ç¼“å­˜, æœ‰åˆ™å–ç¼“å­˜, æ— åˆ™è¿œç¨‹ä¸‹è½½(ä¸æ˜¯åˆ¤æ–­é¡¹ç›®å†…node_modulesç¼“å­˜, è€Œæ˜¯ç”µè„‘å…¨å±€çš„ <code>store</code> é€šè¿‡ <code>npm config get cache</code>æŸ¥çœ‹) ä¸‹è½½ä»¥åŠå–ç¼“å­˜çš„éƒ½æ˜¯å‹ç¼©åŒ…,è¿˜æœ‰ä¸€ä¸ªè§£å‹æ­¥éª¤</li><li>ç”Ÿæˆ <code>lockfiles</code></li></ol><p>ğŸ¤” æœ‰äº›ä¾èµ–æŒ‰ lock å®‰è£… æœ‰äº›ä¾èµ–æŒ‰ <code>package.json</code> å®‰è£…å—ï¼Ÿ è¿˜æ˜¯è¦ä¹ˆæŒ‰ <code>package.json</code> è¦ä¹ˆæŒ‰ <code>lockfiles</code></p><h2 id="npm-yarn-æ‰å¹³åŒ–æ–¹æ¡ˆ" tabindex="-1">npm/yarn æ‰å¹³åŒ–æ–¹æ¡ˆ <a class="header-anchor" href="#npm-yarn-æ‰å¹³åŒ–æ–¹æ¡ˆ" aria-label="Permalink to &quot;npm/yarn æ‰å¹³åŒ–æ–¹æ¡ˆ&quot;">â€‹</a></h2><blockquote><p>ğŸ‘† çš„æµç¨‹å›¾é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ° <code>æ„å»ºä¾èµ–æ ‘</code> æœ‰<code>æ‰å¹³åŒ–</code>çš„æ“ä½œ</p></blockquote><p>å…¶å®æ—©æœŸçš„ <code>npm</code> å¹¶ä¸æ˜¯æ‰å¹³åŒ–ä¾èµ–, è€Œæ˜¯ä¿ç•™ä¾èµ–å…³ç³»çš„æ ‘çŠ¶åµŒå¥—ç»“æ„</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€â”€ A@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">â”‚   â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”‚       â””â”€â”€ B@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€â”€ C@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">        â””â”€â”€ B@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        â””â”€â”€ D@1.0.0</span></span></code></pre></div><p>ğŸ‘‡ è¿™ç§æ ‘çŠ¶ç»“æ„çš„æ˜æ˜¾é—®é¢˜æ˜¯: ä¸åŒçˆ¶çº§èŠ‚ç‚¹çš„ç›¸åŒå­ä¾èµ–é‡å¤å®‰è£…äº†(è€Œå‰ç«¯åº“çš„ä¾èµ–ç»“æ„åµŒå¥—æ˜¯éå¸¸å¤¸å¼ çš„ï¼ğŸ”¥) <img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230309225108.png" alt=""></p><p>åæ¥ <code>yarn</code> é‡‡ç”¨æ‰å¹³ <code>node_modules</code> ç»“æ„è§£å†³é‡å¤å®‰è£…çš„é—®é¢˜, è€Œ <code>npm</code> ä¹Ÿè·Ÿè¿›æˆäº†æ‰å¹³ç»“æ„</p><p><strong>æ‰å¹³ç»“æ„ä¾èµ–è§£å†³äº†ä¸€äº›é—®é¢˜ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜</strong> ğŸ¤”ï¸</p><h3 id="æ‰å¹³åŒ–è§£å†³äº†æ ‘çŠ¶ç»“æ„é—®é¢˜" tabindex="-1">æ‰å¹³åŒ–è§£å†³äº†æ ‘çŠ¶ç»“æ„é—®é¢˜ <a class="header-anchor" href="#æ‰å¹³åŒ–è§£å†³äº†æ ‘çŠ¶ç»“æ„é—®é¢˜" aria-label="Permalink to &quot;æ‰å¹³åŒ–è§£å†³äº†æ ‘çŠ¶ç»“æ„é—®é¢˜&quot;">â€‹</a></h3><ul><li>é‡å¤å®‰è£…</li><li>ä¾èµ–å±‚çº§å¤ªæ·±, è·¯å¾„è¿‡é•¿, windowsç³»ç»Ÿä¼šå‡ºç°ä¸€äº›é—®é¢˜</li></ul><h3 id="æ‰å¹³åŒ–ä¾èµ–å¸¦æ¥äº†æ–°é—®é¢˜" tabindex="-1">æ‰å¹³åŒ–ä¾èµ–å¸¦æ¥äº†æ–°é—®é¢˜ <a class="header-anchor" href="#æ‰å¹³åŒ–ä¾èµ–å¸¦æ¥äº†æ–°é—®é¢˜" aria-label="Permalink to &quot;æ‰å¹³åŒ–ä¾èµ–å¸¦æ¥äº†æ–°é—®é¢˜&quot;">â€‹</a></h3><ul><li><code>å¹½çµä¾èµ–</code>é—®é¢˜: é¡¹ç›®çš„ <code>package.json</code> ä¸­æ²¡æœ‰å¼•ç”¨çš„ä¾èµ–ï¼Œå‡ºç°åœ¨ <code>node_modules</code> ç›®å½•ä¸‹, æ­¤æ—¶é¡¹ç›®å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ä¾èµ–(ä¹Ÿå°±æ˜¯ <code>package.json</code> ä¸èƒ½æè¿°å‡†ç¡®ä¾èµ–æ¸…å•äº†, è¿™ç›´æ¥è¿åäº† <code>package.json</code> åŒ…ç®¡ç†çš„è®¾è®¡åˆè¡·) <ul><li>å½“æŸä¸ªä¾èµ–å‡çº§åä¸å†ä¾èµ–é‚£ä¸ªå¹½çµä¾èµ–æ—¶, é¡¹ç›®å†…å¦‚æœä½¿ç”¨äº†, å°†æŠ¥é”™</li><li>ä¸äº†è§£å¹½çµä¾èµ–çš„å…·ä½“ç‰ˆæœ¬, å¦‚å¹½çµä¾èµ–ç‰ˆæœ¬è¾ƒä½, é¡¹ç›®å†…æŒ‰ç…§æœ€æ–°ç‰ˆæœ¬æ–‡æ¡£ä½¿ç”¨, å¯èƒ½æ— æ³•ä½¿ç”¨</li></ul></li><li><code>åˆ†èº«ä¾èµ–</code>é—®é¢˜: æ‰å¹³ä¾èµ–çš„å»é‡ä»…åˆ¤æ–­åŒ…åä¸åˆ¤æ–­ç‰ˆæœ¬, ä¹Ÿå°±æ˜¯åŒåä¸åŒç‰ˆæœ¬çš„ä¾èµ–ä¸ä¼šæ‰å¹³åˆ° <code>node_modules</code> , è€Œæ˜¯ä»ç„¶åµŒå¥—åˆ°å…·ä½“çš„ä¾èµ–åŒ…ç›®å½•é‡Œ(æ‰å¹³ä¾èµ–çš„åˆ¤æ–­æ˜¯å‡ºç°åŒåä¸åŒç‰ˆæœ¬æ—¶åµŒå¥—) <ul><li>é‡å¤å®‰è£…-åµŒå¥—çš„åŒ…æ²¡æœ‰æå‡å¹¶ä¸”æœ‰å¤šä¸ªæ—¶</li><li>é‡å¤çš„ <code>Typescript</code> ç±»å‹å¯èƒ½ä¸åŒä¼šäº’ç›¸å†²çª</li></ul></li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€â”€ A@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">â”‚   â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”‚       â””â”€â”€ B@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€â”€ B@2.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€â”€ C@1.0.0</span></span></code></pre></div><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€â”€ A@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€â”€ B@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€â”€ C@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">     â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">         â””â”€â”€ B@2.0.0</span></span></code></pre></div><blockquote><p>ç½‘ä¸Šå¤§éƒ¨åˆ†è¯´æ³•æ˜¯ä¼šæ ¹æ® <code>package.json</code> é‡Œé¢çš„é¡ºåºå†³å®šè°ä¼šè¢«æå‡ºæ¥ï¼Œæ”¾åœ¨å‰é¢çš„åŒ…ä¾èµ–çš„å†…å®¹ä¼šè¢«å…ˆæå‡ºæ¥</p></blockquote><blockquote><p>çœ‹æºç åï¼Œ<code>npm</code> å…¶å®ä¼šè°ƒç”¨ä¸€ä¸ªå«åš <code>localeCompare</code> çš„æ–¹æ³•å¯¹ä¾èµ–è¿›è¡Œä¸€æ¬¡æ’åºï¼Œå®é™…ä¸Šå°±æ˜¯å­—å…¸åºåœ¨å‰é¢çš„ <code>npm</code> åŒ…çš„åº•å±‚ä¾èµ–ä¼šè¢«ä¼˜å…ˆæå‡ºæ¥ã€‚</p></blockquote><p>ğŸ‘† å¯ä»¥çœ‹å‡ºå¹¶ <strong>ä¸æ˜¯å½»åº•çš„æ‰å¹³åŒ–</strong></p><blockquote><p>ğŸ¤” åº”ç”¨ä¾èµ–Aã€Bï¼ŒAä¹Ÿä¾èµ–Bï¼Œä¼šä¸ä¼šé‡å¤æ‰“åŒ…Bï¼Ÿ</p><p>å–å†³äº <code>åˆ†èº«ä¾èµ–</code> çš„åŒåæ˜¯å¦åŒç‰ˆæœ¬çš„åˆ¤æ–­, è‹¥åŒç‰ˆæœ¬ä¸ä¼šé‡å¤å®‰è£…, ä¸åŒç‰ˆæœ¬å°±ä¼š</p></blockquote><h2 id="pnpm" tabindex="-1">pnpm <a class="header-anchor" href="#pnpm" aria-label="Permalink to &quot;pnpm&quot;">â€‹</a></h2><p><code>npm/yarn</code> è™½ç„¶éƒ½èƒ½åˆ›å»º <code>è½¯/ç¡¬é“¾æ¥</code>, ä½†æ˜¯è¿™ä¸ªåŠŸèƒ½æ˜¯ç”¨äºç”¨æˆ·è‡ªå·±è®¾ç½®è¦è½¯é“¾æ¥çš„ä¾èµ–</p><p>ğŸ‘† æŒ‡ <a href="./npm-linkçš„ä½¿ç”¨.html">TODO: npm link</a></p><p>è€Œ <code>pnpm</code> åˆ™å†…éƒ¨åˆ©ç”¨ <code>è½¯/ç¡¬é“¾æ¥</code> è®¾ç½®äº†å®Œå–„çš„ä¾èµ–å­˜å‚¨æ–¹æ¡ˆ</p><h3 id="æ¦‚å¿µ-inode" tabindex="-1">æ¦‚å¿µ inode <a class="header-anchor" href="#æ¦‚å¿µ-inode" aria-label="Permalink to &quot;æ¦‚å¿µ inode&quot;">â€‹</a></h3><p><code>inode</code> æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ <code>inode</code>, åŒ…å«æ–‡ä»¶å…ƒä¿¡æ¯, å½“è®¿é—®æ–‡ä»¶æ—¶, å¯¹åº”çš„å…ƒä¿¡æ¯ä¼šè¢« copy åˆ°å†…å­˜å»å®ç°è®¿é—®</p><p><code>stat xxx.md</code> å¯ä»¥æŸ¥çœ‹å…·ä½“æ–‡ä»¶çš„å…ƒä¿¡æ¯</p><p>âœ¨ <strong>å¯ä»¥ç”¨æ¥æŒ‡å‘, ä¹Ÿå¯ä»¥æŠŠåˆ«çš„æ–‡ä»¶ä¹Ÿå®šä¹‰æˆç›¸åŒçš„</strong> <code>inode</code></p><h3 id="æ¦‚å¿µ-hard-link-link" tabindex="-1">æ¦‚å¿µ hard/link link <a class="header-anchor" href="#æ¦‚å¿µ-hard-link-link" aria-label="Permalink to &quot;æ¦‚å¿µ hard/link link&quot;">â€‹</a></h3><p><code>Linux</code> ä¸­åŒ…æ‹¬ä¸¤ç§é“¾æ¥ï¼š</p><ol><li>ç¡¬é“¾æ¥(<code>hard link</code>) <ul><li>åˆ›å»ºå¤šä¸ªç©ºæ–‡ä»¶, è¿™äº›æ–‡ä»¶çš„ <code>inode</code> ç­‰åŒäºæºæ–‡ä»¶ <code>inode</code>, æ„å‘³ç€åªè¦æºæ–‡ä»¶ä¿®æ”¹è¿™äº›ç©ºæ–‡ä»¶ä¹Ÿä¼šåŒæ­¥ä¿®æ”¹ï¼ŒåŒç†ä¿®æ”¹é“¾æ¥å†…å®¹ä¹Ÿä¼šå½±å“æºæ–‡ä»¶ä»¥åŠå…¶ä»–æ‰€æœ‰é“¾æ¥</li><li>å¹¶ä¸”è¿™ä¸ªæŒ‡å‘æ˜¯åŒå‘çš„, åªè¦é“¾æ¥æ•°é 0, æ–‡ä»¶å°±ä¸€ç›´å­˜åœ¨</li><li>å½“æºæ–‡ä»¶è¢«åˆ é™¤ï¼Œè¿™ä¸ªé“¾æ¥ä»æœ‰å†…å®¹ä¸ä¼šä¸ºç©º</li></ul></li><li>è½¯é“¾æ¥(<code>soft link</code>)ï¼Œè½¯é“¾æ¥åˆç§°ä¸ºç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰ <ul><li>åˆ›å»ºå¤šä¸ªç©ºæ–‡ä»¶, è¿™äº›æ–‡ä»¶çš„ <code>inode</code> æ˜¯æ–°çš„å”¯ä¸€çš„ <code>inode</code>, æ°¸è¿œæŒ‡å‘æºæ–‡ä»¶</li><li>å½“æºæ–‡ä»¶è¢«åˆ é™¤ï¼Œè¿™ä¸ªæŒ‡å‘ä¼šä¿ç•™ä½†æ˜¯ä¸ºç©ºï¼Œæ¢å¤æºæ–‡ä»¶å³å¯æ¢å¤å†…å®¹</li><li>è¿™ä¸ªæŒ‡å‘æ˜¯å•å‘çš„, åˆ é™¤ <code>soft link</code> ä¸å½±å“æºæ–‡ä»¶</li></ul></li></ol><h3 id="pnpm-ä¾èµ–ç»“æ„" tabindex="-1">pnpm ä¾èµ–ç»“æ„ <a class="header-anchor" href="#pnpm-ä¾èµ–ç»“æ„" aria-label="Permalink to &quot;pnpm ä¾èµ–ç»“æ„&quot;">â€‹</a></h3><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230310134808.png" alt=""></p><p><code>package.json</code>ä¸­çš„ä¾èµ–æ¸…å•æ˜¾ç¤ºåœ¨ <code>node_modules</code> ä¸‹, è¿˜æœ‰1ä¸ª <code>node_modules/.npm/</code>ç›®å½•æ ‘çŠ¶å­˜æ”¾æ‰€æœ‰ä¾èµ–(åŒ…æ‹¬åµŒå¥—çš„ä¾èµ–)</p><p>æ‰€æœ‰çš„ä¾èµ–éƒ½æ˜¯ä»å…¨å±€ <code>store</code> ç¡¬è¿æ¥åˆ°äº† <code>node_modules/.pnpm</code> ä¸‹ï¼Œç„¶åä¹‹é—´é€šè¿‡è½¯é“¾æ¥æ¥ç›¸äº’ä¾èµ–ã€‚</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€ .pnpm</span></span>
<span class="line"><span style="color:#A6ACCD;">â”‚   â””â”€ dayjs@1.10.7</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€ dayjs</span></span></code></pre></div><p>å¤–å±‚çš„æ²¡æœ‰ç‰ˆæœ¬å·</p><p><a href="https://pnpm.io/symlinked-node-modules-structure" target="_blank" rel="noreferrer">node_modulesç»“æ„ - pnpmå®˜æ–¹æ–‡æ¡£</a></p><p>æ‰å¹³åŒ–æ‰€æœ‰åµŒå¥—ä¾èµ–ï¼ŒåŒæ—¶ä¿ç•™2çº§æ ‘çŠ¶ç»“æ„ğŸ‘‡</p><p>Every file of every package inside <code>node_modules</code> is a hard link to the content-addressable store. Let&#39;s say you install <code>foo@1.0.0</code> that depends on <code>bar@1.0.0</code>. pnpm will hard link both packages to <code>node_modules</code> like this:</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€â”€ .pnpm</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”œâ”€â”€ bar@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚   â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â””â”€â”€ bar -&gt; &lt;store&gt;/bar</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚           â”œâ”€â”€ index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚           â””â”€â”€ package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">    â””â”€â”€ foo@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">            â””â”€â”€ foo -&gt; &lt;store&gt;/foo</span></span>
<span class="line"><span style="color:#A6ACCD;">                â”œâ”€â”€ index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">                â””â”€â”€ package.json</span></span></code></pre></div><p>ğŸ‘† <code>package.json</code> ä¸­ä¾èµ–äº† fooï¼Œåœ¨ <code>node_modules/.npm/</code> ä¼šæŠŠåµŒå¥—ä¾èµ–ä¹Ÿæ‰å¹³åŒ–</p><p>These are the only &quot;real&quot; files in <code>node_modules</code>. Once all the packages are hard linked to <code>node_modules</code>, symbolic links are created to build the nested dependency graph structure.</p><p>As you might have noticed, both packages are hard linked into a subfolder inside a <code>node_modules</code> folder (<code>foo@1.0.0/node_modules/foo</code>). This is needed to:</p><ol><li><strong>allow packages to import themselves.</strong> <code>foo</code> should be able to <code>require(&#39;foo/package.json&#39;)</code> or <code>import * as package from &quot;foo/package.json&quot;</code>.</li><li><strong>avoid circular symlinks.</strong> Dependencies of packages are placed in the same folder in which the dependent packages are. For Node.js it doesn&#39;t make a difference whether dependencies are inside the package&#39;s <code>node_modules</code> or in any other <code>node_modules</code> in the parent directories.</li></ol><p>ğŸ‘† æ‰å¹³åŒ–å‡ºæ¥çš„ä¾èµ–ï¼Œå†…éƒ¨å¤šä¸€å±‚ <code>node_modules/.npm/foo/node_modules</code> è¿™é‡Œå­˜æ”¾ä¾èµ–åŒ…, ä¸ºäº†å®ç° å¼•ç”¨è‡ªèº« å’Œ æ„å»ºæ ‘çŠ¶ä¾èµ–å…³ç³»</p><p>The next stage of installation is symlinking dependencies. <code>bar</code> is going to be symlinked to the <code>foo@1.0.0/node_modules</code> folder: ğŸ‘‡</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€â”€ .pnpm</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”œâ”€â”€ bar@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚   â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â””â”€â”€ bar -&gt; &lt;store&gt;/bar</span></span>
<span class="line"><span style="color:#A6ACCD;">    â””â”€â”€ foo@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">            â”œâ”€â”€ foo -&gt; &lt;store&gt;/foo</span></span>
<span class="line"><span style="color:#A6ACCD;">            â””â”€â”€ bar -&gt; ../../bar@1.0.0/node_modules/bar</span></span></code></pre></div><p>ğŸ‘† <code>foo</code> ä¾èµ– <code>bar</code>, åœ¨ <code>foo</code> å­çº§ä¸­ç”Ÿæˆè½¯è¿æ¥åˆ° æ‰å¹³åŒ–çš„ <code>bar</code></p><p>Next, direct dependencies are handled. <code>foo</code> is going to be symlinked into the root <code>node_modules</code> folder because <code>foo</code> is a dependency of the project: ğŸ‘‡</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€â”€ foo -&gt; ./.pnpm/foo@1.0.0/node_modules/foo</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€â”€ .pnpm</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”œâ”€â”€ bar@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚   â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â””â”€â”€ bar -&gt; &lt;store&gt;/bar</span></span>
<span class="line"><span style="color:#A6ACCD;">    â””â”€â”€ foo@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">            â”œâ”€â”€ foo -&gt; &lt;store&gt;/foo</span></span>
<span class="line"><span style="color:#A6ACCD;">            â””â”€â”€ bar -&gt; ../../bar@1.0.0/node_modules/bar</span></span></code></pre></div><p>ğŸ‘† æœ€ç»ˆå†æŠŠ <code>package.json</code> ç›´æ¥ä¾èµ–çš„åŒ…åœ¨å¤–å±‚ <code>node_modules</code> åˆ›å»ºè½¯è¿æ¥åˆ° <code>/.pnpm</code></p><p>This is a very simple example. However, the layout will maintain this structure regardless of the number of dependencies and the depth of the dependency graph.</p><p>Let&#39;s add <code>qar@2.0.0</code> as a dependency of <code>bar</code> and <code>foo</code>. This is how the new structure will look: ğŸ‘‡</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">â”œâ”€â”€ foo -&gt; ./.pnpm/foo@1.0.0/node_modules/foo</span></span>
<span class="line"><span style="color:#A6ACCD;">â””â”€â”€ .pnpm</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”œâ”€â”€ bar@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚   â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â”œâ”€â”€ bar -&gt; &lt;store&gt;/bar</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â””â”€â”€ qar -&gt; ../../qar@2.0.0/node_modules/qar</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”œâ”€â”€ foo@1.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚   â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â”œâ”€â”€ foo -&gt; &lt;store&gt;/foo</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â”œâ”€â”€ bar -&gt; ../../bar@1.0.0/node_modules/bar</span></span>
<span class="line"><span style="color:#A6ACCD;">    â”‚       â””â”€â”€ qar -&gt; ../../qar@2.0.0/node_modules/qar</span></span>
<span class="line"><span style="color:#A6ACCD;">    â””â”€â”€ qar@2.0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        â””â”€â”€ node_modules</span></span>
<span class="line"><span style="color:#A6ACCD;">            â””â”€â”€ qar -&gt; &lt;store&gt;/qar</span></span></code></pre></div><p>ğŸ‘† è€Œå‡è®¾æ˜¯ 3çº§åµŒå¥—çš„ä¾èµ–ï¼Œä¼šç”±<code>.npm/</code> å±‚çš„ä¾èµ–æ„å»ºå…³ç³»ï¼Œæœ€ç»ˆä¹Ÿåªä¼šç”±2çº§ï¼Œè€Œä¸ä¼šæ— é™åµŒå¥— âœ¨</p><p>As you may see, even though the graph is deeper now (<code>foo &gt; bar &gt; qar</code>), the directory depth in the file system is still the same.</p><p>This layout might look weird at first glance, but it is completely compatible with Node&#39;s module resolution algorithm! When resolving modules, Node ignores symlinks, so when <code>bar</code> is required from <code>foo@1.0.0/node_modules/foo/index.js</code>, Node does not use <code>bar</code> at <code>foo@1.0.0/node_modules/bar</code>, but instead, <code>bar</code> is resolved to its real location (<code>bar@1.0.0/node_modules/bar</code>). As a consequence, <code>bar</code> can also resolve its dependencies which are in <code>bar@1.0.0/node_modules</code>.</p><p>ğŸ‘† çœ‹èµ·ä¼šæœ‰ç‚¹æ··ä¹±ï¼Œä½†å…¶å®å®Œå…¨ç¬¦åˆ <code>nodejs</code> , ä¸”èƒ½å¾ˆå¥½çš„å°±è§£å†³ <code>å¹½çµä¾èµ–</code> å’Œ <code>åˆ©ç”¨å…¨å±€ç¼“å­˜</code> ç­‰é—®é¢˜</p><p>A great bonus of this layout is that only packages that are really in the dependencies are accessible. With a flattened <code>node_modules</code> structure, all hoisted packages are accessible.</p><h3 id="pnpm-install-å®‰è£…è¿‡ç¨‹" tabindex="-1">pnpm install å®‰è£…è¿‡ç¨‹ <a class="header-anchor" href="#pnpm-install-å®‰è£…è¿‡ç¨‹" aria-label="Permalink to &quot;pnpm install å®‰è£…è¿‡ç¨‹&quot;">â€‹</a></h3><p><code>pnpm install</code> å®‰è£…æ—¶ä¼šåˆ¤æ–­å…¨å±€çš„ <code>store</code> ä¸­æ˜¯å¦å·²å­˜åœ¨å¯¹åº”çš„ä¾èµ–</p><ul><li>å­˜åœ¨åˆ™åœ¨ <code>node_modules/.pnpm</code> åˆ›å»ºä¸€ä¸ª <code>hard link</code></li><li>ä¸å­˜åœ¨åˆ™ä¸‹è½½ å¹¶å®‰è£…åˆ° <code>store</code> ä¸­, é¡¹ç›®ä¸­çš„ <code>node_modules/.pnpm</code> ä¾ç„¶åˆ›å»ºçš„æ˜¯ä¸€ä¸ª <code>hard link</code></li></ul><p>æŒ‰ç…§ğŸ‘†çš„è¯´æ³•, <code>node_modules/.pnpm</code> å†…éƒ¨åº”è¯¥å…¨éƒ½æ˜¯ <code>hard link</code></p><h3 id="pnpm-ç›®å½•è§£å†³-å¹½çµä¾èµ–-é—®é¢˜" tabindex="-1"><code>/.pnpm/</code>ç›®å½•è§£å†³ å¹½çµä¾èµ– é—®é¢˜ <a class="header-anchor" href="#pnpm-ç›®å½•è§£å†³-å¹½çµä¾èµ–-é—®é¢˜" aria-label="Permalink to &quot;\`/.pnpm/\`ç›®å½•è§£å†³ å¹½çµä¾èµ– é—®é¢˜&quot;">â€‹</a></h3><p><code>node_modules</code> å¤–å±‚(é <code>.pnpm/</code> ç›®å½•ä¸‹çš„ä¾èµ–åŒ…), åªæœ‰ <code>package.json</code> ä¸­ä¾èµ–æ¸…å•ä¸­å¯¹åº”çš„åŒ…</p><p>è€Œ ä¸Šé¢æåˆ°æ‰å¹³åŒ–ç»“æ„å¯¼è‡´çš„ <code>å¹½çµä¾èµ–</code> é—®é¢˜, é <code>package.json</code> ä¸­çš„ä¾èµ–åœ¨ <code>node_modules/.pnpm</code> ä¸­æ‰æœ‰, åœ¨ <code>node_modules</code> ä¸‹æ²¡æœ‰</p><p>å› æ­¤æŒ‰ç…§ <code>nodejs</code> å¯¹ <code>bare module</code> å‘ä¸Šå¯»å€æ˜¯æ‰¾ä¸åˆ°ä¾èµ–çš„, é¡¹ç›®å†…ä½¿ç”¨å°±ä¼šæŠ¥é”™, ä¹Ÿå°±è§£å†³äº† <code>å¹½çµä¾èµ–</code> çš„é—®é¢˜</p><p>å¹¶ä¸”å¤–å±‚çš„ <code>package.json</code> ä¾èµ–åŒ…, æ˜¯ <code>soft link</code> åˆ° <code>node_modules/.pnpm</code>çš„å¯¹åº”ä¾èµ–, ä¹Ÿå°±æ˜¯å¤–å±‚å’Œå†…å±‚éƒ½æœ‰, ä½†æ˜¯éƒ½æ˜¯ <code>link</code></p><p>ğŸ¤” ä¸ºä»€ä¹ˆä¸æ˜¯ <code>hard link</code></p><h3 id="è§£å†³åˆ†èº«ä¾èµ–é—®é¢˜" tabindex="-1">è§£å†³åˆ†èº«ä¾èµ–é—®é¢˜ <a class="header-anchor" href="#è§£å†³åˆ†èº«ä¾èµ–é—®é¢˜" aria-label="Permalink to &quot;è§£å†³åˆ†èº«ä¾èµ–é—®é¢˜&quot;">â€‹</a></h3><p>ä¸Šé¢æåˆ° <code>npm/yarn</code> çš„ä¾èµ–æ˜¯ä¸å½»åº•çš„æ‰å¹³åŒ–, å½“ä¾èµ–åŒåä¸åŒç‰ˆæœ¬æ—¶, ä¼šå®‰è£…åˆ°å„è‡ªä¾èµ–å†…éƒ¨</p><p><code>pnpm</code> å®‰è£…çš„ <code>node_modules/.pnpm</code> æ˜¯åµŒå¥—ç»“æ„, è¿ä¸å½»åº•çš„æ‰å¹³éƒ½ä¸è€ƒè™‘</p><p><code>pnpm</code> åœ¨å¤–å±‚ åç§° ä¸å¸¦ç‰ˆæœ¬</p><p>ä½†æ˜¯ <code>store</code> ä»¥åŠ <code>node_modules/.pnpm</code> ä¸­çš„ä¾èµ–åŒ…åæ˜¯å¸¦ç‰ˆæœ¬çš„</p><p>ä¾èµ–åŒå(åŒ…æ‹¬ç‰ˆæœ¬), ä¼šå®‰è£…åˆ°å„è‡ªä¾èµ–å†…éƒ¨, è¿™ä¼šæ˜¯ä¸€ä¸ª <code>soft link</code> ç›´æ¥å– <code>node_modules/.pnpm</code> ä¸­çš„ä¾èµ–( <code>hard link</code> åˆ° <code>store</code> )</p><p>âœ¨ <strong>çœŸå®ä¾èµ–æ–‡ä»¶å…¨å±€åªä¿å­˜1ä»½ï¼Œé¡¹ç›®ä¾èµ–ç»“æ„é‡Œçš„éƒ½æ˜¯è½¯ç¡¬è¿æ¥</strong></p><p>è¿™å°±è§£å†³äº†é‡å¤å®‰è£…çš„é—®é¢˜</p><h3 id="æ›´å¿«çš„åŸå› " tabindex="-1">æ›´å¿«çš„åŸå›  <a class="header-anchor" href="#æ›´å¿«çš„åŸå› " aria-label="Permalink to &quot;æ›´å¿«çš„åŸå› &quot;">â€‹</a></h3><ul><li><code>npm/yarn</code> ä¹Ÿåœ¨æœ¬åœ°æœ‰ç¼“å­˜, ä½†æ˜¯ <code>pnpm</code> ä¾ç„¶æ¯”ä»–ä»¬å¿«ã€‚æ˜¯å› ä¸º <code>npm/yarn</code> å–åˆ°ç¼“å­˜,è¿˜éœ€è¦è§£å‹å¹¶å¤åˆ¶æ–‡ä»¶åˆ°é¡¹ç›®å†…ï¼Œè€Œ <code>pnpm</code> åªç”¨åˆ›å»º <code>hard link</code></li><li>é¦–æ¬¡å®‰è£…ä¾èµ– <code>pnpm</code> ä¹Ÿæ¯” <code>npm/yarn</code> å¿« åˆ™æ˜¯å› ä¸º <code>pnpm</code> å¯èƒ½æœ‰ç¼“å­˜åµŒå¥—ä¾èµ–, è€Œ <code>npm/yarn</code> ç¼“å­˜åµŒå¥—ä¾èµ–çš„æœºåˆ¶æ²¡æœ‰è¿™ä¹ˆå…¨é¢</li></ul><h3 id="åŒ…å­˜å‚¨åœ¨äº†-store-ä¸­-ä¸ºä»€ä¹ˆæˆ‘çš„-node-modules-è¿˜æ˜¯å ç”¨äº†ç£ç›˜ç©ºé—´" tabindex="-1">åŒ…å­˜å‚¨åœ¨äº† <code>store</code> ä¸­ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„ <code>node_modules</code> è¿˜æ˜¯å ç”¨äº†ç£ç›˜ç©ºé—´ï¼Ÿ <a class="header-anchor" href="#åŒ…å­˜å‚¨åœ¨äº†-store-ä¸­-ä¸ºä»€ä¹ˆæˆ‘çš„-node-modules-è¿˜æ˜¯å ç”¨äº†ç£ç›˜ç©ºé—´" aria-label="Permalink to &quot;åŒ…å­˜å‚¨åœ¨äº† \`store\` ä¸­ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„  \`node_modules\`  è¿˜æ˜¯å ç”¨äº†ç£ç›˜ç©ºé—´ï¼Ÿ&quot;">â€‹</a></h3><p><code>pnpm</code> åˆ›å»ºä» <code>store</code> åˆ°é¡¹ç›®ä¸‹ <code>node_modules</code> æ–‡ä»¶å¤¹çš„ç¡¬é“¾æ¥ï¼Œä½†æ˜¯ç¡¬é“¾æ¥æœ¬è´¨è¿˜æ˜¯å’ŒåŸå§‹æ–‡ä»¶å…±äº«çš„æ˜¯ç›¸åŒçš„ <code>inode</code></p><p>å› æ­¤ï¼Œå®ƒä»¬äºŒè€…å…¶å®æ˜¯å…±äº«åŒä¸€ä¸ªç©ºé—´çš„ï¼Œçœ‹èµ·æ¥å ç”¨äº† <code>node_modules</code> çš„ç©ºé—´</p><p>æ‰€æœ‰å§‹ç»ˆåªä¼šå ç”¨ä¸€ä»½ç©ºé—´ï¼Œè€Œä¸æ˜¯ä¸¤ä»½</p><h3 id="pnpmä¸è¶³ä¹‹å¤„" tabindex="-1">pnpmä¸è¶³ä¹‹å¤„ <a class="header-anchor" href="#pnpmä¸è¶³ä¹‹å¤„" aria-label="Permalink to &quot;pnpmä¸è¶³ä¹‹å¤„&quot;">â€‹</a></h3><ol><li>å…¨å±€ <code>hardlink</code> ä¹Ÿä¼šå¯¼è‡´ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚æ”¹äº† <code>link</code> çš„ä»£ç ï¼Œæ‰€æœ‰é¡¹ç›®éƒ½å—å½±å“ï¼›å¯¹ <code>postinstall</code> ä¸å‹å¥½ï¼›åœ¨ <code>postinstall</code> é‡Œä¿®æ”¹äº†ä»£ç ï¼Œå¯èƒ½å¯¼è‡´å…¶ä»–é¡¹ç›®å‡ºé—®é¢˜</li></ol><blockquote><p>ğŸ‘† pnpm æœ‰è€ƒè™‘è¿™ç§é—®é¢˜, é»˜è®¤å…¶å®æ˜¯ <a href="https://pnpm.io/npmrc#package-import-method" target="_blank" rel="noreferrer">clone(copy on write)</a> è€Œä¸æ˜¯ <code>hard link</code>ï¼Œä½†æ˜¯ <code>clone</code> çš„æ–¹å¼å¯¹ <code>mac</code> æ²¡ç”Ÿæ•ˆï¼Œå› æ­¤ <code>fall back</code> äº† <code>hard link</code>, æ–‡æ¡£ä¸­åˆ—å‡ºäº†è¿™ä¸ªå±äº <code>Nodejs</code> çš„ <code>bug</code>, å½“è¿™ä¸ªé—®é¢˜è¢«ä¿®å¤ï¼Œä»¥åéƒ½ä¼šæ˜¯ <code>clone</code> è€Œä¸æ˜¯ <code>hard-link</code></p></blockquote><ol start="2"><li>ç”±äº <code>pnpm</code> åˆ›å»ºçš„ <code>node_modules</code> ä¾èµ–è½¯é“¾æ¥ï¼Œå› æ­¤åœ¨ä¸æ”¯æŒè½¯é“¾æ¥çš„ç¯å¢ƒä¸­ï¼Œæ— æ³•ä½¿ç”¨ <code>pnpm</code>ï¼Œæ¯”å¦‚ <code>Electron</code> åº”ç”¨</li></ol><h2 id="æ‰€æœ‰ä¾èµ–å®‰è£…åˆ°-dependencies-ä¸åŒºåˆ†devä¼šæœ‰ä»€ä¹ˆé—®é¢˜" tabindex="-1">æ‰€æœ‰ä¾èµ–å®‰è£…åˆ° dependencies ä¸åŒºåˆ†devä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ <a class="header-anchor" href="#æ‰€æœ‰ä¾èµ–å®‰è£…åˆ°-dependencies-ä¸åŒºåˆ†devä¼šæœ‰ä»€ä¹ˆé—®é¢˜" aria-label="Permalink to &quot;æ‰€æœ‰ä¾èµ–å®‰è£…åˆ° dependencies ä¸åŒºåˆ†devä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ&quot;">â€‹</a></h2><ul><li><code>dependencies</code> é¡¹ç›®ä¾èµ–</li><li><code>devDependencies</code> å¼€å‘ä¾èµ–</li><li><code>peerDependencies</code> åŒç‰ˆæœ¬çš„å»ºè®®ä¾èµ–</li><li><code>bundledDependencies</code> æ†ç»‘ä¾èµ–</li><li><code>optionalDependencies</code> å¯é€‰ä¾èµ–</li></ul><p><code>dependencies</code> è¡¨ç¤ºé¡¹ç›®ä¾èµ–ï¼Œè¿™äº›ä¾èµ–éƒ½ä¼šæˆä¸ºä½ çš„çº¿ä¸Šç”Ÿäº§ç¯å¢ƒä¸­çš„ä»£ç ç»„æˆçš„éƒ¨åˆ†ã€‚å½“ å®ƒå…³è”åˆ° <code>npm</code> åŒ…è¢«ä¸‹è½½çš„æ—¶å€™, <code>dependencies</code> ä¸‹çš„æ¨¡å—ä¹Ÿä¼šä½œä¸ºä¾èµ–, ä¸€èµ·è¢«ä¸‹è½½ã€‚</p><p>å®é™…ä¸Š, ä¾èµ–æ˜¯å¦æ˜¯è¢«æ‰“åŒ…,å®Œå…¨æ˜¯å–å†³ä½ çš„é¡¹ç›®é‡Œçš„æ˜¯å¦æ˜¯è¢«å¼•å…¥äº†è¯¥æ¨¡å—</p><p>è€Œ <code>devDependencies</code> ä¸­çš„ä¾èµ–ä¸€å®šä¸ä¼šè¢«æ‰“åŒ…çš„</p><p>ğŸ‘‡ å¾—çœ‹é¡¹ç›®</p><ul><li>å¦‚æœæ˜¯å‰ç«¯ <code>spa</code> åº”ç”¨ æˆ–è€…ä¸€æ¬¡æ€§çš„ <code>ssg</code> é¡¹ç›®å¯ä»¥è¿™æ ·åš</li><li>ä½†æ˜¯å¦‚æœæ˜¯å‘å¸ƒä¸ºä¾èµ–åº“å°±éœ€è¦ç‰¹åˆ«æ³¨æ„åˆ°åº•ä¾èµ–æ˜¯ <code>devDependencies</code> è¿˜æ˜¯ä»…ç”Ÿäº§ç¯å¢ƒä¸‹çš„ä¾èµ– <code>dependencies</code></li></ul><h2 id="åŒæ—¶ç”¨npmå’Œyarnä¼šæœ‰ä»€ä¹ˆé—®é¢˜" tabindex="-1">åŒæ—¶ç”¨npmå’Œyarnä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ <a class="header-anchor" href="#åŒæ—¶ç”¨npmå’Œyarnä¼šæœ‰ä»€ä¹ˆé—®é¢˜" aria-label="Permalink to &quot;åŒæ—¶ç”¨npmå’Œyarnä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ&quot;">â€‹</a></h2><p>antfu çš„ vitesse éœ€è¦é€šè¿‡åŒ…çš„é”æ–‡ä»¶å»åˆ¤æ–­å…·ä½“ç”¨åˆ°é‚£ä¸ªåŒ…ç®¡ç†å™¨ç„¶åç”¨è¿™ä¸ªåŒ…ç®¡ç†å™¨å»è‡ªåŠ¨å®‰è£…å…·ä½“çš„å›¾æ ‡é›†ä¾èµ–</p><p>ä¸åŒçš„åŒ…ç®¡ç†å™¨çš„ ç½‘ç»œæœºåˆ¶ ç¼“å­˜æœºåˆ¶ ä¸‹è½½åçš„ä¾èµ–åˆ†å¸ƒ ä¸åŒï¼Œå¦‚æœç‰¹åˆ«ä¾èµ–è¿™äº›çš„é¡¹ç›®ä¹Ÿéœ€è¦æ³¨æ„ä¸€ä¸‹</p><p>ä¸»è¦æ˜¯é€ æˆä¸åŒæœºå™¨ä¸ŠåŒä¸€é¡¹ç›®çš„ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´, ä¸¥é‡çš„æ˜¯æ„å»ºéƒ¨ç½²æœºå®‰è£…çš„ä¾èµ–å’Œå¼€å‘æœ¬åœ°ä¾èµ–ä¸ä¸€è‡´é€ æˆä¸å¯çŸ¥çš„çº¿ä¸Šé—®é¢˜</p><h2 id="æ˜¯å¦åº”è¯¥æäº¤lockfilesåˆ°ä»“åº“-åˆ é™¤node-moduleså’Œlockfiles-é‡æ–°install-æ˜¯å¦æœ‰é£é™©" tabindex="-1">æ˜¯å¦åº”è¯¥æäº¤lockfilesåˆ°ä»“åº“ï¼Ÿ åˆ é™¤node_moduleså’Œlockfilesï¼Œé‡æ–°installï¼Œæ˜¯å¦æœ‰é£é™©ï¼Ÿ <a class="header-anchor" href="#æ˜¯å¦åº”è¯¥æäº¤lockfilesåˆ°ä»“åº“-åˆ é™¤node-moduleså’Œlockfiles-é‡æ–°install-æ˜¯å¦æœ‰é£é™©" aria-label="Permalink to &quot;æ˜¯å¦åº”è¯¥æäº¤lockfilesåˆ°ä»“åº“ï¼Ÿ åˆ é™¤node_moduleså’Œlockfilesï¼Œé‡æ–°installï¼Œæ˜¯å¦æœ‰é£é™©ï¼Ÿ&quot;">â€‹</a></h2><p>é¦–å…ˆç¡®å®š <code>lockfiles</code> çš„ä½œç”¨</p><ul><li><code>lockfiles</code> ç”¨äºä¿æŒä¾èµ–ç‰ˆæœ¬</li><li><code>lockfiles</code> æ˜¯ä¾èµ–åˆ†æåçš„æ–‡ä»¶ï¼Œæœ‰ <code>lockfiles</code> å°±ä¸ç”¨å†åšä¸€æ¬¡ä¾èµ–åˆ†æï¼Œæ„å»ºä¾èµ–æ ‘æ¸…å•(æ‰å¹³åŒ–), æå‡ä¸€ç‚¹é€Ÿåº¦</li></ul><p><code>package.json</code> ä¸­çš„ä¾èµ–æ¸…å•å³ä½¿é™åˆ¶å…·ä½“ç‰ˆæœ¬ï¼ŒåµŒå¥—ä¾èµ–ä¾ç„¶æ²¡åŠæ³•é™åˆ¶, è¿˜æ˜¯ä¼šå‡ºç°è¿‡ä¸€æ®µæ—¶é—´å, é‡æ–°å®‰è£…çš„ä¾èµ–è·Ÿä»¥å‰ä¸åŒ(åµŒå¥—ä¾èµ–å‡çº§äº†)</p><p>æ¯”å¯¹ <code>lockfiles</code> å’Œ <code>package.json</code> çš„ç‰ˆæœ¬ï¼Œä¸€èˆ¬éƒ½æ˜¯è½åäº <code>package.json</code> æ‰ä¸ä¸€è‡´(æ‰‹åŠ¨å‡çº§äº†æŸä¸ªä¾èµ–)</p><p>æ­¤æ—¶ä¼šåˆ¤æ–­ <code>lockfiles</code> è½åçš„ç‰ˆæœ¬åœ¨ <code>package.json</code> é‚£é‡Œæ˜¯å¦å…¼å®¹ï¼Œå…¼å®¹çš„è¯ä¸æŒ‰package.jsonçš„æ–°ç‰ˆæœ¬ä¾èµ–æ¥å®‰è£…, ä¾ç„¶å– <code>lockfiles</code> (æ¯”å¯¹ä¹‹åä¼šç›¸åº”çš„æ›´æ–°lockä¸­çš„ç‰ˆæœ¬)</p><p>ğŸ‘† æ³¨æ„æµç¨‹å›¾ä¸­ä¸åŒ npm ç‰ˆæœ¬å¤„ç† lock æ¯”å¯¹ç‰ˆæœ¬çš„å¤„ç†ä¸ç›¸åŒï¼Œå› æ­¤ä¸åŒç”µè„‘çš„ npm åº”è¯¥å°½é‡ç›¸åŒï¼Œé¿å… lock æ¯”å¯¹è¿‡ç¨‹ï¼Œæ¯ä¸ªäººå®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸åŒ(æœ‰äº›æŒ‰ç…§ lock æœ‰äº›æŒ‰ç…§ package)</p><p>å› æ­¤ä¸ºäº†ä¿è¯é¡¹ç›®çš„é•¿ä¹…ç¨³å®š, åº”è¯¥æäº¤ lock åˆ°ä»“åº“, å½“éœ€è¦å‡çº§æŸä¸ªä¾èµ–æ—¶, æ›´æ–° lock åŠ <code>package.json</code> æäº¤</p><p>å¦‚æœä»–äººå› ä¸º npm ç‰ˆæœ¬ä¸åŒ, æŒ‰ç…§ lock å®‰è£…ä¸äº†ä¾èµ–</p><p>æˆ–æŒ‰ç…§ lock æˆåŠŸå®‰è£…äº†ä¾èµ–, ä½†æ˜¯è¿è¡Œé¡¹ç›®æ—¶ä¾èµ–æŠ¥é”™, æ­¤æ—¶å¯èƒ½æ˜¯è¯¥ä¾èµ–ç‰ˆæœ¬ä¸å…¼å®¹è¿™ä¸ª nodejs ç¯å¢ƒ, æ­¤æ—¶å¯ä»¥æ•´ä¸ªé¡¹ç›®è€ƒè™‘å…¼å®¹è¿™ä¸ª nodejs ç¯å¢ƒå»å¯¹è¿™ä¸ªä¾èµ–å‡çº§æˆ–æ˜¯é™çº§,å¹¶æäº¤è°ƒæ•´åçš„ <code>package.json</code> å’Œ lock, è€ƒè™‘ä¸å…¼å®¹è¿™ä¸ª nodejs ç¯å¢ƒçš„è¯, å°±è®©å¯¹æ–¹æ¢æˆå¯ä»¥è¿è¡Œçš„ <code>nodejs</code> ç‰ˆæœ¬</p><h2 id="ä¸ºä»€ä¹ˆ-npm-i-ålockfileså˜äº†" tabindex="-1">ä¸ºä»€ä¹ˆ npm i ålockfileså˜äº† <a class="header-anchor" href="#ä¸ºä»€ä¹ˆ-npm-i-ålockfileså˜äº†" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆ npm i ålockfileså˜äº†&quot;">â€‹</a></h2><p>é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œ<code>npm i</code> ä¼šå…ˆæ¯”å¯¹ <code>lockfiles</code> å†…çš„ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆ <code>package.json</code> å¦‚æœç¬¦åˆçš„è¯æ˜¯ä¸ä¼šæŒ‰ç…§ <code>package.json</code> è‡ªåŠ¨æ›´æ–°ä¾èµ–çš„</p><p>è€Œ <code>lockfiles</code> ä¸ç¬¦åˆ <code>package.json</code> ç‰ˆæœ¬çš„æƒ…å†µä¸€èˆ¬æ˜¯ <code>package.json</code> ç‰ˆæœ¬å®šä¹‰æ›´é«˜äº†</p><blockquote><p>å› ä¸º <code>package.json</code> ç‰ˆæœ¬å®šä¹‰çš„æ˜¯æœ€ä½ç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è‡ªåŠ¨ç”Ÿæˆçš„ <code>lockfiles</code> éƒ½ä¸ä¼šä½äº <code>package.json</code></p></blockquote><p>æ‰‹åŠ¨æ”¹ <code>lockfiles</code> çš„æƒ…å†µä¸å¤šï¼Œæ‰‹åŠ¨æ”¹ <code>package.json</code> åè€Œä¼šå¤šç‚¹</p><ul><li>æ”¹ä½ <code>package.json</code> çš„è¯ï¼Œ <code>lockfiles</code> çš„ä¾èµ–ç‰ˆæœ¬æ˜¯ç¬¦åˆçš„ï¼Œæ­¤æ—¶å®‰è£…ä¼šèµ° <code>lockfiles</code> è€Œä¸æ˜¯ <code>package.json</code> ä¹Ÿå°±æ˜¯æƒ³åœ¨å·²æœ‰ <code>lockfiles</code> çš„æƒ…å†µä¸‹å®‰è£…ä½ç‰ˆæœ¬ä¾èµ–ï¼Œéœ€è¦åˆ é™¤ <code>lockfiles</code> åœ¨å®‰è£…</li><li>æ”¹é«˜ <code>package.json</code> çš„è¯ï¼Œ <code>lockfiles</code> çš„ä¾èµ–ç‰ˆæœ¬ä¸ç¬¦åˆï¼Œæ­¤æ—¶ä¼šæŒ‰ç…§ <code>package.json</code> çš„ç‰ˆæœ¬æŸ¥æ‰¾è¿œç¨‹åº“çš„æœ€é«˜ç‰ˆæœ¬è¿›è¡Œå®‰è£…</li></ul><p>ä¹Ÿè®¸ä½ ä¼šè¯´æ‰‹åŠ¨æ”¹ <code>package.json</code> çš„æƒ…å†µä¹Ÿä¸å¤šå‘€ï¼Œéƒ½æ˜¯ <code>npm i xx</code> å‡çº§ç‰ˆæœ¬çš„ï¼Œä¼šè‡ªåŠ¨æ›´æ–° <code>package.json</code> å’Œ <code>lockfiles</code></p><p>ä½†æ˜¯å‡å¦‚æ­¤æ—¶æäº¤ä»£ç ï¼Œåªæäº¤ <code>package.json</code>ï¼Œä¸¢å¼ƒ <code>lockfiles</code>ï¼Œå‡ºç°çš„ç»“æœå°±å’Œæ‰‹åŠ¨æ”¹é«˜ <code>package.json</code> çš„æƒ…å†µä¸€è‡´äº†</p><p>å›åˆ°é—®é¢˜ï¼šä¸ºä»€ä¹ˆ <code>npm i</code> å<code>lockfiles</code>å˜äº†</p><p>å› ä¸º <code>lockfiles</code> å’Œ <code>package.json</code> ä¸ç¬¦åˆï¼Œ<code>npm</code> è‡ªåŠ¨æŸ¥æ‰¾ä¸ç¬¦åˆçš„ä¾èµ–åœ¨ <code>package.json</code> ç‰ˆæœ¬å®šä¹‰çš„è¿œç¨‹åº“çš„æœ€æ–°ç‰ˆæœ¬</p><p>ä¸ºä»€ä¹ˆ <code>lockfiles</code> å’Œ <code>package.json</code> ä¸ç¬¦åˆï¼Œå°±æ˜¯æœ‰äºº æ‰‹åŠ¨æ”¹äº† <code>package.json</code> æˆ–æ˜¯ å‡çº§äº†ä¾èµ–æ²¡æœ‰æäº¤æ–°çš„ <code>lockfiles</code></p><p>å¦‚ä½•é¿å…ï¼šğŸ‘‡</p><ul><li>åªè¦å‡çº§ä¾èµ–å°±åŒæ—¶æäº¤ <code>package.json</code> ã€ <code>lockfiles</code></li><li>ç†è®ºä¸Šåªè¦ç¬¦åˆç‰ˆæœ¬ï¼Œéƒ½ä¼šèµ° <code>lockfiles</code> ä¸ä¼šå‡ºç°ä¸åŒçš„äººæœ¬åœ°ä¾èµ–ä¸ä¸€è‡´é—®é¢˜ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>npm ci</code> å¯ä»¥æå‡é€Ÿåº¦(åªå»ºè®®ç”¨äºæå‡é€Ÿåº¦ï¼Œè€Œä¸æ˜¯ç”¨äºé¿å…ä¾èµ–èµ°<code>package.json</code>)</li><li>å¦‚æœä½¿ç”¨ <code>npm i</code> å®‰è£…å‡ºç° <code>lockfiles</code> å˜åŒ–ï¼Œåº”æ£€æŸ¥å˜åŒ–é¡¹ï¼Œå¹¶æäº¤æ­¤ <code>lockfile</code> ä¸Šé”ï¼Œè®©æ­£ç¡®çš„ <code>lockfile</code> æ§åˆ¶ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯æŒ‰ç…§è½åçš„ <code>lockfile</code> æ¥ <code>npm ci</code></li></ul><h2 id="npm-ci" tabindex="-1">npm ci <a class="header-anchor" href="#npm-ci" aria-label="Permalink to &quot;npm ci&quot;">â€‹</a></h2><p><a href="https://docs.npmjs.com/cli/v8/commands/npm-ci" target="_blank" rel="noreferrer">npmæ–‡æ¡£</a></p><p>å®˜æ–¹ç§°è¿™ç§å®‰è£…æ˜¯ <code>clean install</code></p><blockquote><p>used in automated environments such as test platforms, continuous integration, and deployment</p><p>å¸¸ç”¨äºè‡ªåŠ¨åŒ–ç¯å¢ƒï¼šæµ‹è¯•å¹³å°ã€æŒç»­é›†æˆã€éƒ¨ç½²ç¯å¢ƒ</p></blockquote><blockquote><p>In short, the main differences between using npm install and npm ci are:</p><ul><li>The project must have an existing <code>package-lock.json</code> or <code>npm-shrinkwrap. json</code>.</li><li>If dependencies in the package lock do not match those in <code>package.json</code>, <code>npm ci</code> will exit with an error, instead of updating the package lock.</li><li><code>npm ci</code> can only install entire projects at a time: individual dependencies cannot be added with this command.</li><li>If a node_modules is already present, it will be automatically removed before <code>npm ci</code> begins its install.</li><li>It will never write to <code>package.json</code> or any of the package-locks: installs are essentially frozen.</li></ul></blockquote><p>å¦‚æœä»…ä»…ä»å®˜æ–¹æä¾›çš„åŒºåˆ«æ¥çœ‹ï¼š</p><p><code>npm ci</code> ä¹Ÿä¼šå…ˆæ¯”å¯¹ <code>lockfiles</code> å†…çš„ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆ <code>package.json</code></p><ul><li>ä¸ç¬¦åˆå°±ä¸­æ–­å®‰è£…</li><li>ç¬¦åˆå°±ç›´æ¥æŒ‰ç…§ <code>lockfiles</code> å®‰è£…ä¾èµ–ï¼Œä¸æŸ¥è¯¢ä¾èµ–è¿œç¨‹åº“çš„ç‰ˆæœ¬æ˜¯å¦æ›´æ–°</li></ul><p><code>npm ci</code> åœ¨å®‰è£…å‰ä¼šè‡ªåŠ¨æ¸…é™¤ç°å­˜çš„ <code>node_modules</code>ï¼Œæ‰€ä»¥ <code>npm ci</code> å¤©ç„¶è§„é¿äº†å¢é‡å®‰è£…å¯èƒ½å¸¦æ¥çš„ä¸ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚ï¼ˆè¿™ä¹Ÿæ„å‘³ç€ï¼Œä½ åˆå¯ä»¥å°‘è®°ä¸€æ¡å‘½ä»¤ npm pruneã€‚ï¼‰</p><p>å½“æƒ³åœ¨å·²æœ‰ <code>node_modules</code> æƒ…å†µä¸‹æŒ‰ç…§ <code>lockfiles</code> å®‰è£…ä¾èµ–</p><p><code>npm ci</code> æ„å‘³ç€ä¼šé‡æ–°å®‰è£…æ‰€æœ‰ä¾èµ–ï¼Œé€Ÿåº¦å¯èƒ½ä¼šæ¯” <code>npm i</code> æ…¢(ä»å¤´ä»å…¨å±€ç¼“å­˜è§£å‹æˆ–æ˜¯ç½‘ç»œä¸‹è½½) ä½†æ˜¯ä¸ºäº†ä¸å‡ºé—®é¢˜ï¼Œå¤§å®¶æŒ‰ç…§ <code>lockfiles</code> å®‰è£…ä¾èµ–éƒ½æ˜¯æ‰‹åŠ¨åˆ é™¤ <code>node_modules</code> çš„... ä¸æ•¢ç›´æ¥å®‰è£…ï¼Œæ‰€ä»¥ <code>npm ci</code> åè€Œæ˜¯ç¬¦åˆä¹ æƒ¯çš„...</p><p>å¯ä»¥ç”¨ <code>--prefer-offline</code>ï¼Œæœ€å¤§é™åº¦åœ°åˆ©ç”¨ npm çš„å…¨å±€ç¼“å­˜åŠ é€Ÿå®‰è£…è¿‡ç¨‹</p><blockquote><p>æ³¨æ„ï¼šå°±åƒä¸Šé¢è¯´çš„ï¼Œ <code>npm ci</code> åªå»ºè®®ç”¨äºæå‡é€Ÿåº¦ï¼Œè€Œä¸æ˜¯ç”¨äºé¿å…ä¾èµ–èµ°<code>package.json</code></p><p>å½“å‡ºç° <code>npm ci</code> ä¸ç¬¦åˆè€Œä¸­æ–­å®‰è£…æ—¶ï¼Œåº”æ£€æŸ¥ä¿®å¤ <code>lockfiles</code> ç‰ˆæœ¬é—®é¢˜, å¹¶ä½¿ç”¨ <code>npm i</code> è‡ªåŠ¨ç”Ÿæˆæ­£ç¡®çš„ <code>lockfiles</code> (ä¸è¦æ‰‹åŠ¨æ”¹)</p></blockquote><h2 id="è¿ç§»-npm-to-pnpm" tabindex="-1">è¿ç§» npm to pnpm <a class="header-anchor" href="#è¿ç§»-npm-to-pnpm" aria-label="Permalink to &quot;è¿ç§» npm to pnpm&quot;">â€‹</a></h2><p><a href="https://dev.to/andreychernykh/yarn-npm-to-pnpm-migration-guide-2n04" target="_blank" rel="noreferrer">How to migrate from yarn / npm to pnpm</a></p><ol><li>åˆ é™¤ <code>node_modules</code></li><li>ç›´æ¥æ‰§è¡Œ <code>pnpm i</code></li><li>æ‰§è¡Œ <code>pnpm dev</code>ï¼Œçœ‹æ§åˆ¶å°æŠ¥é”™ï¼Œçœ‹å“ªä¸ªåŒ…ç¼ºå¤±ï¼Œå†ç»™è¡¥ä¸Šåˆ° <code>package.json</code></li></ol><p>ğŸ‘† ç†è®ºä¸Šæ¢ä¸ª pnpm é‡æ–°å®‰è£…ä¾èµ–, å°±å¯ä»¥å¯åŠ¨é¡¹ç›®äº†, è·Ÿ npm ä¾èµ–å®Œå…¨æ— å…³äº†</p><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230310150818.png" alt=""></p><p>ğŸ¤” ä¸€äº›tsé—®é¢˜ï¼Œä¸ºä»€ä¹ˆåœ¨pnpmç¯å¢ƒä¸‹æŠ¥é”™(npmç¯å¢ƒä¸ä¼š)</p><p>è¿˜æ˜¯å¹½çµä¾èµ–çš„é—®é¢˜ï¼Œ<code>@types/node</code> åœ¨npm ç¯å¢ƒä¼šè¢«å…¶ä»–ä¾èµ–å®‰è£…åˆ° <code>node_modules/@types</code> ä¸‹ pnpm åˆ™ä¸ä¼šï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨æå‡åˆ°å¤–éƒ¨ï¼Œè¿™é‡Œè™½ç„¶ç¼ºå¤±çš„æ˜¯ @types/node ï¼Œä½†æ˜¯æŸ¥çœ‹ tsconfig.ts é…ç½®çš„ types æ˜¯ webpack-env</p><p>è€Œ webpack-env æ˜¯åŸºäº @types/node çš„ï¼Œå› ä¸ºæŒ‰ç…§çœŸå®tsé…ç½®å®‰è£… webpack-env</p><p><code>tslib</code> åŒç†</p><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230314102459.png" alt=""> vue2.7 tsæŠ¥é”™ å‡çº§ typescript <code>pnpm up typescript --lastest</code></p><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230314114711.png" alt=""> å‡çº§ husky <code>pnpm up husky --lastest</code></p><p>é…ç½® preinstall æ•ˆæœå¦‚ä¸‹</p><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230318104521.png" alt=""></p><p>npm6 æœ‰æ•ˆ npm 7+ çš„ pre hook åœ¨ install åï¼Œä¸€ç›´æœªä¿®å¤ issue</p><p>ä½†æ˜¯å¯åŠ¨é¡¹ç›®æŠ¥é”™ åŒ…ç¼ºå¤±, å¹¶ä¸æ˜¯å› ä¸º pnpm å®‰è£…ä¸åˆ°åŒ…, è€Œæ˜¯å› ä¸º npm å…è®¸ç›´æ¥ä½¿ç”¨ package.json ä¸­æ²¡æœ‰çš„ä¾èµ–(å¹½çµä¾èµ–), åœ¨ pnpm çš„ä¾èµ–ç›®å½•ç»“æ„ä¸­æ˜¯ä¸å…è®¸çš„, å› æ­¤å³ä½¿pnpmå®‰è£…å…¨äº†ä¾èµ–, ä¹Ÿä¼šæŠ¥é”™ åŒ…ç¼ºå¤±</p><p>æ­¤æ—¶ï¼Œæ‰‹åŠ¨å®‰è£…ç¼ºå¤±çš„åŒ…, è‡ªåŠ¨è¡¥å……åˆ° package.json ä¸­</p><p>é—®é¢˜ï¼šå®‰è£…ä¸€ä¸ªè¿è¡Œä¸€æ¬¡å¯åŠ¨, é æŠ¥é”™æç¤ºä¸€ä¸ªä¸€ä¸ªå®‰è£…....</p><p>è‡ªåŠ¨åŒ–å·¥å…·æ€è·¯ï¼šæ‰«æé¡¹ç›®ä»£ç ä¸­çš„å¼•å…¥è¯­å¥, æ‰¾å‡º package.json ä¸­æ²¡æœ‰çš„å¹½çµä¾èµ–, ä¸€æ¬¡æ€§å®‰è£…(å·¥å…·éš¾ç‚¹åœ¨æ‰«ææ•ˆç‡)</p><p>å‚è€ƒ <a href="https://www.npmjs.com/package/@sugarat/ghost" target="_blank" rel="noreferrer">@sugarat/ghost</a></p><p>æ‰«æä½¿ç”¨ babel/swc ?</p><ol><li>æ‰«æ–‡ä»¶ï¼›</li><li>æå–å¯¼å…¥èµ„æºè·¯å¾„ï¼›</li><li>æå–åŒ…åï¼›</li><li>å‰”é™¤ package.json ä¸­å­˜åœ¨çš„</li><li>å‰©ä¸‹çš„åŒ…åå°±æ˜¯å¹½çµä¾èµ–</li></ol><p>ä½¿ç”¨ only-allow é™åˆ¶åŒ…ç®¡ç†å™¨</p><p>TODO: è¿ç§»ç¬”è®° + è¿‡ä¸€é pnpm è‹±æ–‡æ–‡æ¡£</p><h2 id="pnpm-ä½¿ç”¨-ci" tabindex="-1">pnpm ä½¿ç”¨ ci <a class="header-anchor" href="#pnpm-ä½¿ç”¨-ci" aria-label="Permalink to &quot;pnpm ä½¿ç”¨ ci&quot;">â€‹</a></h2><p><code>pnpm</code> æ²¡æœ‰ <code>ci</code> æŒ‡ä»¤</p><p>æˆ‘ä»¬ä¸Šé¢äº†è§£äº† <code>ci</code> çš„ä½œç”¨ï¼šåœ¨æŒç»­é›†æˆç­‰ç¯å¢ƒæŒ‰ç…§ <code>lockfiles</code> å®‰è£…ä¾èµ–ï¼Œå¹¶ä¸”ä¸ç¬¦åˆæ—¶ä¸­æ–­å®‰è£…</p><p><a href="https://pnpm.io/cli/install#--frozen-lockfile" target="_blank" rel="noreferrer">pnpm i å®˜ç½‘æ–‡æ¡£</a> æåˆ° <code>pnpm</code> å†…ç½® <a href="https://www.npmjs.com/package/is-ci" target="_blank" rel="noreferrer">is-ci</a> åˆ¤æ–­å½“å‰ç¯å¢ƒæ˜¯ <code>ci</code> ç¯å¢ƒä¼šè®¾ç½® <code>--frozen-lockfile</code> ä¸º <code>true</code>ï¼Œè¯¥é€‰é¡¹å°±æ˜¯ ci çš„æ•ˆæœ</p><blockquote><p>å°±åƒä¸Šé¢åå¤å¼ºè°ƒçš„ï¼Œ <code>npm ci</code> ä¸æ˜¯ç”¨äºé¿å…ä¾èµ–èµ° <code>package.json</code></p><p>ä½¿ç”¨ <code>pnpm</code> ä¹Ÿä¸åº”è¯¥å­˜åœ¨ <code>lockfiles</code> å†…ä¾èµ–ä¸ç¬¦åˆ <code>package.json</code> çš„æƒ…å†µï¼Œä¸åº”è¯¥æƒ³ç€æˆ‘è¦æŒ‰ç…§ <code>lockfiles</code> å®‰è£…ä¾èµ–ï¼Œè¦çŸ¥é“åªè¦ <code>lockfiles</code> ç¬¦åˆ <code>package.json</code> å°±ä¸ä¼šè‡ªåŠ¨æ›´æ–°ä¾èµ–ï¼</p></blockquote><p>è€Œæå‡é€Ÿåº¦çš„ä½œç”¨ï¼Œåœ¨ <code>pnpm</code> ä¸‹å¹¶ä¸ä¼šå¤ªæ˜æ˜¾</p><p>å› æ­¤ <code>pnpm i</code> è¶³å¤Ÿäº†ï¼Œä¸éœ€è¦é¢å¤–è€ƒè™‘</p><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1">å‚è€ƒèµ„æ–™ <a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-label="Permalink to &quot;å‚è€ƒèµ„æ–™&quot;">â€‹</a></h2><ul><li><a href="https://juejin.cn/post/7060844948316225572" target="_blank" rel="noreferrer">å­—èŠ‚çš„ä¸€ä¸ªå°é—®é¢˜ npm å’Œ yarnä¸ä¸€æ ·å—ï¼Ÿ</a></li><li><a href="https://juejin.cn/post/7036319707590295565" target="_blank" rel="noreferrer">pnpm è§£å†³æˆ‘å“ªäº›ç—›ç‚¹ï¼Ÿ</a></li><li><a href="https://mp.weixin.qq.com/s/9JCs3rCmVuGT3FvKxXMJwg" target="_blank" rel="noreferrer">èŠèŠä¾èµ–ç®¡ç† - å­—èŠ‚å‰ç«¯ ByteFE</a></li><li><a href="https://pnpm.io/symlinked-node-modules-structure" target="_blank" rel="noreferrer">node_modulesç»“æ„ - pnpmå®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://github.com/lvqq/blog/issues/60" target="_blank" rel="noreferrer">pnpm åŸç†è§£æ</a></li></ul>`,171),l=[s];function d(p,i,t,r,m,u){return o(),n("div",null,l)}const g=e(a,[["render",d]]);export{k as __pageData,g as default};
