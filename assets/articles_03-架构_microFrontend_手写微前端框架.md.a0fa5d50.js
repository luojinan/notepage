import{_ as s,o as n,c as a,V as l}from"./chunks/framework.b450deef.js";const C=JSON.parse('{"title":"æ‰‹å†™å¾®å‰ç«¯demo","description":"","frontmatter":{},"headers":[],"relativePath":"articles/03-æ¶æ„/microFrontend/æ‰‹å†™å¾®å‰ç«¯æ¡†æ¶.md","filePath":"articles/03-æ¶æ„/microFrontend/æ‰‹å†™å¾®å‰ç«¯æ¡†æ¶.md"}'),p={name:"articles/03-æ¶æ„/microFrontend/æ‰‹å†™å¾®å‰ç«¯æ¡†æ¶.md"},o=l(`<h1 id="æ‰‹å†™å¾®å‰ç«¯demo" tabindex="-1">æ‰‹å†™å¾®å‰ç«¯demo <a class="header-anchor" href="#æ‰‹å†™å¾®å‰ç«¯demo" aria-label="Permalink to &quot;æ‰‹å†™å¾®å‰ç«¯demo&quot;">â€‹</a></h1><p>æ…•è¯¾ç½‘æ•™ç¨‹çš„ä¸»/å­åº”ç”¨ éƒ½æ˜¯åŸºäºwebpackçš„(vueé¡¹ç›®åŸºäºvue-cli)</p><p>åªæ˜¯ä¸ºäº†æ‰‹å†™æ¡†æ¶, ç¤ºä¾‹å°½å¯èƒ½ç®€å•</p><p>è¿™é‡Œåªåšä¸€ä¸ªç®€å•çš„ TabåŠŸèƒ½</p><p>æ¡†æ¶å®Œå–„å, ç¼–å†™ä¸€ä¸ªå†…ç®¡ç³»ç»Ÿ</p><p><a href="https://github.com/luojinan/micro-frontend-learndemo" target="_blank" rel="noreferrer">micro-frontend-learndemo - mygithub</a></p><p>ä»¥ <code>vite + åŸç”Ÿhtml/js</code> ä¸ºå®¿ä¸»åº”ç”¨æ­å»ºå¾®å‰ç«¯æ¡†æ¶</p><p>ä»¥ <a href="https://github.com/luojinan/webpack5-vue2.7-template" target="_blank" rel="noreferrer">webpack5 + vue2.7</a> ä¸ºå­åº”ç”¨</p><p>ä»¿ç…§ <code>qiankun</code> çš„ç®€æ˜“å¾®å‰ç«¯æ¡†æ¶</p><p><code>qiankun</code> åˆæ˜¯åŸºäº <code>single-spa</code> æ‰€ä»¥æœ¬demoå’Œ<code>qiankun</code>ã€<code>single-spa</code>ä¼šå¾ˆåƒ</p><p>ç›®å‰ä¸æ”¯æŒå­åº”ç”¨ä½¿ç”¨ <code>vite</code> æ‰“åŒ…å·¥å…·ï¼Œå› ä¸ºæ˜¯è¯»å–å­åº”ç”¨ <code>html</code> ç›´æ¥æ³¨å…¥ä¸»åº”ç”¨å®¹å™¨çš„</p><p>è€Œviteå¼€å‘é˜¶æ®µdevç”¨çš„æ˜¯esmï¼Œå¹¶ä¸”devæ‹¦æˆªèµ„æºæŒ‰éœ€ç¼–è¯‘ï¼Œä¸»åº”ç”¨ä¸­æœ¬åœ°ä¸ä¼šå¯åŠ¨å­åº”ç”¨ï¼Ÿ</p><p>TODO: å¾®å‰ç«¯åŸç† å¦å¼€ä¸€ç¯‡è®²</p><p>TODO: <code>microCore</code> å®ç°ç°åœ¨å¸‚é¢ä¸Šå¤šç§å¾®å‰ç«¯æ–¹æ¡ˆ, é€šè¿‡ä¸åŒçš„å…¥å£æ–‡ä»¶æš´éœ²å‡ºæ¥ä½¿ç”¨</p><ul><li>qiankun/single-spa é˜¿é‡Œ</li><li>micor-app äº¬ä¸œé›¶å”®</li><li>æ— ç•Œ</li><li>iframe - æºç¨‹</li></ul><h2 id="æ³¨å†Œå­åº”ç”¨é…ç½®ä¿¡æ¯" tabindex="-1">æ³¨å†Œå­åº”ç”¨é…ç½®ä¿¡æ¯ <a class="header-anchor" href="#æ³¨å†Œå­åº”ç”¨é…ç½®ä¿¡æ¯" aria-label="Permalink to &quot;æ³¨å†Œå­åº”ç”¨é…ç½®ä¿¡æ¯&quot;">â€‹</a></h2><p><a href="https://qiankun.umijs.org/zh/guide/getting-started#2-%E5%9C%A8%E4%B8%BB%E5%BA%94%E7%94%A8%E4%B8%AD%E6%B3%A8%E5%86%8C%E5%BE%AE%E5%BA%94%E7%94%A8" target="_blank" rel="noreferrer">qiankun-åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œå¾®åº”ç”¨</a></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">registerMicroApps</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">start</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">qiankun</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">react app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// app name registered</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">//localhost:7100</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">container</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#yourContainer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">activeRule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/yourActiveRule</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">scripts</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">//localhost:7100/main.js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">container</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#yourContainer2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">activeRule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/yourActiveRule2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">start</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>æˆ‘ä»¬å®ç°è‡ªå·±çš„ <code>registerMicroApps</code></p><p>æš‚æ—¶å¯ä»¥çœ‹å‡ºæ˜¯ä¸€ä¸ªå­˜å‚¨åˆ° æ ¸å¿ƒç±»åº“ ä¸­çš„ä¸€äº›é…ç½®é¡¹</p><p>å¦‚ <code>vite.config.ts</code> ä¸­çš„ <code>defineConfig({})</code></p><h3 id="åˆ›å»ºä¸»åº”ç”¨" tabindex="-1">åˆ›å»ºä¸»åº”ç”¨ <a class="header-anchor" href="#åˆ›å»ºä¸»åº”ç”¨" aria-label="Permalink to &quot;åˆ›å»ºä¸»åº”ç”¨&quot;">â€‹</a></h3><p>ä½¿ç”¨ vite åˆ›å»ºåŸç”Ÿ html åº”ç”¨</p><p>ğŸ‘‡ <code>mainApp/src/main.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">registerMicroApps</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../../microCore/index</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./style.css</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">HTMLDivElement</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">!.</span><span style="color:#A6ACCD;">innerHTML </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;div&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;img src=&quot;/vite.svg&quot; class=&quot;logo&quot; alt=&quot;Vite logo&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;h1&gt;Vite + TypeScript&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;/div&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue3 app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">//localhost:7100</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">container</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#yourContainer2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">activeRule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/vue2demo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">;</span></span></code></pre></div><p>ğŸ‘† åˆ é™¤ä¸€äº›å¤šä½™å†…å®¹, å¹¶æŒ‰ <code>qiankun</code> è°ƒç”¨æ³¨å†Œå­åº”ç”¨æ–¹æ³• <code>registerMicroApps</code></p><h3 id="åˆ›å»ºå¾®åº”ç”¨æ ¸å¿ƒåº“" tabindex="-1">åˆ›å»ºå¾®åº”ç”¨æ ¸å¿ƒåº“ <a class="header-anchor" href="#åˆ›å»ºå¾®åº”ç”¨æ ¸å¿ƒåº“" aria-label="Permalink to &quot;åˆ›å»ºå¾®åº”ç”¨æ ¸å¿ƒåº“&quot;">â€‹</a></h3><p>å› ä¸ºæ˜¯ä¸»åº”ç”¨è°ƒç”¨æ ¸å¿ƒåº“, å› æ­¤ä¸»åº”ç”¨çš„ <code>ts</code> é…ç½®éœ€è¦åŒ…å« <code>æ ¸å¿ƒåº“</code> ç›®å½•</p><p>é…ç½® <code>mainApp/tsconfig.json</code> æ·»åŠ  <code>&quot;../microCore&quot;</code></p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">include</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../microCore</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span></code></pre></div><p>ğŸ‘‡ <code>microCore/index.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å¾®å‰ç«¯æ ¸å¿ƒç±»åº“ æä¾›ç»™ mainAPP ä½¿ç”¨</span></span>
<span class="line"><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">container</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">activeRule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">option</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å­˜å‚¨å­åº”ç”¨æ³¨å†Œä¿¡æ¯</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">option</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230118163805.png" alt=""></p><p><code>microCore</code> æ–°å¢ <code>const/index.ts</code> ç”¨äºå­˜å‚¨è¿è¡Œæ—¶çš„æ³¨å†Œå­åº”ç”¨ä¿¡æ¯</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SubappInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../type</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> subappList</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#A6ACCD;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> getAppList </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> subappList</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setList </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">appList</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> subappList </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> appList</span></span></code></pre></div><p>ğŸ‘‡ <code>microCore/index.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// å¾®å‰ç«¯æ ¸å¿ƒç±»åº“ æä¾›ç»™ mainAPP ä½¿ç”¨</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setAppList</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./const</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SubappInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./type</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">option</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setAppList</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">option</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// &lt;-- this</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="æ‹¦æˆªè·¯ç”±" tabindex="-1">æ‹¦æˆªè·¯ç”± <a class="header-anchor" href="#æ‹¦æˆªè·¯ç”±" aria-label="Permalink to &quot;æ‹¦æˆªè·¯ç”±&quot;">â€‹</a></h2><p>å®Œæˆæ³¨å†Œå­åº”ç”¨ä¿¡æ¯å, è°ƒç”¨ <code>å¾®å‰ç«¯æ ¸å¿ƒåº“</code> çš„ <code>start</code> æ¥é‡å†™è·¯ç”±æœºåˆ¶, è®©å­åº”ç”¨çš„è·¯ç”±éƒ½ç»è¿‡ <code>æ ¸å¿ƒåº“</code></p><p>ğŸ‘‡ <code>microCore/router/rewriteRouter.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * é‡å†™ history API</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> rewriteRouter </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">originalPushState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">history</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pushState</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">originalReplaceState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">history</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">replaceState</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pushState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">originalPushState</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arguments</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">history.pushState</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replaceState</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">originalReplaceState</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arguments</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">history.replaceState</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onpopstate</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">onpopstate</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ <code>microCore/index.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">option</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setAppList</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">option</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">rewriteRouter</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// &lt;-- this</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>æ§åˆ¶å°è¾“å…¥ <code>history.pushState(null, &#39;&#39;, &#39;/foo&#39;)</code> è§¦å‘äº†æˆ‘ä»¬çš„æ‹¦æˆª <code>console</code><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230118170503.png" alt=""></p><p>æµè§ˆå™¨å‰è¿›è¿”å›è§¦å‘ æ‰“å° <code>&#39;onpopstate&#39;</code></p><p>ğŸ¤” è§†é¢‘é‡Œåˆ©ç”¨ è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨æ¥è§¦å‘ å›è°ƒ</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> rewriteRouter </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">rewriteOriginFn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">history</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pushState</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">customerEventListenerPush</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// ä¼ å…¥ æœªæ‰§è¡Œçš„åŸç”Ÿæ–¹æ³• å’Œ è‡ªå®šä¹‰äº‹ä»¶åå­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">rewriteOriginFn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">history</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">replaceState</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">customerEventListenerReplace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">customerEventListenerPush</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">openApp</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// åˆ›å»º è‡ªå®šä¹‰äº‹ä»¶</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">customerEventListenerReplace</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">openApp</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">rewriteOriginFn</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">originFn</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">eventListenerName</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">originFn</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">argument</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡ŒåŸç”Ÿæ–¹æ³•</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Event</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">eventListenerName</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// åˆ©ç”¨ new Event æŠŠäº‹ä»¶ç›‘å¬å™¨åå­—ç¬¦ä¸² å®ä¾‹åŒ–ä¸º äº‹ä»¶</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dispatchEvent</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// é€šè¿‡ dispatchEvent æ‰§è¡Œäº‹ä»¶å®ä¾‹</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘† <code>rewriteOriginFn</code> å°è£…é‡å†™åŸç”Ÿæ–¹æ³•çš„é‡å¤éƒ¨åˆ†å¯ä»¥ç†è§£</p><p>ğŸ¤” ä½†æ˜¯ç¬¬2ä¸ªå‚æ•°å®Œå…¨å¯ä»¥æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°, ä¸ºä»€ä¹ˆè¦ç”¨è‡ªå®šä¹‰äº‹ä»¶ç›‘å¬å™¨çš„æ–¹å¼è°ƒç”¨å›è°ƒï¼ŸTODO:</p><h2 id="å½“å‰urlåŒ¹é…å­åº”ç”¨æ³¨å†Œä¿¡æ¯" tabindex="-1">å½“å‰URLåŒ¹é…å­åº”ç”¨æ³¨å†Œä¿¡æ¯ <a class="header-anchor" href="#å½“å‰urlåŒ¹é…å­åº”ç”¨æ³¨å†Œä¿¡æ¯" aria-label="Permalink to &quot;å½“å‰URLåŒ¹é…å­åº”ç”¨æ³¨å†Œä¿¡æ¯&quot;">â€‹</a></h2><p>é€šè¿‡ <code>location</code> ä¸­çš„ <code>pathName</code> æ¥åŒ¹é…æ³¨å†Œä¿¡æ¯ä¸­çš„å­åº”ç”¨æ•°æ®å¯¹è±¡</p><p>åœ¨ <code>VueRouter</code> åŸç†æ–‡ç« ä¸­ æˆ‘ä»¬åˆ©ç”¨ <code>Vue.util.reactive</code> æŠŠå½“å‰Urlæ•°æ®è½¬ä¸ºå“åº”å¼æ•°æ®</p><p>é€šè¿‡ <code>watch</code> æ¥è§¦å‘ å›è°ƒ <code>render</code></p><p>ç°åœ¨æ²¡æœ‰å“åº”å¼æ•°æ®, åˆ™éœ€è¦è‡ªå·±æ‰‹åŠ¨åœ¨æ‰€æœ‰ <code>URL</code> æ”¹å˜çš„åœ°æ–¹æ‰‹åŠ¨è§¦å‘ <code>render</code></p><ul><li>é¡µé¢ <code>init</code> æ—¶, å¦‚æµè§ˆå™¨è¾“å…¥åœ°å€ <code>xxx/vue2demo/xx</code> æˆ– <code>åˆ·æ–°</code></li><li>ä¸»/å­åº”ç”¨, é€šè¿‡ <code>pushState</code> ç­‰æ–¹æ³•è·³è½¬é¡µé¢(å„ç°ä»£å‰ç«¯ <code>Router</code> çš„åŸç†åº•å±‚ )</li></ul><p>åœ¨ <code>qiankun</code> è¿™äº›æ­¥éª¤å‘ç”Ÿåœ¨ <code>start()</code></p><p>ğŸ‘‡ <code>microCore/utils/index.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">getAppList</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../const</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SubappInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../type</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * è·å– URL ä¸Šçš„ pathname ä½œä¸º å­åº”ç”¨name</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> getSubappNameByUrl </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">pathname</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * æ ¹æ®å½“å‰ URL å’Œ å­åº”ç”¨æ³¨å†Œåˆ—è¡¨ åŒ¹é…å‡ºå½“å‰å­åº”ç”¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> getCurrentSubappInfo</span><span style="color:#89DDFF;">:()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">null</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appList</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getAppList</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">urlAppName</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getSubappNameByUrl</span><span style="color:#F07178;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">urlAppName</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">??</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ <code>microCore/index.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­å­åº”ç”¨æ³¨å†Œæ˜¯å¦ä¸ºç©º</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appList</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getAppList</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">appList</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å­åº”ç”¨åˆ—è¡¨ä¸ºç©º, è¯·ä½¿ç”¨ registerMicroApps() æ³¨å†Œè‡³å°‘1ä¸ªå­åº”ç”¨</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–å½“å‰ URL åŒ¹é…åˆ°çš„å­åº”ç”¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getCurrentSubappInfo</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">currentAppInfo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="ç¼–å†™ä¸»åº”ç”¨-tab-åŠŸèƒ½" tabindex="-1">ç¼–å†™ä¸»åº”ç”¨ Tab åŠŸèƒ½ <a class="header-anchor" href="#ç¼–å†™ä¸»åº”ç”¨-tab-åŠŸèƒ½" aria-label="Permalink to &quot;ç¼–å†™ä¸»åº”ç”¨ Tab åŠŸèƒ½&quot;">â€‹</a></h2><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">HTMLDivElement</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">!.</span><span style="color:#A6ACCD;">innerHTML </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;div&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;img src=&quot;/vite.svg&quot; class=&quot;logo&quot; alt=&quot;Vite logo&quot; /&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;h1&gt;Vite + TypeScript&lt;/h1&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;ul&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">      &lt;li&gt;/vue2demo#page1&lt;/li&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">      &lt;li&gt;/vue2demo#page2&lt;/li&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">    &lt;/ul&gt;</span></span>
<span class="line"><span style="color:#C3E88D;">  &lt;/div&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelectorAll</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">li</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">ele</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">ele</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">click</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pushState</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">null,</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ele</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerText</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h2 id="åŠ è½½å­åº”ç”¨" tabindex="-1">åŠ è½½å­åº”ç”¨ <a class="header-anchor" href="#åŠ è½½å­åº”ç”¨" aria-label="Permalink to &quot;åŠ è½½å­åº”ç”¨&quot;">â€‹</a></h2><p>å‰é¢åªæ˜¯æ‹¦æˆªäº†è·¯ç”±æ²¡æœ‰å†™åŠ è½½é€»è¾‘</p><p>ğŸ‘‡ <code>microCore/load/loadSubApp.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">getCurrentSubappInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../utils</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loadApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–å½“å‰ URL åŒ¹é…åˆ°çš„å­åº”ç”¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getCurrentSubappInfo</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åŠ è½½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘† å¯ä»¥çœ‹å‡ºå’Œ <code>start</code> é‡Œé€»è¾‘é‡å¤, <code>start</code> å¤„ç†åˆå§‹åŒ–å’Œåˆ·æ–°é€»è¾‘</p><p>åœ¨è·¯ç”±ç›‘å¬é€»è¾‘é‡Œéƒ½è°ƒç”¨è¿™ä¸ªå‡½æ•°</p><p>â• æœŸæœ›çš„æ•ˆæœæ˜¯ å­åº”ç”¨åˆ‡æ¢æ—¶æ‰åŠ è½½ åŒä¸€ä¸ªå­åº”ç”¨ä¸åº”è¯¥å†æ¬¡åŠ è½½</p><p>æ‰€ä»¥åº”è¯¥åˆ¤æ–­ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨ ä¸ åˆ‡æ¢çš„å­åº”ç”¨æ˜¯å¦åŒä¸€ä¸ªï¼ŒåŒä¸€ä¸ªæ—¶ä¸è§¦å‘ <code>load</code></p><p>æš‚æ—¶ç”¨å…¨å±€å˜é‡å­˜ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨</p><p>ğŸ‘‡ <code>microCore/load/loadSubApp.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * åŠ è½½ å­åº”ç”¨</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loadApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–å½“å‰ URL åŒ¹é…åˆ°çš„å­åº”ç”¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getCurrentSubappInfo</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åŠ è½½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨ åˆ¤æ–­åŒä¸€ä¸ªå­åº”ç”¨ä¸è§¦å‘load</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>tså®šä¹‰ <code>Window</code> å…¨å±€å˜é‡ åªè¦åœ¨ <code>tsconfig.json</code> è¯†åˆ«èŒƒå›´å†…ï¼Œå®šä¹‰åœ¨å“ªéƒ½å¯ä»¥</p><p>ğŸ‘‡ <code>microCore/type.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">declare</span><span style="color:#A6ACCD;"> global </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">interface</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Window</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    __CURRENT_SUB_APP__</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>æ­¤æ—¶è¿˜æ²¡æœ‰ç¼–å†™åˆæ¬¡åŠ è½½é¡µé¢/åˆ·æ–°æ—¶åŠ è½½çš„é€»è¾‘</p><p>ä¸€èˆ¬æ¥è¯´å’Œç›‘å¬è·¯ç”±é‡Œçš„é€»è¾‘é‡å¤å†™</p><p>ä½†æ˜¯å°è¯•ä¸€ä¸‹ åŠ è½½é¡µé¢/åˆ·æ–° æ—¶è§¦å‘ <code>pushState</code> ä»è€Œè§¦å‘è·¯ç”±ç›‘å¬è¯•è¯• ä¼šä¸ä¼šå› æ­¤å¤šå‡ºä¸€å±‚è·¯ç”±</p><p><code>/vue2demo push /vue2demo</code></p><p>æµè§ˆå™¨è¿”å›æ—¶ æ˜¯å¦ä¼šå¯¼è‡´2å±‚</p><p>ç›´æ¥åœ¨æ§åˆ¶å°æµ‹è¯•ä¸‹æ¥ <code>pushstate</code> ä¸å½“å‰ <code>location.href</code> ä¸ä¼šå¤šå‡ºä¸€å±‚ç›¸åŒçš„å†å²</p><p>ä½†æ˜¯åœ¨å®é™…ç¼–å†™çš„æ—¶å€™ï¼Œåœ¨æœ‰è·¯ç”±å†å²çš„æƒ…å†µä¸‹ <code>åˆ·æ–°å¹¶è§¦å‘pushstateå½“å‰url</code> ä¼šä¸¢å¤±å†å²ï¼Œç›¸å½“äºåˆ·æ–°åçš„è·¯ç”±å˜æˆäº†é¦–ä¸ªè·¯ç”±</p><p>TODO: ä¸ <code>pushstate</code> çš„åˆ·æ–°å¯ä»¥æ­£å¸¸è¿”å›ï¼Œ ä¸åˆ·æ–°çš„ <code>pushstate</code> ä¹Ÿå¯ä»¥è¿”å›, ä½†æ˜¯åˆ·æ–° + <code>pushstate</code> å°±è¿™æ ·äº†ï¼Ÿï¼Ÿï¼Ÿ</p><p>è¿™é‡Œæš‚æ—¶å…ˆ é‡å¤å†™ç›‘å¬è·¯ç”±é‡Œç›¸åŒçš„é€»è¾‘</p><p>ğŸ‘‡ <code>microCore/index.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">start</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­å­åº”ç”¨æ³¨å†Œæ˜¯å¦ä¸ºç©º</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appList</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getAppList</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">appList</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å­åº”ç”¨åˆ—è¡¨ä¸ºç©º, è¯·ä½¿ç”¨ registerMicroApps() æ³¨å†Œè‡³å°‘1ä¸ªå­åº”ç”¨</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–å½“å‰ URL åŒ¹é…åˆ°çš„å­åº”ç”¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// const currentAppInfo = getCurrentSubappInfo()</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// if(!currentAppInfo) return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// console.log(&#39;init currentAppInfo&#39;,location.pathname + location.hash)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// history.pushState(null, &#39;&#39;, location.href)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// window.__CURRENT_SUB_APP__ = currentAppInfo.activeRule // å®šä¹‰ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨ åˆ¤æ–­åŒä¸€ä¸ªå­åº”ç”¨ä¸è§¦å‘load</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">loadApp</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// &lt;-- this</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="ä¸»åº”ç”¨ä¸­å®šä¹‰é€šç”¨ç”Ÿå‘½å‘¨æœŸ" tabindex="-1">ä¸»åº”ç”¨ä¸­å®šä¹‰é€šç”¨ç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#ä¸»åº”ç”¨ä¸­å®šä¹‰é€šç”¨ç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;ä¸»åº”ç”¨ä¸­å®šä¹‰é€šç”¨ç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h2><p>åœ¨ä¸»åº”ç”¨ç¼–å†™ ç”Ÿå‘½å‘¨æœŸ</p><p><code>microCore</code> çš„æ‰§è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨ä¼ å…¥è¿›æ¥çš„ç”Ÿå‘½å‘¨æœŸ</p><p>ä¹Ÿå°±æ˜¯ä¼šä½œç”¨äºåŠ è½½æ‰€æœ‰å­åº”ç”¨çš„è¿‡ç¨‹x</p><p>ğŸ‘‡ ä¸»åº”ç”¨å…¥å£æ–‡ä»¶æ³¨å†Œå­åº”ç”¨ä¿¡æ¯</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#A6ACCD;">(subAppList</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">beforeLoad</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼€å§‹åŠ è½½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">mounted</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ¸²æŸ“å®Œæˆ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">destoryed</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">é”€æ¯å®Œæˆ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>ç”Ÿå‘½å‘¨æœŸçš„é’©å­é€»è¾‘æ˜¯ç®€å•çš„å‘å¸ƒè®¢é˜…æœºåˆ¶ï¼ŒæŠŠæœªæ‰§è¡Œçš„å‡½æ•°åˆ—è¡¨å…ˆå­˜å‚¨èµ·æ¥ï¼Œåœ¨æ‰§è¡Œåˆ°çš„æŸä¸ªæ—¶æœºå»ç›¸åº”çš„è°ƒç”¨è¿™äº›å‡½æ•°</p><p>æˆ‘ä»¬å’Œå­˜å‚¨å­åº”ç”¨ä¿¡æ¯æ–¹å¼ç›¸åŒ åˆ›å»º <code>microCore/const/mainLifeCycle.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">type</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">LifeCycles</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">../type</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> mainLifeCycles</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">LifeCycles</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> getMainlLifeCycles </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> mainLifeCycles</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> setMainlLifeCycles </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">mainlLifeCycles</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">LifeCycles</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> mainLifeCycles </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mainlLifeCycles</span></span></code></pre></div><p>ğŸ‘‡ <code>microCore/type.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">LifeCycles</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">beforeLoad</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Function</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mounted</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Function</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">destoryed</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Function</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ç¼–å†™è°ƒç”¨é€»è¾‘</p><p>å› ä¸ºä¸Šé¢ é¦–æ¬¡åŠ è½½/åˆ·æ–° å’Œ ç›‘å¬è·¯ç”±å˜åŒ–è§¦å‘ çš„ <code>loadSubApp</code> æŠ½ç¦»åˆ°äº†ä¸€èµ·</p><p>å› æ­¤ <code>microCore/load/loadSubApp.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loadApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–å½“å‰ URL åŒ¹é…åˆ°çš„å­åº”ç”¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getCurrentSubappInfo</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">åŠ è½½</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 1. è°ƒ å¼€å§‹å‰ ç”Ÿå‘½å‘¨æœŸ // &lt;-- this</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">beforeLoad</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mounted</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">destoryed</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getMainlLifeCycles</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">beforeLoad</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">fn</span><span style="color:#C792EA;">=&gt;</span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 2. åŠ è½½å­åº”ç”¨(è€—æ—¶) // &lt;-- this</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sleep</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">mounted</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">fn</span><span style="color:#C792EA;">=&gt;</span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 3. è°ƒ å®Œæˆ ç”Ÿå‘½å‘¨æœŸ // &lt;-- this</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">destoryed</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">fn</span><span style="color:#C792EA;">=&gt;</span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨ åˆ¤æ–­åŒä¸€ä¸ªå­åº”ç”¨ä¸è§¦å‘load</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ç”Ÿå‘½å‘¨æœŸæ•ˆæœå¦‚ ğŸ‘‡ <img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/microlife.gif" alt=""></p><h3 id="ç”Ÿå‘½å‘¨æœŸloadingå®è·µ" tabindex="-1">ç”Ÿå‘½å‘¨æœŸloadingå®è·µ <a class="header-anchor" href="#ç”Ÿå‘½å‘¨æœŸloadingå®è·µ" aria-label="Permalink to &quot;ç”Ÿå‘½å‘¨æœŸloadingå®è·µ&quot;">â€‹</a></h3><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230121152432.png" alt=""></p><p>è¡¨ç¤ºå·¦è¾¹çš„è¡¨è¾¾å¼ä¸èƒ½åˆ¤æ–­æ˜¯å¦æœ‰å€¼å†èµ‹å€¼, å³ä½¿æœ‰ <code>?.</code> ä¹Ÿä¸èƒ½ç¡®å®š innerHTML æ˜¯å¦å­˜åœ¨</p><p>æ¢æˆ <code>!.</code> å°±èƒ½æ’é™¤æ‰å‰é¢æ˜¯ <code>null</code> å’Œ <code>undefined</code>çš„æƒ…å†µ <code>document.querySelector(&#39;#yourContainer&#39;)!.innerHTML = &#39;å­åº”ç”¨åŠ è½½ä¸­&#39;</code></p><p>TODO:</p><h2 id="å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸ" tabindex="-1">å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸ <a class="header-anchor" href="#å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸ" aria-label="Permalink to &quot;å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸ&quot;">â€‹</a></h2><p>å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸä¸ºæ³¨å†Œä¿¡æ¯å¯¹è±¡ä¸­çš„å±æ€§</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#A6ACCD;">([</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2.7 app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">//localhost:7100</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">container</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#yourContainer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">activeRule</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/vue2demo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">beforeLoad</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2demo ç”Ÿå‘½å‘¨æœŸ beforeLoad</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &lt;-- å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">mounted</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2demo ç”Ÿå‘½å‘¨æœŸ mounted</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">destoryed</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2demo ç”Ÿå‘½å‘¨æœŸ destoryed</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">beforeLoad</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &lt;-- ä¸»åº”ç”¨ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">mounted</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">destoryed</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>ğŸ‘† ä¸»/å­åº”ç”¨ ç”Ÿå‘½å‘¨æœŸè§¦å‘æ—¶æœºç›¸åŒ ç›¸å½“äºä¸»åº”ç”¨è®¾ç½®é€šç”¨é€»è¾‘ å­åº”ç”¨è®¾ç½®è‡ªå®šä¹‰é€»è¾‘</p><p>è¦è·å–å‰å­åº”ç”¨å’Œåå­åº”ç”¨, æ‰èƒ½åˆ†åˆ«è§¦å‘ä»–ä»¬çš„ç”Ÿå‘½å‘¨æœŸ</p><p>åœ¨åŒ¹é…åˆ°ç›®æ ‡è·¯å¾„æ˜¯æ³¨å†Œä¿¡æ¯ä¸­çš„å¦ä¸€ä¸ªå­åº”ç”¨æ—¶ ğŸ‘‡ ä¿®æ”¹å½“å‰å­åº”ç”¨å…¨å±€å˜é‡æ ‡è¯† çš„åŒæ—¶è®°å½•åŸå­åº”ç”¨è·¯å¾„</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__ORIGIN_SUB_APP__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__ </span><span style="color:#676E95;font-style:italic;">// ä¿®æ”¹ __CURRENT_SUB_APP__ çš„å€¼å‰ è®°å½•åŸå€¼ä½œä¸º preSubApp</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨ åˆ¤æ–­åŒä¸€ä¸ªå­åº”ç”¨ä¸è§¦å‘load</span></span></code></pre></div><p>ğŸ‘‡ è°ƒç”¨ç›®å½•å­åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸éœ€è¦åˆ¤æ–­</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loadApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è·å–å½“å‰ URL åŒ¹é…åˆ°çš„å­åº”ç”¨ä¿¡æ¯</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getCurrentSubappInfo</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 1. è°ƒ å¼€å§‹å‰ ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">beforeLoad</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">mounted</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">destoryed</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getMainlLifeCycles</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">beforeLoad</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">fn</span><span style="color:#C792EA;">=&gt;</span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">beforeLoad</span><span style="color:#89DDFF;">?.</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// &lt;-- this</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 2. åŠ è½½å­åº”ç”¨(è€—æ—¶) è°ƒ å®Œæˆ ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">sleep</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">mounted</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">fn</span><span style="color:#C792EA;">=&gt;</span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">mounted</span><span style="color:#89DDFF;">?.</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// &lt;-- this</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__ORIGIN_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä¿®æ”¹ __CURRENT_SUB_APP__ çš„å€¼å‰ è®°å½•åŸå€¼ä½œä¸º preSubApp</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨ åˆ¤æ–­åŒä¸€ä¸ªå­åº”ç”¨ä¸è§¦å‘load</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ è°ƒç”¨é”€æ¯ åˆ™éœ€è¦è·å–ä¸Šä¸€ä¸ªå­åº”ç”¨å­˜åœ¨æ—¶, å¹¶ä¸”æ—¶æœºæ˜¯ä¿®æ”¹å…¨å±€å˜é‡å˜é‡ä¹‹å</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> loadApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ... ç•¥</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__ORIGIN_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ä¿®æ”¹ __CURRENT_SUB_APP__ çš„å€¼å‰ è®°å½•åŸå€¼ä½œä¸º preSubApp</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__CURRENT_SUB_APP__</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">activeRule</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ å½“å‰å·²åŠ è½½çš„å­åº”ç”¨ åˆ¤æ–­åŒä¸€ä¸ªå­åº”ç”¨ä¸è§¦å‘load</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 3. é”€æ¯ä¸Šä¸€ä¸ªå­åº”ç”¨è°ƒ é”€æ¯ ç”Ÿå‘½å‘¨æœŸ // &lt;-- this</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">preSubApp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">findSubAppInfo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__ORIGIN_SUB_APP__</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">preSubApp</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">destoryed</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">fn</span><span style="color:#C792EA;">=&gt;</span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">preSubApp</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">destoryed</span><span style="color:#89DDFF;">?.</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="nodejsè„šæœ¬æ‰¹é‡å¯åŠ¨å‰ç«¯é¡¹ç›®" tabindex="-1">nodejsè„šæœ¬æ‰¹é‡å¯åŠ¨å‰ç«¯é¡¹ç›® <a class="header-anchor" href="#nodejsè„šæœ¬æ‰¹é‡å¯åŠ¨å‰ç«¯é¡¹ç›®" aria-label="Permalink to &quot;nodejsè„šæœ¬æ‰¹é‡å¯åŠ¨å‰ç«¯é¡¹ç›®&quot;">â€‹</a></h2><p>åˆå§‹åŒ–<a href="https://github.com/luojinan/webpack5-vue2.7-template" target="_blank" rel="noreferrer">vue2.7 + webpack å­åº”ç”¨</a></p><p>ğŸ‘‡ <code>run.mjs</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">spawn</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:child_process</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fileURLToPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">URL</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">node:url</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> demoPath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">vue2</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fileURLToPath</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./subApp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">main</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fileURLToPath</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./mainApp</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">url))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">values</span><span style="color:#A6ACCD;">(demoPath)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">spawn</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">cd </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> &amp;&amp; pnpm dev</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> stdio</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">overlapped</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> shell</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h2 id="åŠ è½½å¹¶æ¸²æŸ“å­åº”ç”¨èµ„æº" tabindex="-1">åŠ è½½å¹¶æ¸²æŸ“å­åº”ç”¨èµ„æº <a class="header-anchor" href="#åŠ è½½å¹¶æ¸²æŸ“å­åº”ç”¨èµ„æº" aria-label="Permalink to &quot;åŠ è½½å¹¶æ¸²æŸ“å­åº”ç”¨èµ„æº&quot;">â€‹</a></h2><p>ğŸ‘‡ <code>microCore/loadResource.ts</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * fetch è¯·æ±‚é™æ€èµ„æºè¿”å›æ–‡ä»¶å†…å®¹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#676E95;font-style:italic;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fetchResource </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">text</span><span style="color:#F07178;">())</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ è·¨åŸŸé—®é¢˜</p><p><code>subApp/build/webpack.dev.config.js</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">devServer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">allowedHosts</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">all</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ— æ•ˆ...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">headers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Origin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// allowedHosts é…ç½®äº†ä¹Ÿä¸èƒ½è·¨åŸŸè®¿é—®æœ¬é™æ€èµ„æºæœåŠ¡å™¨ éœ€è¦é…ç½® headers</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘† å­åº”ç”¨ <code>devServer</code> é…ç½®å…è®¸è·¨åŸŸ</p><h3 id="è§£æhtmlå†…å®¹" tabindex="-1">è§£æHTMLå†…å®¹ <a class="header-anchor" href="#è§£æhtmlå†…å®¹" aria-label="Permalink to &quot;è§£æHTMLå†…å®¹&quot;">â€‹</a></h3><p>ğŸ‘‡ æŠŠè¯»å–åˆ°çš„ <code>html</code> æ–‡æœ¬å†…å®¹é€šè¿‡ <code>innerHTML</code> æŒ‚è½½åˆ°å­åº”ç”¨é…ç½®ä¿¡æ¯çš„ <code>container</code> èŠ‚ç‚¹ä¸Š</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> htmlContent </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">fetchResource</span><span style="color:#A6ACCD;">(currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entry) </span><span style="color:#676E95;font-style:italic;">// è¯·æ±‚åˆ° html å†…å®¹</span></span>
<span class="line"><span style="color:#82AAFF;">mountSubApp</span><span style="color:#A6ACCD;">(htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> currentAppInfo)</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mountSubApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">htmlContent</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">appInfo</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">subAppRootDom</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">appInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">container</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">subAppRootDom</span><span style="color:#89DDFF;">!.</span><span style="color:#A6ACCD;">innerHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlContent</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>è‡³æ­¤, <code>html</code> è™½ç„¶æŒ‚è½½ä¸Šå»äº†, ä½†æ˜¯å­åº”ç”¨å†…å®¹æ˜¯ç©ºçš„, å› ä¸ºå­åº”ç”¨æ˜¯ <code>SPA</code> åº”ç”¨, éœ€è¦åŠ è½½åˆ°å­åº”ç”¨ <code>JS</code> æ‰èƒ½æ¸²æŸ“å‡ºå†…å®¹</p><h3 id="è§£æjså†…å®¹" tabindex="-1">è§£æJSå†…å®¹ <a class="header-anchor" href="#è§£æjså†…å®¹" aria-label="Permalink to &quot;è§£æJSå†…å®¹&quot;">â€‹</a></h3><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * è§£æ HTMl æ–‡æœ¬å†…å®¹ æˆ JS/CSS/HTML æ•°æ®</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> pasrseHtml </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">htmlContent</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 1. åˆ›å»ºä¸€ä¸ªdivå­˜æ”¾ fetch åˆ°çš„htmlæ–‡æœ¬å†…å®¹</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è¿™ä¹ˆåšæ˜¯ä¸ºäº†å»æ‰html body æ ‡ç­¾,  æ–¹ä¾¿æ•°æ®å¤„ç†å’Œé€’å½’</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">divDom</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createElement</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">div</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">divDom</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerHTML</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlContent</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">parseScript</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">divDom</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// æ­¤æ—¶çš„ divDom çš„å†…å®¹æ˜¯å¹³çº§çš„ meta div script</span></span>
<span class="line"><span style="color:#F07178;">  </span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlContent</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>é€’å½’ç»“æ„</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> parseScript </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">HTMLDivElement</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">deepParse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">element</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">children</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">children</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç±»æ•°ç»„ ä¸èƒ½ç”¨forEach</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">item</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">children</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">deepParse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">item</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">deepParse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">root</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230122102505.png" alt=""></p><p>ğŸ‘‡ å¤„ç†js</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">deepParse</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">element</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">HTMLElement</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">nodeName</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toLowerCase</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getAttribute</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// éå¤–éƒ¨é“¾æ¥çš„jsèµ„æº å†…è”é€»è¾‘</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">script</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">outerHTML</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å¤–éƒ¨é“¾æ¥ ç»å¯¹è·¯å¾„/ç›¸å¯¹è·¯å¾„</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">scriptUrl</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">scriptUrl</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">http:</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">src</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">children</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">element</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">children</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç±»æ•°ç»„ ä¸èƒ½ç”¨forEach</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">item</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">children</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">deepParse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">item</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>å¾—åˆ° <code>script</code> è¯·æ±‚çš„ ç»å¯¹è·¯å¾„, é€šè¿‡ <code>fetch</code> è¯·æ±‚å¾—åˆ° jsæ–‡æœ¬å†…å®¹</p><p>ğŸ‘‡ é€šè¿‡ <code>eval</code> æ‰§è¡Œ jsæ–‡æœ¬å†…å®¹</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> jsList</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">pasrseHtml</span><span style="color:#A6ACCD;">(htmlContent</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entry)</span></span>
<span class="line"><span style="color:#82AAFF;">mountSubApp</span><span style="color:#A6ACCD;">(htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> currentAppInfo)</span></span>
<span class="line"><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(item))</span></span></code></pre></div><p>è‡³æ­¤ å­åº”ç”¨çš„ å†…å®¹ä¹Ÿæ¸²æŸ“å‡ºæ¥äº†</p><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230122111055.png" alt=""></p><h2 id="è°ƒæ•´å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸåŠæ¨¡å—åŒ–" tabindex="-1">è°ƒæ•´å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸåŠæ¨¡å—åŒ– <a class="header-anchor" href="#è°ƒæ•´å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸåŠæ¨¡å—åŒ–" aria-label="Permalink to &quot;è°ƒæ•´å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸåŠæ¨¡å—åŒ–&quot;">â€‹</a></h2><p>ğŸ‘† é…ç½®å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸæ˜¯åœ¨ æ³¨å†Œå­åº”ç”¨ä¿¡æ¯ æ—¶ç¼–å†™çš„</p><p>ä¸ºäº†å…è®¸ å­åº”ç”¨ å‰ç«¯åº”ç”¨å¯ä»¥ç‹¬ç«‹è¿è¡Œ(ä¸ä¾é ä¸»åº”ç”¨)</p><p>éœ€è¦ å­åº”ç”¨ çš„å…¥å£é€»è¾‘åˆ†ä¸º2ç§æƒ…å†µè§¦å‘</p><ol><li>å¸¸è§„ SPA åŠ è½½ å…¥å£é€»è¾‘ ç«‹å³è§¦å‘æ¸²æŸ“</li><li>å¾®å‰ç«¯ç¯å¢ƒ ç”±ä¸»åº”ç”¨è°ƒç”¨å­åº”ç”¨ä¸­çš„ç”Ÿå‘½å‘¨æœŸ(ä¸Šé¢å®šä¹‰åœ¨å­åº”ç”¨æ³¨å†Œä¿¡æ¯ä¸­)è§¦å‘æ¸²æŸ“</li></ol><p>è®¾ç½® å¾®å‰ç«¯ç¯å¢ƒå˜é‡ å‘Šè¯‰ å‰ç«¯é¡¹ç›® ç°åœ¨æ˜¯ä½œä¸ºå­åº”ç”¨è¿è¡Œåœ¨å¾®å‰ç«¯çš„ä¸»åº”ç”¨é‡Œ</p><h3 id="ä¿®æ”¹å­åº”ç”¨å…¥å£é€»è¾‘" tabindex="-1">ä¿®æ”¹å­åº”ç”¨å…¥å£é€»è¾‘ <a class="header-anchor" href="#ä¿®æ”¹å­åº”ç”¨å…¥å£é€»è¾‘" aria-label="Permalink to &quot;ä¿®æ”¹å­åº”ç”¨å…¥å£é€»è¾‘&quot;">â€‹</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Vue </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./App.vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Vue</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">productionTip </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> render </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Vue</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">render</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">h</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">h</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">App</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$mount</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å…¥å£é€»è¾‘ç«‹å³æ‰§è¡Œ new Vue æ”¹ä¸ºéå¾®å‰ç«¯ç¯å¢ƒä¸‹ æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__MICRO_WEB__) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">render</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æŠ›å‡º å­åº”ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> beforeLoad </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2demo ç”Ÿå‘½å‘¨æœŸ beforeLoad</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mounted </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2demo ç”Ÿå‘½å‘¨æœŸ mounted</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">render</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// å¾®å‰ç«¯ç¯å¢ƒä¸‹ ç”±ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œ new Vue</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> destoryed </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2demo ç”Ÿå‘½å‘¨æœŸ destoryed</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>ğŸ‘‡ æ‰§è¡Œå­åº”ç”¨å…¥å£é€»è¾‘å‰ è®¾ç½®ç¯å¢ƒå˜é‡</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__MICRO_WEB__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œå­åº”ç”¨å…¥å£é€»è¾‘å‰ è®¾ç½®ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#C792EA;">=&gt;</span><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(item))</span></span></code></pre></div><h3 id="ä¿®æ”¹å­åº”ç”¨æ‰“åŒ…æ¨¡å—åŒ–æ–¹å¼" tabindex="-1">ä¿®æ”¹å­åº”ç”¨æ‰“åŒ…æ¨¡å—åŒ–æ–¹å¼ <a class="header-anchor" href="#ä¿®æ”¹å­åº”ç”¨æ‰“åŒ…æ¨¡å—åŒ–æ–¹å¼" aria-label="Permalink to &quot;ä¿®æ”¹å­åº”ç”¨æ‰“åŒ…æ¨¡å—åŒ–æ–¹å¼&quot;">â€‹</a></h3><p>ğŸ‘‡ å­åº”ç”¨ å‡ºå£é…ç½® <code>webpack</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">output</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolveApp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">filename</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">js/[name].[hash:6].js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">chunkFilename</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">js/[name].chunk.[hash:4].js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æŠŠå­åº”ç”¨æ‰“åŒ…æˆ umd åº“æ ¼å¼ // &lt;-- this</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">library</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue2demo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">libraryTarget</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">umd</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ <code>devServer</code> æ‰“åŒ…åçš„ <code>chunk</code><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230122162404.png" alt=""></p><h3 id="æ‰§è¡Œjsæ–‡æœ¬è·å–æŠ›å‡ºçš„å˜é‡" tabindex="-1">æ‰§è¡Œjsæ–‡æœ¬è·å–æŠ›å‡ºçš„å˜é‡ <a class="header-anchor" href="#æ‰§è¡Œjsæ–‡æœ¬è·å–æŠ›å‡ºçš„å˜é‡" aria-label="Permalink to &quot;æ‰§è¡Œjsæ–‡æœ¬è·å–æŠ›å‡ºçš„å˜é‡&quot;">â€‹</a></h3><p>è¦è·å–åˆ° umd æ¨¡å—åŒ–æŠ›å‡ºçš„å†…å®¹, åªè¦æ»¡è¶³ä¸€ç§åˆ¤æ–­æ¡ä»¶å°±è¡Œ</p><ul><li>CJS</li><li>AMD</li><li>å…¨å±€å˜é‡</li></ul><p>è§†é¢‘çš„åšæ³•æ˜¯é€šè¿‡å…¨å±€å˜é‡è·å–åˆ°é‡Œé¢æŠ›å‡ºçš„å†…å®¹</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__MICRO_WEB__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œå­åº”ç”¨å…¥å£é€»è¾‘å‰ è®¾ç½®ç¯å¢ƒå˜é‡</span></span>
<span class="line"><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(item))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">vue2demo) </span><span style="color:#676E95;font-style:italic;">// &lt;-- this { beforeLoad, ... }</span></span></code></pre></div><p>ğŸ‘† TODO: å¥‡æ€ªçš„æ˜¯åªèƒ½æ‰§è¡Œä¸€æ¬¡, å¦‚ vue2 -&gt; vue3 -&gt; vue2 ç¬¬äºŒæ¬¡ vue2 åŠ è½½å¹¶æ‰§è¡Œ umd å, window.vue2demo ä¸º undefined, æ— æ³•æ‰§è¡Œ mounted</p><p>å¯ä»¥ç”¨ tsup æ‰“åŒ…ä¸€ä¸ªç®€å•æ¨¡å—åŒ– umd åŒ…å°è¯•è®¿é—®å¤šæ¬¡</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œ æˆ‘ä»¬è¿˜å¯ä»¥ä¼ªé€ ä¸€ä¸ªç¬¦åˆ CJS åˆ¤æ–­æ¡ä»¶çš„å¯¹è±¡ç”¨äºè·å–</p><p>æ‰‹å†™è¿‡ CJS å°±çŸ¥é“è¯¥æ¨¡å—åŒ–çš„æœ¬è´¨å°±æ˜¯å¾€ä¸€ä¸ªå¯¹è±¡ä¸­å­˜å‚¨æ•°æ®, å†è·å–å‡ºæ¥</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__MICRO_WEB__ </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// æ‰§è¡Œå­åº”ç”¨å…¥å£é€»è¾‘å‰ è®¾ç½®ç¯å¢ƒå˜é‡</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// &lt;-- this</span></span>
<span class="line"><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(item))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exports) </span><span style="color:#676E95;font-style:italic;">// &lt;-- this { vue2demo: { beforeLoad, ...} }</span></span></code></pre></div><h2 id="æ²™ç®±æœºåˆ¶" tabindex="-1">æ²™ç®±æœºåˆ¶ <a class="header-anchor" href="#æ²™ç®±æœºåˆ¶" aria-label="Permalink to &quot;æ²™ç®±æœºåˆ¶&quot;">â€‹</a></h2><h3 id="å¿«ç…§æ²™ç®±" tabindex="-1">å¿«ç…§æ²™ç®± <a class="header-anchor" href="#å¿«ç…§æ²™ç®±" aria-label="Permalink to &quot;å¿«ç…§æ²™ç®±&quot;">â€‹</a></h3><p>åœ¨å­åº”ç”¨jsé€»è¾‘ä¸­æŒ‚è½½æŒ‚è½½å˜é‡åˆ° <code>window</code> ä¸Š, å¸Œæœ›è¿™ä¸ªæ“ä½œè¢«éš”ç¦»</p><p>å› ä¸ºå­åº”ç”¨æ‰€æœ‰çš„ js é€»è¾‘éƒ½åœ¨ <code>UMD</code> æ¨¡å—åŒ–ä¸­</p><p>åªè¦æƒ³åŠæ³•æŠŠè¿™ä¸ª <code>UMD</code> æ¨¡å—å†…éƒ¨çš„ <code>window</code> è¢«æ”¹å†™å°±å¯ä»¥äº†</p><p>å¯ä»¥é€šè¿‡å±€éƒ¨å˜é‡å®ç° æ¨¡å—å†…è®¿é—® <code>window</code> å°±ä¼˜å…ˆå–å±€éƒ¨å˜é‡</p><p>é¦–å…ˆ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè¢«æ”¹å†™çš„ <code>window</code> (ä¹Ÿå°±æ˜¯ä¸€ä»½æ‹·è´) è¿™ç§æ–¹å¼ç§°ä¸º <code>å¿«ç…§æ²™ç®±</code></p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> snapShotSandbox </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sandboxWindow</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">getSandboxWindow</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sandboxWindow</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">active</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">sandboxWindow</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getSandboxWindow</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inactive</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">in</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sandboxVal</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sandboxWindow</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sandboxVal</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">sandboxVal</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">è¿˜åŸå¿«ç…§window err</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">active</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inactive</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ æ³¨å…¥åˆ° umd ä¸­</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jsText </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  (()=&gt;{</span></span>
<span class="line"><span style="color:#C3E88D;">    const self = </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">sandboxWindow</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">  })()</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(jsText)</span></span></code></pre></div><p>ğŸ‘† æ¨¡æ¿å­—ç¬¦ä¸²è¯­æ³•ä¸­æ‹¼æ¥çš„å˜é‡ å¯¹è±¡æ—¶è¢«è½¬å­—ç¬¦ä¸²ä¼šæ˜¯ <code>[object Object]</code></p><p>å› æ­¤ä¸èƒ½è¿™ä¹ˆæŠŠ æ‹·è´çš„ window å¡è¿›å»</p><p>åªèƒ½æŒ‚è½½åœ¨ window ä¸‹, é€šè¿‡å­—ç¬¦ä¸²è®¿é—®åˆ°</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> active </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">snapShotSandbox</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sandboxWindow </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">active</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jsText </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  (()=&gt;{</span></span>
<span class="line"><span style="color:#C3E88D;">    const self = window.sandboxWindow</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">  })()</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(jsText)</span></span></code></pre></div><p>ğŸ‘† æŠ¥é”™ self is not a function</p><p>çŒœæµ‹ä¸èƒ½ç”¨ self å˜é‡, ä¼šè‡ªåŠ¨è¢«æµè§ˆå™¨è½¬ä¸º window</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jsText </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  (()=&gt;{</span></span>
<span class="line"><span style="color:#C3E88D;">    const window = window.sandboxWindow</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">  })()</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span></code></pre></div><p>ğŸ‘† æŠ¥é”™ window å†…ç½®å˜é‡ä¸èƒ½ä½œå˜é‡å</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> jsText </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  ((window)=&gt;{</span></span>
<span class="line"><span style="color:#C3E88D;">    </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">  })(window.sandboxWindow)</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(jsText)</span></span></code></pre></div><p><img src="https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230122185558.png" alt=""></p><p>ğŸ‘† å¯ä»¥å‘ç°è¿™æ ·ä¹Ÿæ˜¯ä¸å¯¹çš„ è¦é€šè¿‡ <code>window.sandboxWindow</code> æ‰èƒ½è®¿é—®</p><p>æˆ‘ä»¬å†æ¥ğŸ¤”ä¸€ä¸‹</p><p>åœ¨å­åº”ç”¨jsé€»è¾‘ä¸­æŒ‚è½½æŒ‚è½½å˜é‡åˆ° <code>window</code> ä¸Š, å¸Œæœ›è¿™ä¸ªæ“ä½œè¢«éš”ç¦»</p><p>åªè¦æƒ³åŠæ³•æŠŠ <code>UMD</code> æ¨¡å—å†…éƒ¨çš„ <code>window</code> è¢«æ”¹å†™å°±å¯ä»¥äº†</p><p>å¯ä»¥é€šè¿‡å±€éƒ¨å˜é‡å®ç° æ¨¡å—å†…è®¿é—® <code>window</code> å°±ä¼˜å…ˆå–å±€éƒ¨å˜é‡</p><p>ğŸ‘† è¿™ç§æ€è·¯çš„æ•ˆæœå°±å­åº”ç”¨æ“ä½œçš„æ˜¯è‡ªå·±çš„ä½œç”¨åŸŸ, è¿™æ ·å°±ä¸ä¸åƒæ˜¯ä¸€ä¸ªåº”ç”¨äº†</p><p>è¦çš„æ•ˆæœæ˜¯ åˆ‡æ¢åˆ° å­åº”ç”¨A , å¿«ç…§æ‹·è´ä¸€ä»½è¢«å­åº”ç”¨æ“ä½œå‰çš„ <code>window</code></p><p>å½“åˆ‡æ¢åˆ°å…¶ä»–å­åº”ç”¨å‰æŠŠ <code>window</code> è¿˜åŸä¸ºå¿«ç…§ <code>window</code> (ä¹Ÿå°±æ˜¯å­åº”ç”¨æ“ä½œçš„æ˜¯çœŸæ­£çš„ <code>window</code> åªä¸è¿‡è¿™æ¬¡æ“ä½œä¼šåœ¨ä¹‹åè¿˜åŸ)</p><p>ğŸ‘‡ umd æ‰§è¡Œä¾ç„¶ç›´æ¥æ“ä½œ window</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">eval</span><span style="color:#A6ACCD;">(item)) </span><span style="color:#676E95;font-style:italic;">// è§¦å‘ç¬¬äºŒæ¬¡ eval å…¨å±€æ¨¡å—å˜é‡ä¼šè¢«ç½®ç©º?</span></span></code></pre></div><p>ğŸ‘‡ é€šè¿‡é”€æ¯å­åº”ç”¨æ—¶æœº è¿˜åŸå›åŸæ¥çš„ window</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> active</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> inactive </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">snapShotSandbox</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sandbox </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> active</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> inactive </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å­˜å‚¨åˆ°å­åº”ç”¨ä¿¡æ¯ä¸­ ç”¨äºé€šè¿‡ä¸Šä¸€ä¸ªå­åº”ç”¨æ¥è¿˜åŸå¯¹åº”çš„(æ¯ä¸ªå­åº”ç”¨çš„æ²™ç®±å¿«ç…§ä¸åŒ)æ²™ç®±å¿«ç…§</span></span>
<span class="line"><span style="color:#82AAFF;">active</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 3. é”€æ¯ä¸Šä¸€ä¸ªå­åº”ç”¨è°ƒ é”€æ¯ ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> preSubApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">findSubAppInfo</span><span style="color:#A6ACCD;">(window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">__ORIGIN_SUB_APP__)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">(preSubApp) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è¿˜åŸ window ä¸ºå¿«ç…§</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">preSubApp</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">sandbox</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">inactive</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="ä»£ç†æ²™ç®±" tabindex="-1">ä»£ç†æ²™ç®± <a class="header-anchor" href="#ä»£ç†æ²™ç®±" aria-label="Permalink to &quot;ä»£ç†æ²™ç®±&quot;">â€‹</a></h3><p>å¿«ç…§æ²™ç®±ä¸æ”¯æŒåŒæ—¶å¯åŠ¨å¤šä¸ªå­åº”ç”¨</p><p>é€šè¿‡ <code>new Proxy</code> è®©æ‰€æœ‰å­åº”ç”¨æ“ä½œçš„ <code>window</code> æ˜¯å¦ä¸€ä¸ªå¯¹è±¡(æ¨¡å—åŒ–ä¸­ä¼ å…¥çš„ <code>window</code> ä¸èƒ½æ˜¯åŸ <code>window</code> è€Œæ˜¯ä»£ç†åçš„ <code>window</code>)</p><p><code>set</code> çš„éƒ½æ˜¯å¦ä¸€ä¸ªå¯¹è±¡</p><p><code>get</code> æ—¶åˆ™åˆ¤æ–­å¦ä¸€ä¸ªå¯¹è±¡å±æ€§æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™å–åŸ window ä¸Šçš„å±æ€§</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxySandbox </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxyWindow</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ¯ä¸ªå­åº”ç”¨éƒ½è°ƒç”¨ä¸€æ¬¡ active å³ proxyWindow ä¸ä¼šå¤ç”¨</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">active</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Proxy</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">window</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">proxyWindow</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">window</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      set</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">window</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">proxyWindow</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inactive</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">proxyWindow</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">active</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">inactive</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// const { active, inactive } = snapShotSandbox() // &lt;-- this</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;">active</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> inactive</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">proxySandbox</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sandbox </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> active</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> inactive </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å­˜å‚¨åˆ°å­åº”ç”¨ä¿¡æ¯ä¸­ ç”¨äºé€šè¿‡ä¸Šä¸€ä¸ªå­åº”ç”¨æ¥è¿˜åŸå¯¹åº”çš„(æ¯ä¸ªå­åº”ç”¨çš„æ²™ç®±å¿«ç…§ä¸åŒ)æ²™ç®±å¿«ç…§</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> proxyWindow </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">active</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// jsList.forEach(item =&gt; eval(item)) // è§¦å‘ç¬¬äºŒæ¬¡ eval å…¨å±€æ¨¡å—å˜é‡ä¼šè¢«ç½®ç©º?</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">proxyWindow </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> proxyWindow</span></span>
<span class="line"><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#A6ACCD;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">eval</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    ((window)=&gt;{</span></span>
<span class="line"><span style="color:#C3E88D;">      </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">item</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C3E88D;">    })(window.proxyWindow)</span></span>
<span class="line"><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>ğŸ‘† <a href="#å¿«ç…§æ²™ç®±">å¿«ç…§æ²™ç®±</a> ä¸­æåˆ°ä¸èƒ½ç”¨ window ä½œå˜é‡åæ¥æ”¹å†™, å› æ­¤ç”¨ window çš„ä¸´æ—¶å˜é‡ä¼ å…¥(å½“å¤šä¸ªå­åº”ç”¨æ—¶ ä¸´æ—¶å˜é‡å°†æ ¹æ®æ‰§è¡Œé¡ºåºéœ€è¦è¢«å¤šæ¬¡æ”¹å†™, å› æ­¤å¤šä¸ªå­åº”ç”¨æ—¶å±äºä¸å¯ä¿¡çš„å˜é‡, ä¸å»ºè®®æ“ä½œæˆ–è¯»å–å®ƒ)</p><p>éªŒè¯: ä¸»/å­åº”ç”¨ åˆ†åˆ«åŠ ä¸€ä¸ªæŒ‰é’® <code>console</code> å‡º <code>window.a</code> (ç”¨æ§åˆ¶å°ä¸èƒ½æ“ä½œåˆ°ä»£ç†å <code>window</code>, åªä¼šè¾“å‡ºåŸ <code>window</code>)</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// ä¸»åº”ç”¨</span></span>
<span class="line"><span style="color:#A6ACCD;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">querySelector</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">button</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">click</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// --&gt; undefined</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// vue2.7 å­åº”ç”¨</span></span>
<span class="line"><span style="color:#82AAFF;">setup</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getWindowA</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">a</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// --&gt; &#39;1&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">getWindowA</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h2 id="æ ·å¼éš”ç¦»" tabindex="-1">æ ·å¼éš”ç¦» <a class="header-anchor" href="#æ ·å¼éš”ç¦»" aria-label="Permalink to &quot;æ ·å¼éš”ç¦»&quot;">â€‹</a></h2><h3 id="css-modules" tabindex="-1">CSS Modules <a class="header-anchor" href="#css-modules" aria-label="Permalink to &quot;CSS Modules&quot;">â€‹</a></h3><h3 id="shadow-dom" tabindex="-1">shadow DOM <a class="header-anchor" href="#shadow-dom" aria-label="Permalink to &quot;shadow DOM&quot;">â€‹</a></h3><h3 id="å­åº”ç”¨å•ç‹¬cssæ–‡ä»¶" tabindex="-1">å­åº”ç”¨å•ç‹¬cssæ–‡ä»¶ <a class="header-anchor" href="#å­åº”ç”¨å•ç‹¬cssæ–‡ä»¶" aria-label="Permalink to &quot;å­åº”ç”¨å•ç‹¬cssæ–‡ä»¶&quot;">â€‹</a></h3><p>webpack ä¸€èˆ¬æ‰“åŒ…ç”Ÿäº§ç¯å¢ƒçš„ css ä¼šæ‹†åˆ†å‡ºæ¥</p><p>è€Œåªè¦æ‹†åˆ†å‡ºæ¥ æ ¹æ®å­åº”ç”¨åˆ‡æ¢è¯·æ±‚ä»¥åŠç§»é™¤ç›¸å…³ CSS æ–‡ä»¶ å°±è‡ªç„¶å½¢æˆäº†æ ·å¼éš”ç¦»</p><h2 id="é€šä¿¡-46-47-48-49" tabindex="-1">é€šä¿¡ 46 47 48 49 <a class="header-anchor" href="#é€šä¿¡-46-47-48-49" aria-label="Permalink to &quot;é€šä¿¡ 46 47 48 49&quot;">â€‹</a></h2><ul><li>é€šè¿‡ç”Ÿå‘½å‘¨æœŸ å¾€ å­åº”ç”¨info é‡Œæ”¾ä¸€ä¸ªå…±äº«æ•°æ®/æ–¹æ³• è‡ªå®šä¹‰æ•°æ®ç»“æ„æ¥æ“ä½œå¯¹æ–¹</li><li>customevent - åŸç”Ÿè‡ªå¸¦çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½ ç­‰åŒäº è‡ªå·±å†™ä¸ªå‘å¸ƒè®¢é˜…ç±» eventBus.on/emit</li></ul><h2 id="storeå­˜å‚¨" tabindex="-1">storeå­˜å‚¨ <a class="header-anchor" href="#storeå­˜å‚¨" aria-label="Permalink to &quot;storeå­˜å‚¨&quot;">â€‹</a></h2><p>ä¸»åº”ç”¨ å…¥å£æ–‡ä»¶å¾€ <code>window</code> ä¸ŠæŒ‚è½½å¾®å‰ç«¯æ ¸å¿ƒæä¾›çš„ <code>store</code></p><p>å­åº”ç”¨é€šè¿‡ <code>window.store</code> æ“ä½œ (æ²¡æœ‰vueçš„å“åº”å¼åŠŸèƒ½, åªæ˜¯æ™®é€šçš„æ•°æ®å­˜å‚¨å…±äº«)</p><p>ğŸ‘‡ å­˜å‚¨æ•°æ® å¹¶ æä¾› å‘å¸ƒè®¢é˜… update åè‡ªåŠ¨è§¦å‘</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Store</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../type</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * æ“ä½œå­˜å‚¨æ•°æ®çš„åŠŸèƒ½ store</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * å¹¶ æä¾› å‘å¸ƒè®¢é˜… update åè‡ªåŠ¨è§¦å‘</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> createStore</span><span style="color:#89DDFF;">:()</span><span style="color:#C792EA;">=&gt;</span><span style="color:#FFCB6B;">Store</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">store</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">observers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Function</span><span style="color:#F07178;">[] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">getStore</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">store</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setStore</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">:{})</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// newVal ä¸ç­‰äº åŸæ•°æ® æ‰è§¦å‘å‘å¸ƒè®¢é˜…</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">newVal</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">store</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">oldVal</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">store</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æš‚å­˜å èµ‹æ–°å€¼</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">store</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// è‡ªåŠ¨è§¦å‘å‘å¸ƒè®¢é˜…</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">observers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">fn</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fn</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">newVal</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">oldVal</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addSubscribe</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">fn</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Function</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">observers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fn</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">getStore</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">setStore</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addSubscribe</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ğŸ‘‡ ä¸»åº”ç”¨</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">store </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">createStore</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ·»åŠ è®¢é˜…è€… æ¯æ¬¡ä¿®æ”¹ store éƒ½ä¼šè§¦å‘è¿™ä¸ªå›è°ƒ</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addSubscribe</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">newVal</span><span style="color:#89DDFF;">:{},</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">oldVal</span><span style="color:#89DDFF;">:{})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Subscribe</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newVal</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">oldVal</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> originStore </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getStore</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">store</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setStore</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">originStore</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#82AAFF;">start</span><span style="color:#A6ACCD;">()</span></span></code></pre></div><p>å­åº”ç”¨å°±å¯ä»¥é€šè¿‡ <code>window.store</code> æ“ä½œ</p><h2 id="æ€§èƒ½ä¼˜åŒ–" tabindex="-1">æ€§èƒ½ä¼˜åŒ– <a class="header-anchor" href="#æ€§èƒ½ä¼˜åŒ–" aria-label="Permalink to &quot;æ€§èƒ½ä¼˜åŒ–&quot;">â€‹</a></h2><h3 id="ç¼“å­˜å­åº”ç”¨é™æ€èµ„æº" tabindex="-1">ç¼“å­˜å­åº”ç”¨é™æ€èµ„æº <a class="header-anchor" href="#ç¼“å­˜å­åº”ç”¨é™æ€èµ„æº" aria-label="Permalink to &quot;ç¼“å­˜å­åº”ç”¨é™æ€èµ„æº&quot;">â€‹</a></h3><p>é¦–æ¬¡ <code>fetch</code> å­åº”ç”¨ <code>html/JS</code> æ—¶ç¼“å­˜ åç»­åˆ‡æ¢æ—¶ä¸å‘å‡º <code>fetch</code> è¯·æ±‚</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cache </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// ä»¥å­åº”ç”¨name æ¥ç¼“å­˜html/JS å†…å®¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 2. åŠ è½½å­åº”ç”¨(è€—æ—¶) è°ƒ å®Œæˆ ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ·»åŠ ç¼“å­˜åˆ¤æ–­</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">cache[currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchResource</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">pasrseHtml</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">htmlContent</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jsList</span><span style="color:#F07178;">] </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ ç¼“å­˜</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> jsList</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> cache[currentAppInfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name]</span></span>
<span class="line"><span style="color:#82AAFF;">mountSubApp</span><span style="color:#A6ACCD;">(htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> currentAppInfo)</span></span></code></pre></div><h3 id="é¢„åŠ è½½å­åº”ç”¨" tabindex="-1">é¢„åŠ è½½å­åº”ç”¨ <a class="header-anchor" href="#é¢„åŠ è½½å­åº”ç”¨" aria-label="Permalink to &quot;é¢„åŠ è½½å­åº”ç”¨&quot;">â€‹</a></h3><p>åŠ è½½å½“å‰å­åº”ç”¨ç»“æŸå å°±åŠ è½½å…¶ä»–å­åº”ç”¨</p><p>ğŸ‘‡ ä¸»åº”ç”¨</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">registerMicroApps</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">start</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">preFetchApp</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/vue2demo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">])</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">findSubAppInfo</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">getUrlPathName</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../utils</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fetchApp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./cacheFetch</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> preFetchApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">appNameList</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">appNameList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;font-style:italic;">appname</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">urlAppName</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getUrlPathName</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">urlAppName</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appname</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;">  </span><span style="color:#676E95;font-style:italic;">// å½“å‰pathnameåŠ è½½ç”± start è§¦å‘ return é¿å…é‡å¤åŠ è½½</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appinfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">findSubAppInfo</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">appname</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">appinfo</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">fetchApp</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">appinfo</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">SubappInfo</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../type</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fetchResource</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">pasrseHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./loadResource</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cache </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// ä»¥å­åº”ç”¨name æ¥ç¼“å­˜html/JS å†…å®¹</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fetchApp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">appinfo</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">SubappInfo</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ ç¼“å­˜åˆ¤æ–­</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">appinfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetchResource</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">appinfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jsList</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">pasrseHtml</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">htmlContent</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">appinfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">appinfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#A6ACCD;">htmlRes</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">jsList</span><span style="color:#F07178;">] </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ ç¼“å­˜</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cache</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">appinfo</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>ts æ€ä¹ˆå®šä¹‰ è¿è¡Œæ—¶çš„ å¯¹è±¡æ•°æ® å¦‚ğŸ‘† <code>cahce[name]</code> å…¶ä¸­name æ˜¯ç”¨æˆ·è¾“å…¥çš„å€¼ ç”¨ typeof ï¼Ÿ</p><h2 id="npmå‘å¸ƒå¹¶åŠ è‡ªåŠ¨åŒ–æµç¨‹-55-61" tabindex="-1">npmå‘å¸ƒå¹¶åŠ è‡ªåŠ¨åŒ–æµç¨‹ 55 - 61 <a class="header-anchor" href="#npmå‘å¸ƒå¹¶åŠ è‡ªåŠ¨åŒ–æµç¨‹-55-61" aria-label="Permalink to &quot;npmå‘å¸ƒå¹¶åŠ è‡ªåŠ¨åŒ–æµç¨‹ 55 - 61&quot;">â€‹</a></h2>`,242),e=[o];function t(c,r,y,F,D,A){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{C as __pageData,d as default};
